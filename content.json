{"meta":{"title":"éŸ¬å…‰å…»æœˆå·´çš„æŠ€æœ¯åšå®¢","subtitle":"","description":"","author":"éŸ¬å…‰å…»æœˆå·´","url":"http://blog.tgyf.com","root":"/"},"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","date":"2020-02-22T13:20:16.531Z","updated":"2020-02-22T12:01:21.685Z","comments":false,"path":"/404.html","permalink":"http://blog.tgyf.com/404.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2020-02-22T13:20:16.520Z","updated":"2020-02-22T12:01:21.688Z","comments":false,"path":"books/index.html","permalink":"http://blog.tgyf.com/books/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2020-03-04T03:34:15.353Z","updated":"2020-03-04T03:34:15.289Z","comments":false,"path":"about/index.html","permalink":"http://blog.tgyf.com/about/index.html","excerpt":"","text":"æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ï¼Œæˆ‘ä¼šä¿æŒä¸å®šæœŸæ›´æ–°ã€‚ 123456789101112131415161718192021222324252627282930313233343536 _______ ______ __ __ _____ /\\_______)\\/_/\\___\\/\\ /\\ /\\ /\\_____\\ \\(___ __\\/) ) ___/\\ \\ \\/ / /( ( ___/ / / / /_/ / ___\\ \\__/ / \\ \\ \\_ ( ( ( \\ \\ \\_/\\__\\\\__/ / / / /_\\ \\ \\ \\ )_) \\/ _// / / / /____/ /_/_/ \\_\\____/ \\/_/ \\/_/ &#123; \"name\": \"éŸ¬å…‰å…»æœˆå·´\", \"age\": 30, \"gender\": \"ç”·\", \"profession\": \"Java Developer &amp; Designer\", \"experience\": \"5å¹´\", \"address\": \"å››å·çœæˆéƒ½å¸‚\", \"education\": \"æœ¬ç§‘\", \"github\": \"https://github.com/tgyf\", \"blog\": \"http://blog.tgyf.com\", \"email\": \"back_up[a]foxmail.com\", \"skills\":[ [\"SpringFramework\", \"Netty\", \"Dubbo\", \"Mybatis\"], [\"Html\", \"Javascript\", \"jQuery\", \"CSS\"], [\"Mysql\",\"Orcal\",\"Redis\",\"MongoDB\"], [\"Docker\", \"Swarm\",\"K8s\"], [\"Git\", \"SVN\"], ], \"devTools\":[ [\"IntelliJ IDEA \", \"VisualStudioCode\", \"Notepad++\"], [\"SourceTree\", \"TortoiseSVN\"], [\"Navicat\", \"RedisDesktopManager\",\"Robo3t\"], [\"MobaXterm\",\"Xshell\"] ] &#125;"},{"title":"åˆ†ç±»","date":"2020-02-22T13:20:16.515Z","updated":"2020-02-22T13:07:14.116Z","comments":false,"path":"categories/index.html","permalink":"http://blog.tgyf.com/categories/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2020-02-22T13:20:16.505Z","updated":"2020-02-22T12:01:21.688Z","comments":true,"path":"links/index.html","permalink":"http://blog.tgyf.com/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2020-02-22T13:20:16.499Z","updated":"2020-02-22T12:01:21.689Z","comments":false,"path":"repository/index.html","permalink":"http://blog.tgyf.com/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-02-22T13:20:16.510Z","updated":"2020-02-22T12:01:21.689Z","comments":false,"path":"tags/index.html","permalink":"http://blog.tgyf.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"é«˜å¹¶å‘ä¸‹çš„SpringCloudå‚æ•°ä¼˜åŒ–","slug":"Javaæ¡†æ¶/SpringCloud/é«˜å¹¶å‘ä¸‹çš„SpringCloudå‚æ•°ä¼˜åŒ–","date":"2020-03-04T15:53:24.232Z","updated":"2020-03-04T15:53:24.232Z","comments":true,"path":"2020/03/04/Javaæ¡†æ¶/SpringCloud/é«˜å¹¶å‘ä¸‹çš„SpringCloudå‚æ•°ä¼˜åŒ–/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E6%A1%86%E6%9E%B6/SpringCloud/%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8B%E7%9A%84SpringCloud%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/","excerpt":"","text":"ç›¸ä¿¡ä¸å°‘æœ‹å‹éƒ½åœ¨è‡ªå·±å…¬å¸ä½¿ç”¨Spring Cloudæ¡†æ¶æ¥æ„å»ºå¾®æœåŠ¡æ¶æ„ï¼Œå¦‚æœåªæ˜¯ç”¨æˆ·é‡å¾ˆå°‘çš„ä¼ ç»ŸITç³»ç»Ÿï¼Œä½¿ç”¨Spring Cloudå¯èƒ½è¿˜æš´éœ²ä¸å‡ºä»€ä¹ˆé—®é¢˜. å¦‚æœæ˜¯è¾ƒå¤šç”¨æˆ·é‡ï¼Œé«˜å³°æ¯ç§’é«˜è¾¾ä¸Šä¸‡å¹¶å‘è¯·æ±‚çš„äº’è”ç½‘å…¬å¸çš„ç³»ç»Ÿï¼Œä½¿ç”¨Spring CloudæŠ€æœ¯å°±æœ‰ä¸€äº›é—®é¢˜éœ€è¦æ³¨æ„äº†. å¬è¯´çš„ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ æ•…äº‹çš„å¼€å§‹ æœ‹å‹Açš„å…¬å¸åšäº’è”ç½‘ç±»çš„åˆ›ä¸šï¼Œç»„å»ºäº†ä¸€ä¸ªå°å‹ç ”å‘å›¢é˜Ÿï¼Œä¸Šæ¥å°±ç”¨äº†Spring CloudæŠ€æœ¯æ ˆæ¥æ„å»ºå¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿ. ä¸€æ®µæ—¶é—´æ²¡æ—¥æ²¡å¤œçš„åŠ ç­ï¼Œå¥½ä¸å®¹æ˜“æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿç»™åšå‡ºæ¥äº†ï¼Œå¹³æ—¶æ­£å¸¸QAæµ‹è¯•æ²¡å‘ç°ä»€ä¹ˆå¤§æ¯›ç—…ï¼Œæ„Ÿè§‰æ€§èƒ½è¿˜ä¸é”™ï¼Œä¸€åˆ‡éƒ½å¾ˆå®Œç¾ é—®é¢˜åˆç° ç„¶åç³»ç»Ÿå°±è¿™ä¹ˆä¸Šçº¿äº†ï¼Œä¸€å¼€å§‹ç”¨æˆ·è§„æ¨¡å¾ˆå°ï¼Œæ³¨å†Œç”¨æˆ·é‡å°å‡ åä¸‡ï¼Œæ—¥æ´»å‡ åƒç”¨æˆ·. æ¯å¤©éƒ½æœ‰æ–°çš„æ•°æ®è¿›å…¥æ•°æ®åº“çš„è¡¨ä¸­ï¼Œå°±è¿™ä¹ˆæ—¥ç§¯æœˆç´¯çš„ï¼Œæ²¡æƒ³åˆ°æ•°æ®è§„æ¨¡å±…ç„¶æ…¢æ…¢ååå¢é•¿åˆ°äº†å•è¡¨å‡ ç™¾ä¸‡. è¿™ä¸ªæ—¶å€™å‘¢ï¼Œçœ‹èµ·æ¥ä¹Ÿæ²¡å¤ªå¤§çš„æ¯›ç—…ï¼Œå°±æ˜¯æœ‰ç”¨æˆ·åæ˜ ï¼Œç³»ç»Ÿæœ‰äº›æ“ä½œï¼Œä¼šæ„Ÿè§‰å¡é¡¿å‡ ç§’é’Ÿï¼Œä¼šåˆ·ä¸å‡ºæ¥é¡µé¢. è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ æ ¸å¿ƒåŸå› æ˜¯å•è¡¨æ•°æ®é‡å¤§äº†ä¸€äº›ï¼Œè¾¾åˆ°äº†å‡ ç™¾ä¸‡. æœ‰ä¸ªåˆ«æœåŠ¡ï¼Œè·‘çš„SQLæ¯”è¾ƒå¤æ‚ï¼Œä¸€å¤§å †çš„å¤šè¡¨å…³è” å¹¶ä¸”è¿˜æ²¡æœ‰è®¾è®¡å¥½ç´¢å¼•ï¼Œæˆ–è€…æ˜¯è®¾è®¡äº†ç´¢å¼•ï¼Œä½†æ— å¥ˆä¸€äº›å°å¼Ÿå†™äº†ä¸Šç™¾è¡Œçš„å¤§SQLï¼ŒSQLå®åœ¨å¤ªå¤æ‚äº†ï¼Œé‚£ä¹ˆä¸€ä¸ªSQLè·‘å‡ºæ¥å¥½å‡ ç§’è‚¯å®šæ˜¯æ­£å¸¸çš„. å¦‚æœå¤§å®¶å¯¹å¾®æœåŠ¡æ¡†æ¶æœ‰ç‚¹äº†è§£çš„è¯ï¼Œåº”è¯¥çŸ¥é“ï¼Œæ¯”å¦‚Feign + Ribbonç»„æˆçš„æœåŠ¡è°ƒç”¨æ¡†æ¶ï¼Œæ˜¯æœ‰æ¥å£è°ƒç”¨è¶…æ—¶è¿™ä¸€è¯´çš„ï¼Œæœ‰ä¸€äº›å‚æ•°å¯ä»¥è®¾ç½®æ¥å£è°ƒç”¨çš„è¶…æ—¶æ—¶é—´. å¦‚æœä½ è°ƒç”¨ä¸€ä¸ªæ¥å£ï¼Œå¥½å‡ ç§’åˆ·ä¸å‡ºæ¥ï¼Œäººå®¶å°±è¶…æ—¶å¼‚å¸¸è¿”å›ï¼Œç”¨æˆ·å°±åˆ·ä¸å‡ºæ¥é¡µé¢äº†. é¥®é¸©æ­¢æ¸´ ä¸€èˆ¬ç¢°åˆ°è¿™ç§äº‹æƒ…ï¼Œä¸€å¤§å¨å±ä¸€æ ·çš„SQLæ‘†åœ¨é‚£å„¿ï¼Œå†™SQLçš„äººè¿‡ä¸€ä¸ªæœˆè‡ªå·±éƒ½çœ‹ä¸æ‡‚äº†ï¼Œ80%çš„å·¥ç¨‹å¸ˆçœ‹ç€éƒ½ä¸æ„¿æ„å»èŠ±æ—¶é—´é‡å†™å’Œä¼˜åŒ–. ä¸€æ˜¯ä¿®æ”¹çš„äººåŠ›æˆæœ¬å¤ªé«˜ï¼ŒäºŒæ˜¯è°æ•¢è´Ÿæ‹…è¿™è´£ä»»å‘¢ï¼Ÿ ç³»ç»Ÿè·‘çš„å¥½å¥½çš„ï¼Œå°±æ˜¯æ…¢äº†ç‚¹è€Œå·²ï¼Œç»“æœä½ ç¡¬æ˜¯ä¹±æ”¹ä¸€é€šï¼Œé‡æ„ï¼ŒæŠŠç³»ç»Ÿæ ¸å¿ƒä¸šåŠ¡æµç¨‹ææŒ‚äº†æ€ä¹ˆåŠï¼Ÿ æ‰€ä»¥ï¼Œé‚£äº›å…„å¼Ÿç¬¬ä¸€ååº”æ˜¯ï¼šå¢åŠ è¶…æ—¶æ—¶é—´å•Šï¼æ¥å£æ…¢ç‚¹å¯ä»¥ï¼Œä½†æ˜¯åˆ«è¶…æ—¶ä¸å“åº”å•Šï¼ å’±ä»¬è®©æ¥å£æ‰§è¡Œä¸ªå‡ ç§’æŠŠç»“æœè¿”å›ï¼Œç”¨æˆ·ä¸å°±å¯ä»¥åˆ·å‡ºæ¥é¡µé¢äº†ï¼ä¸ç”¨é‡æ„ç³»ç»Ÿäº†å•Šï¼è½»æ¾+æ„‰å¿«ï¼ å¦‚ä½•å¢åŠ å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„å‚æ•° 12345678910ribbon: ConnectTimeout: 30000 ReadTimeout: 30000hystrix: command: default: execution: isolation: thread: timeoutInMillisconds: 60000 æ‰€ä»¥è®¾ç½®è¶…æ—¶ä¸€èˆ¬è®¾ç½®ä¸¤ä¸ªåœ°æ–¹ï¼Œfeignå’Œribboné‚£å—çš„è¶…æ—¶ï¼Œè¿˜æœ‰hystrixé‚£å—çš„è¶…æ—¶.å…¶ä¸­åè€…é‚£å—çš„è¶…æ—¶ä¸€èˆ¬å¿…é¡»å¤§äºå‰è€…. å¥½äº†ï¼Œæ—¥å­åœ¨ç»§ç»­â€¦ ä¼˜åŒ–äº†å‚æ•°åï¼Œçœ‹ä¸Šå»æ•ˆæœä¸é”™ï¼Œç”¨æˆ·è™½ç„¶è§‰å¾—æœ‰çš„é¡µé¢æ…¢æ˜¯æ…¢ç‚¹ï¼Œä½†æ˜¯èµ·ç è¿‡å‡ ç§’èƒ½åˆ·å‡ºæ¥. è¿™ä¸ªæ—¶å€™ï¼Œæ—¥æ´»å‡ åƒçš„ç”¨æˆ·é‡ï¼Œå‹æ ¹å„¿æ²¡ä»€ä¹ˆå¹¶å‘å¯è¨€ï¼Œé«˜å³°æœŸæ¯ç§’æœ€å¤šä¸€äºŒåå¹¶å‘è¯·æ±‚ç½¢äº†. é—®é¢˜çˆ†å‘ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå…¬å¸ä¸šåŠ¡é«˜é€Ÿå‘å±•â€¦â€¦ é‚£ä½å…„å¼Ÿçš„å…¬å¸ï¼Œåœ¨ç³»ç»Ÿæ‰“ç£¨æˆç†Ÿï¼Œå‡ ä¸‡ç”¨æˆ·è¯•ç‚¹éƒ½okä¹‹åï¼Œè€æ¿ç«‹é©¬æ‹¿åˆ°ä¸€è½®å‡ åƒä¸‡çš„èèµ„. å…¬å¸ä¸Šä¸Šä¸‹ä¸‹æ„æ°”é£å‘å•Šï¼ç´§æ¥ç€å°±æ˜¯ç»„å»ºè¿è¥å›¢é˜Ÿï¼Œåœ°æ¨å›¢é˜Ÿï¼Œå…¨å›½å¤§èŒƒå›´çš„æ¨å¹¿. ç”¨æˆ·é‡ä¸Šæ¥åï¼Œæ‚²å‰§çš„äº‹æƒ…å°±å‘ç”Ÿäº†. é«˜å³°æœŸæ¯ç§’çš„å¹¶å‘è¯·æ±‚å±…ç„¶è¾¾åˆ°äº†è¿‘ä¸‡çš„ç¨‹åº¦ï¼Œç ”å‘å›¢é˜Ÿçš„å…„å¼Ÿä»¬å“ªé‡Œæ•¢æ€ æ…¢ï¼åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…ˆæ˜¯ç´§å¼ çš„å„ç§æ‰©å®¹æœåŠ¡ï¼Œä¸€å°å˜ä¸¤å°ï¼Œä¸¤å°å˜å››å°. ç„¶åæ•°æ®åº“ä¸»ä»æ¶æ„æŒ‚ä¸Šå»ï¼Œè¯»å†™åˆ†ç¦»æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å•ä¸ªæ•°æ®åº“æœåŠ¡å™¨å“ªèƒ½æ‰¿è½½é‚£ä¹ˆå¤§çš„è¯·æ±‚ï¼å¤šæå‡ ä¸ªä»åº“ï¼Œæ‰›ä¸€ä¸‹å¤§é‡çš„è¯»è¯·æ±‚ï¼Œè¿™æ ·åŸºæœ¬å°±æ‰›ä½äº†. æ­£å‡†å¤‡åä¸‹æ¥å–å£èŒ¶ã€æ¾å£æ°”ï¼Œæ›´åŠ æ‚²å‰§çš„äº‹æƒ…å°±å‘ç”Ÿäº†. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé‚£äº›å…„å¼Ÿç»å¸¸ä¼šå‘ç°é«˜å³°æœŸï¼Œç³»ç»Ÿçš„æŸä¸ªåŠŸèƒ½é¡µé¢ï¼Œçªç„¶å°±æ•´ä¸ªhangæ­»äº†ï¼Œå°±æ˜¯æ²¡æ³•å†å“åº”ä»»ä½•è¯·æ±‚ï¼æ‰€æœ‰ç”¨æˆ·åˆ·æ–°è¿™ä¸ªé¡µé¢å…¨éƒ¨éƒ½æ˜¯æ— æ³•å“åº”ï¼ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› å¾ˆç®€å•å•Šï¼ä¸€ä¸ªæœåŠ¡Açš„å®ä¾‹é‡Œï¼Œä¸“é—¨è°ƒç”¨æœåŠ¡Bçš„é‚£ä¸ªçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ï¼Œæ€»å…±å¯èƒ½å°±å‡ åä¸ª.æ¯ä¸ªçº¿ç¨‹è°ƒç”¨æœåŠ¡Béƒ½ä¼šå¡ä½5ç§’é’Ÿ. é‚£å¦‚æœæ¯ç§’é’Ÿè¿‡æ¥å‡ ç™¾ä¸ªè¯·æ±‚è¿™ä¸ªæœåŠ¡å®ä¾‹å‘¢ï¼Ÿä¸€ä¸‹å­é‚£ä¸ªçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹å°±å…¨éƒ¨hangæ­»äº†ï¼Œæ²¡æ³•å†å“åº”ä»»ä½•è¯·æ±‚äº†. è¿™ä¸ªæ—¶å€™å’‹åŠï¼Ÿå…„å¼Ÿä»¬åªèƒ½ç¥­å‡ºç¨‹åºå‘˜æœ€å¤è€çš„æ³•å®ï¼Œé‡å¯æœºå™¨ï¼ é‡åˆ°é¡µé¢åˆ·ä¸å‡ºæ¥ï¼Œåªèƒ½é‡å¯æœºå™¨ï¼Œç›¸å½“äºçŸ­æš‚çš„åˆå§‹åŒ–äº†ä¸€ä¸‹æœºå™¨å†…çš„èµ„æº. ç„¶åæ¥ç€è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œåˆå¡æ­»ï¼Œå†æ¬¡é‡å¯ï¼çœŸæ˜¯ä»¤äººå´©æºƒå•Šï¼ç”¨æˆ·ä»¬çš„ä½“éªŒæ˜¯æå·®çš„ï¼Œè€æ¿çš„å¿ƒæƒ…æ˜¯æ„¤æ€’çš„ï¼ è¿™é‡Œå­¦åˆ°çš„ç»éªŒ 12æ˜æ˜åº”è¯¥å»ä¼˜åŒ–æœåŠ¡æ¥å£æ€§èƒ½ï¼Œç»“æœç¡¬æ˜¯è°ƒå¤§äº†è¶…æ—¶æ—¶é—´.ç»“æœå¯¼è‡´å¹¶å‘é‡é«˜äº†ï¼Œå¯¹é‚£ä¸ªæœåŠ¡çš„è°ƒç”¨ç›´æ¥hangæ­»ï¼Œç³»ç»Ÿçš„æ ¸å¿ƒé¡µé¢åˆ·ä¸å‡ºæ¥ï¼Œå½±å“ç”¨æˆ·ä½“éªŒäº†. è¿½æœ¬æº¯æº ç¬¬ä¸€æ­¥ å…³é”®ç‚¹ï¼Œä¼˜åŒ–å›¾ä¸­æ ¸å¿ƒæœåŠ¡Bçš„æ€§èƒ½.äº’è”ç½‘å…¬å¸ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œé¢å‘Cç«¯ç”¨æˆ·é«˜å¹¶å‘çš„è¯·æ±‚ï¼Œä¸è¦ç”¨ä¸Šç™¾è¡Œçš„å¤§SQLï¼Œå¤šè¡¨å…³è”ï¼Œé‚£æ ·å•è¡¨å‡ ç™¾ä¸‡è¡Œæ•°æ®é‡çš„è¯ï¼Œä¼šå¯¼è‡´ä¸€ä¸‹æ‰§è¡Œå¥½å‡ ç§’. å…¶å®æœ€ä½³çš„æ–¹å¼ï¼Œå°±æ˜¯å¯¹æ•°æ®åº“å°±æ‰§è¡Œç®€å•çš„å•è¡¨æŸ¥è¯¢å’Œæ›´æ–°ï¼Œç„¶åå¤æ‚çš„ä¸šåŠ¡é€»è¾‘å…¨éƒ¨æ”¾åœ¨javaç³»ç»Ÿä¸­æ¥æ‰§è¡Œï¼Œæ¯”å¦‚ä¸€äº›å…³è”ï¼Œæˆ–è€…æ˜¯è®¡ç®—ä¹‹ç±»çš„å·¥ä½œ. è¿™ä¸€æ­¥å¹²å®Œäº†ä¹‹åï¼Œé‚£ä¸ªæ ¸å¿ƒæœåŠ¡Bçš„å“åº”é€Ÿåº¦å°±å·²ç»ä¼˜åŒ–æˆå‡ åæ¯«ç§’äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¼€å¿ƒï¼Ÿä»å‡ ç§’å˜æˆäº†å‡ åæ¯«ç§’ï¼ ç¬¬äºŒæ­¥ é‚£ä¸ªè¶…æ—¶çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢é‚£æ®µribbonå’Œhystrixçš„è¶…æ—¶æ—¶é—´è®¾ç½®. å¥‰åŠå„ä½åŒå­¦ï¼Œä¸è¦å› ä¸ºç³»ç»Ÿæ¥å£çš„æ€§èƒ½è¿‡å·®è€Œæ‡’æƒ°ï¼Œææˆå‡ ç§’ç”šè‡³å‡ åç§’çš„è¶…æ—¶ï¼Œä¸€èˆ¬è¶…æ—¶å®šä¹‰åœ¨1ç§’ä»¥å†…ï¼Œæ˜¯æ¯”è¾ƒé€šç”¨ä»¥åŠåˆç†çš„. ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ å› ä¸ºä¸€ä¸ªæ¥å£ï¼Œç†è®ºçš„æœ€ä½³å“åº”é€Ÿåº¦åº”è¯¥åœ¨200msä»¥å†…ï¼Œæˆ–è€…æ…¢ç‚¹çš„æ¥å£å°±å‡ ç™¾æ¯«ç§’. å¦‚æœä¸€ä¸ªæ¥å£å“åº”æ—¶é—´è¾¾åˆ°1ç§’+ï¼Œå»ºè®®è€ƒè™‘ç”¨ç¼“å­˜ã€ç´¢å¼•ã€NoSQLç­‰å„ç§ä½ èƒ½æƒ³åˆ°çš„æŠ€æœ¯æ‰‹æ®µï¼Œä¼˜åŒ–ä¸€ä¸‹æ€§èƒ½. å¦åˆ™ä½ è¦æ˜¯èƒ¡ä¹±è®¾ç½®è¶…æ—¶æ—¶é—´æ˜¯å‡ ç§’ï¼Œç”šè‡³å‡ åç§’ï¼Œä¸‡ä¸€ä¸‹æ¸¸æœåŠ¡å¶ç„¶å‡ºäº†ç‚¹é—®é¢˜å“åº”æ—¶é—´é•¿äº†ç‚¹å‘¢ï¼Ÿé‚£ä½ è¿™ä¸ªçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ç«‹é©¬å…¨éƒ¨å¡æ­»ï¼ å…·ä½“hystrixçš„çº¿ç¨‹æ± ä»¥åŠè¶…æ—¶æ—¶é—´çš„æœ€ä½³ç”Ÿäº§å®è·µï¼Œè¯·è§ä¸‹ä¸€ç¯‡æ–‡ç« ï¼šã€Šå¾®æœåŠ¡æ¶æ„å¦‚ä½•ä¿éšœåŒ11ç‹‚æ¬¢ä¸‹çš„99.99%é«˜å¯ç”¨ã€‹ è¿™ä¸¤æ­¥è§£å†³ä¹‹åï¼Œå…¶å®ç³»ç»Ÿè¡¨ç°å°±æ­£å¸¸äº†ï¼Œæ ¸å¿ƒæœåŠ¡Bå“åº”é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œä¸”è¶…æ—¶æ—¶é—´ä¹Ÿåœ¨1ç§’ä»¥å†…ï¼Œä¸ä¼šå‡ºç°hystrixçº¿ç¨‹æ± é¢‘ç¹å¡æ­»çš„æƒ…å†µäº†. ç¬¬ä¸‰æ­¥ äº‹å„¿è¿˜æ²¡å®Œï¼Œä½ è¦çœŸè§‰å¾—ä¸¤æ­¥å°±æå®šäº†ï¼Œé‚£è¿˜æ˜¯ç»éªŒä¸è¶³. å¦‚æœä½ è¦æ˜¯è¶…æ—¶æ—¶é—´è®¾ç½®æˆäº†1ç§’ï¼Œå¦‚æœå°±æ˜¯å› ä¸ºå¶ç„¶å‘ç”Ÿçš„ç½‘ç»œæŠ–åŠ¨ï¼Œå¯¼è‡´æ¥å£æŸæ¬¡è°ƒç”¨å°±æ˜¯åœ¨1.5ç§’å‘¢ï¼Ÿè¿™ä¸ªæ˜¯ç»å¸¸å‘ç”Ÿçš„ï¼Œå› ä¸ºç½‘ç»œçš„é—®é¢˜ï¼Œæ¥å£è°ƒç”¨å¶ç„¶è¶…æ—¶. æ‰€ä»¥æ­¤æ—¶é…åˆç€è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬éƒ½ä¼šè®¾ç½®ä¸€ä¸ªåˆç†çš„é‡è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456ribbon: ConnectTimeout: 10000 ReadTimeout: 10000 OKToRetryOnAllOperations: true MaxAutoRetries: 1 MaxAutoRetriesNextServer: 1 è®¾ç½®è¿™æ®µé‡è¯•ä¹‹åï¼ŒSpring Cloudä¸­çš„Feign + Ribbonçš„ç»„åˆï¼Œåœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æŸå°æœºå™¨è¶…æ—¶è¯·æ±‚å¤±è´¥ï¼Œä¼šè‡ªåŠ¨é‡è¯•è¿™å°æœºå™¨ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œä¼šæ¢å¦å¤–ä¸€å°æœºå™¨é‡è¯•. è¿™æ ·ç”±äºå¶å°”çš„ç½‘ç»œè¯·æ±‚é€ æˆçš„è¶…æ—¶ï¼Œä¸ä¹Ÿå¯ä»¥é€šè¿‡è‡ªåŠ¨é‡è¯•é¿å…äº†ï¼Ÿ ç¬¬å››æ­¥ å…¶å®äº‹å„¿è¿˜æ²¡å®Œï¼Œå¦‚æœæŠŠé‡è¯•å‚æ•°é…ç½®äº†ï¼Œç»“æœä½ å±…ç„¶å°±æ”¾æ‰‹äº†ï¼Œé‚£è¿˜æ˜¯æ²¡å¯¹äººå®¶è´Ÿè´£ä»»å•Šï¼ ä½ çš„ç³»ç»Ÿæ¶æ„ä¸­ï¼Œåªè¦æ¶‰åŠåˆ°äº†é‡è¯•ï¼Œé‚£ä¹ˆå¿…é¡»ä¸Šæ¥å£çš„å¹‚ç­‰æ€§ä¿éšœæœºåˆ¶. å¦åˆ™çš„è¯ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œä½ è¦æ˜¯å¯¹ä¸€ä¸ªæ¥å£é‡è¯•äº†å¥½å‡ æ¬¡ï¼Œç»“æœäººå®¶é‡å¤æ’å…¥äº†å¤šæ¡æ•°æ®ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®å¹‚ç­‰æ€§ä¿è¯æœ¬èº«å¹¶ä¸å¤æ‚ï¼Œæ ¹æ®ä¸šåŠ¡æ¥ï¼Œå¸¸è§çš„æ–¹æ¡ˆï¼š å¯ä»¥åœ¨æ•°æ®åº“é‡Œå»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œæ’å…¥æ•°æ®çš„æ—¶å€™å¦‚æœå”¯ä¸€ç´¢å¼•å†²çªäº†å°±ä¸ä¼šæ’å…¥é‡å¤æ•°æ® æˆ–è€…æ˜¯é€šè¿‡redisé‡Œæ”¾ä¸€ä¸ªå”¯ä¸€idå€¼ï¼Œç„¶åæ¯æ¬¡è¦æ’å…¥æ•°æ®ï¼Œéƒ½é€šè¿‡redisåˆ¤æ–­ä¸€ä¸‹ï¼Œé‚£ä¸ªå€¼å¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå°±ä¸è¦æ’å…¥é‡å¤æ•°æ®äº†. ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆè¿˜æœ‰ä¸€äº›.æ€»ä¹‹ï¼Œè¦ä¿è¯ä¸€ä¸ªæ¥å£è¢«å¤šæ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œä¸èƒ½æ’å…¥é‡å¤çš„æ•°æ®. ä¼˜åŒ–å","categories":[{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/categories/SpringCloud/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/tags/SpringCloud/"}]},{"title":"SpringCloudå¾®æœåŠ¡æ‚è°ˆ","slug":"Javaæ¡†æ¶/SpringCloud/SpringCloudå¾®æœåŠ¡æ‚è°ˆ","date":"2020-03-04T15:17:25.591Z","updated":"2020-03-04T15:17:25.592Z","comments":true,"path":"2020/03/04/Javaæ¡†æ¶/SpringCloud/SpringCloudå¾®æœåŠ¡æ‚è°ˆ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E6%A1%86%E6%9E%B6/SpringCloud/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9D%82%E8%B0%88/","excerpt":"","text":"å¾®æœåŠ¡çš„å®šä¹‰ å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå…¶ç†å¿µæ˜¯æŠŠä¸€ä¸ªç³»ç»Ÿå®šä¹‰æˆå¤šä¸ªå¾®æœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡éƒ½åªå…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡ï¼Œè€Œä¸”å¾ˆå¥½çš„å®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œå¾®æœåŠ¡ä¸å¾®æœåŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œäº’ç›¸ä¸å½±å“ã€‚è¿™ç§æ€æƒ³å»¶ç»­äº†javaé«˜ç±»èšçš„åŸåˆ™ï¼Œæ¯ä¸ªç±»åªè´Ÿè´£å®Œæˆè‡ªå·±çš„ä¸šåŠ¡ã€‚ å¾®æœåŠ¡çš„æ¼”å˜ å•ä½“æ¶æ„ ä¼ ç»Ÿçš„é¡¹ç›®æ˜¯ä»¥ä¸€ä¸ªæ•´ä½“çš„æ–¹å¼å‘ˆç°ï¼Œæ•´ä¸ªç³»ç»Ÿæ‰“æˆä¸€ä¸ªjaråŒ…éƒ¨ç½²ï¼Œè¿™æ ·çš„ç»“æ„ä¼šæ¯‹åº¸ç½®ç–‘ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ä¸€æ˜¯å¼€å‘ï¼Œæ‰€æœ‰çš„å¼€å‘äººå‘˜åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šå¼€å‘ï¼Œä¸€æ˜¯å¢åŠ äº†å¤æ‚åº¦ï¼ŒäºŒæ˜¯åŠ å¤§äº†ä»£ç çš„ç®¡ç†æˆæœ¬ã€‚å…¶æ¬¡æ˜¯éƒ¨ç½²ï¼Œä¸ç®¡æ˜¯å¤šå°çš„æ”¹åŠ¨éƒ½éœ€è¦æ•´ä¸ªé¡¹ç›®ä¸Šä¼ æ›´æ–°ï¼Œè¿™æ— ç–‘åŠ å¤§äº†æ›´æ–°çš„å·¥ä½œé‡ï¼Œç„¶åæ˜¯ç¨³å®šæ€§ï¼Œå¦‚æœåŠŸèƒ½å‡ºç°é—®é¢˜ï¼Œå¾ˆæœ‰å¯èƒ½å½±å“åˆ°æ•´ä¸ªç³»ç»Ÿé˜»å¡ã€‚ SOAæœåŠ¡æ²»ç† SOA(Service Oriented Architecture)é¢å‘æœåŠ¡çš„æ¶æ„ï¼Œè¿™æ˜¯ä¸€ç§æ¶æ„çš„è®¾è®¡ç†å¿µï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠæ•´ä¸ªç³»ç»Ÿçš„ä¸šåŠ¡æ¨¡å—å’ŒåŠŸèƒ½ä¸­å¿ƒæ‹†åˆ†æˆç‹¬ç«‹çš„æœåŠ¡ï¼Œæ¯”å¦‚å¸¸è§çš„ä¸šåŠ¡è®¢å•æœåŠ¡ï¼ŒåŠŸèƒ½æ¶ˆæ¯æ¨é€åŠŸèƒ½ã€‚æ¯ä¸ªæœåŠ¡ç›¸äº’ç‹¬ç«‹ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œäº’ç›¸è°ƒç”¨ã€‚å…¶è®¾è®¡æ²¿ç”¨çš„æ˜¯ä½è€¦åˆï¼Œé«˜ç±»èšçš„æ€æƒ³ã€‚ RPC(Remote Procedure call)è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œæ—¢ç„¶è®¾è®¡åˆ°æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œä»–è¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯è§£å†³äº†è®©è¿œç¨‹è°ƒç”¨æ—¶åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·æ–¹ä¾¿ï¼Œè®©ä½œè€…æ„ŸçŸ¥ä¸åˆ°è¿œç¨‹è°ƒç”¨çš„é€»è¾‘ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯é€šè¿‡åå‘ä»£ç†ç„¶åæ³¨å…¥ä¸€ä¸ªå¯¹è±¡ç»™è°ƒç”¨ç€ï¼Œè¿™æ ·è°ƒç”¨ç€å°±è¿™æ ·ç›´æ¥ä½¿ç”¨æœåŠ¡æä¾›æ–¹çš„æ–¹æ³•äº†ã€‚ å¾®æœåŠ¡ å¾®æœåŠ¡æ˜¯å°†å¤æ‚çš„ç³»ç»Ÿæ‹†åˆ†æˆå¾ˆå¤šä¸ªå°çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œè¿™é‡Œæˆ‘ä»¬ç§°è¿™äº›å°çš„ä¸šåŠ¡ç³»ç»Ÿä¸ºç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯å¾®æœåŠ¡ã€‚ç»„ä»¶ï¼Œç›¸æ¯”äºä¼ ç»Ÿç³»ç»Ÿï¼Œä»¥ä»£ç åº“çš„å½¢å¼è°ƒç”¨ï¼Œå¾®æœåŠ¡æŠŠç»„ä»¶ä»¥æœåŠ¡çš„å½¢å¼æä¾›è¿œç¨‹è°ƒç”¨ã€‚å¾®æœåŠ¡ï¼Œå¼ºè°ƒçš„æ˜¯æ›´ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ›´ç²¾ç»†çš„æ‹†åˆ†æ›´åŠ æ–¹ä¾¿è§£è€¦å’Œå¤ç”¨ï¼Œæ˜¯ç³»ç»Ÿæ›´æ¸…æ™°ï¼Œæ›´å®¹æ˜“ç»´æŠ¤ã€‚å¾®æœåŠ¡ï¼Œå¼ºè°ƒçš„æ˜¯æ›´ç‹¬ç«‹ï¼Œç‹¬ç«‹çš„æ•°æ®åº“ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œç‹¬ç«‹è¿è¡Œï¼Œè¿™ä½¿å¾—å¾®æœåŠ¡çš„åº”ç”¨æ›´åŠ çµæ´»å’Œå¿«é€Ÿã€‚ RESTæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ï¼Œé™ä½å¼€å‘çš„å¤æ‚åº¦ã€‚å¦‚æœä¸€ä¸ªç³»ç»Ÿèƒ½æ»¡è¶³RESTçš„è¿™å‡ ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆå°±æ˜¯Restful é£æ ¼ã€‚å®ƒä»¥èµ„æºä¸ºä¸­å¿ƒï¼Œåç§°æ˜¯èµ„æºåœ°å€ï¼ŒåŠ¨è¯åˆ™è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œï¼Œæ‰€æœ‰Restä½¿ç”¨çš„æ˜¯httpåè®®ã€‚ç›¸æ¯”äºRPC å…³æ³¨äºæ–¹æ³•çš„è°ƒç”¨ï¼Œä½†æ˜¯RPCæ”¯æŒå¤šç§åè®®ï¼Œä»æ•ˆç‡ä¸Šæ¥è¯´é«˜äºhttpã€‚ è§£å†³ä»€ä¹ˆé—®é¢˜ å¼€å‘ç»´æŠ¤ï¼šæŠŠä¸šåŠ¡åˆ†æˆå¾ˆå°çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½ç›¸äº’ç‹¬ç«‹ï¼Œè¿™æ ·ä¸€æ˜¯è€¦åˆä½ï¼Œç»“æ„æ¸…æ™°ã€‚ä¸ç®¡æ˜¯ç¼–ç äººå‘˜è¿˜æ˜¯ç»´æŠ¤äººå‘˜éƒ½åªéœ€è¦å…³æ³¨è‡ªå·±è´Ÿè´£çš„æœåŠ¡ã€‚ è´Ÿè½½å‡è¡¡ï¼šæœåŠ¡æœ€å°åŒ–æœ‰ä¸ªå¥½å¤„æ¯‹åº¸ç½®ç–‘å°±æ˜¯è´Ÿè½½ï¼Œåœ¨ç°åœ¨çš„äº’è”ç½‘é¡¹ç›®ï¼Œä¸ºäº†æ‰¿å—å¤§çš„æµé‡ï¼Œä¼šç”¨è´Ÿè½½çš„æ–¹å¼æ¥å¢åŠ æœåŠ¡å™¨çš„é…ç½®å’Œæ•°é‡ã€‚æœ‰äººè¯´å¦‚æœä¼ ç»Ÿé¡¹ç›®ç”¨é›†ç¾¤çš„æ–¹å¼ä¹Ÿèƒ½å®ç°è´Ÿè½½ï¼Œä½†æ˜¯å¦‚æœä»¥å¾®æœåŠ¡çš„æ–¹å¼å¯ä»¥æ›´æœ‰é’ˆå¯¹æ€§ï¼Œæ›´ç²¾ç¡®çš„æ‰©å®¹ï¼ŒèŠ‚çº¦èµ„æºã€‚æ¯”å¦‚è®¢å•æ¨¡å—çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæˆ‘å°±åªéœ€è¦ä¸ºè®¢å•æœåŠ¡å¢åŠ æœåŠ¡å™¨ï¼Œè€Œä¸éœ€è¦çœŸä¸ªç³»ç»Ÿéƒ½å¢åŠ ã€‚ ç‰ˆæœ¬è¿­ä»£ï¼šå¾®æœåŠ¡çš„è®¾è®¡è®©å¶å’Œæœ€ä½åŒ–ï¼Œå®ç°åˆ†è€Œæ²»ä¹‹ã€‚åœ¨ç‰ˆæœ¬è¿­ä»£çš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–°æœ‰å˜åŠ¨çš„æœåŠ¡ï¼Œè€Œä¸éœ€è¦æ•´ä¸ªæ¨¡å—æ›´æ–°ã€‚è¿™ä½¿å¾—è¿­ä»£å·¥ä½œæ›´åŠ å¿«é€Ÿï¼Œä¾¿æ·ã€‚ ç¨³å®šæ€§ï¼šæ—¢ç„¶ç‰ˆæœ¬è¿­ä»£å¯ä»¥åˆ†å¼€æ¥å®ç°ï¼Œè¿™æ ·åœ¨å®è§‚ä¸Šæ¥è¯´å¤šæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§æ˜¯æœ‰å¥½å¤„çš„ã€‚å°±ç®—æ˜¯æµ‹è¯•ä¸åˆ°ä½ï¼Œå‘ç°bugï¼Œè¿™æ ·ä¹Ÿåªä¼šå½±å“æ›´æ–°çš„æ¨¡å—ï¼Œè€Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„é˜»å¡ï¼Œé›ªå´©ã€‚æ¯”å¦‚è´­ç‰©è½¦æ¨¡å—å‡ºé—®é¢˜ä¸ä¼šå½±å“ç”¨æˆ·ä¸‹å•åŠŸèƒ½ã€‚","categories":[{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/categories/SpringCloud/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/tags/SpringCloud/"}]},{"title":"SpringCloud - Gateway","slug":"Javaæ¡†æ¶/SpringCloud/SpringCloud - Gateway","date":"2020-03-04T15:08:29.343Z","updated":"2020-03-04T15:08:29.343Z","comments":true,"path":"2020/03/04/Javaæ¡†æ¶/SpringCloud/SpringCloud - Gateway/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E6%A1%86%E6%9E%B6/SpringCloud/SpringCloud%20-%20Gateway/","excerpt":"","text":"Spring Cloud Gateway Gatewayæ˜¯spring cloud æ¨å‡ºçš„æ–°çš„ç½‘å…³è·¯ç”±ï¼Œå®ƒå…³æ³¨äºå®‰å…¨æ€§ï¼Œç½‘å…³è·¯ç”±ï¼Œé™æµæ§åˆ¶ç­‰ï¼Œæ˜¯ç¬¬äºŒä»£ç½‘å…³è·¯ç”±å™¨ã€‚ Spring Cloud Gatewayä½¿ç”¨çš„æ˜¯Spring Bootå’ŒSpring Webfluxæä¾›çš„Nettyåº•å±‚ç¯å¢ƒï¼Œä¸èƒ½å’Œä¼ ç»Ÿçš„Servletå®¹å™¨ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½æ‰“åŒ…æˆä¸€ä¸ªWARåŒ…ã€‚ å¼•å…¥äº†ä¾èµ–é»˜è®¤å³å¼€å¯gatewayäº†ï¼Œå¦‚æœæš‚æ—¶ä¸æƒ³ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™å¯ä»¥é…ç½®spring.cloud.gateway.enabled=falseå³å¯ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependency&gt; (ä¸€)å·¥ä½œåŸç† å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°Spring Cloud Gatewayï¼ŒGateway Handler Mappingä¼šåŒ¹é…Routeæ˜ å°„åˆ†å‘åˆ°Gateway Web Handlerã€‚handlerä¼šå°†è¯·æ±‚ç»è¿‡ä¸€ç³»åˆ—çš„filterå¤„ç†ï¼Œä»£ç†è¯·æ±‚å‰ï¼Œä¼šæ‰§è¡Œå·¦å³çš„â€preâ€ filteré€»è¾‘ï¼Œä»£ç†è¯·æ±‚åï¼Œä¼šæ‰§è¡Œæ‰€æœ‰â€postâ€ filteré€»è¾‘ã€‚ (äºŒ)è°“è¯å·¥å‚ å»ºè®®ä»”ç»†é˜…è¯»: å®˜æ–¹æ–‡æ¡£1 å®˜æ–¹æ–‡æ¡£2 2.1 Datetime æ¥å—ä¸€ä¸ªæ—¶é—´å‚æ•°ï¼Œæ»¡è¶³æ—¶é—´æ¡ä»¶åè·¯ç”± æŠ€å·§ï¼šæ—¶é—´å¯ä½¿ç”¨ System.out.println(ZonedDateTime.now()); æ‰“å°ï¼Œç„¶åå³å¯çœ‹åˆ°æ—¶åŒºã€‚ä¾‹å¦‚ï¼š2019-09-29T16:50:42.579+08:00[Asia/Shanghai] æ—¶é—´æ ¼å¼çš„ç›¸å…³é€»è¾‘ï¼š é»˜è®¤æ—¶é—´æ ¼å¼ï¼šorg.springframework.format.support.DefaultFormattingConversionService#addDefaultFormatters æ—¶é—´æ ¼å¼æ³¨å†Œï¼šorg.springframework.format.datetime.standard.DateTimeFormatterRegistrar#regi Before Route Predicate Factory:ä½¿ç”¨æ—¶é—´ä½œä¸ºåŒ¹é…è§„åˆ™ï¼Œåªè¦å½“å‰æ—¶é—´å°äºè®¾å®šæ—¶é—´ï¼Œè·¯ç”±æ‰ä¼šåŒ¹é…è¯·æ±‚ã€‚ id:è¡¨ç¤ºè·¯ç”±åç§° uri:è·¯ç”±è½¬å‘çš„åœ°å€ predicates:æ–­è¨€è§„åˆ™ Before:è¡¨ç¤ºå½“å‰æ—¶é—´å°äºè®¾å®šæ—¶é—´ 123456789101112spring: cloud: gateway: routes: - id: before_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚æ—¶çš„æ—¶é—´Beforeé…ç½®çš„æ—¶é—´æ—¶ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # ç›®å‰é…ç½®ä¸ä¼šè¿›è¯¥è·¯ç”±é…ç½®ï¼Œæ‰€ä»¥è¿”å›404 # å°†æ—¶é—´æ”¹æˆ &gt; nowçš„æ—¶é—´ï¼Œåˆ™è®¿é—®localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Before&#x3D;2019-09-30T17:42:47.789-07:00[America&#x2F;Denver] After Route Predicate Factory:ä½¿ç”¨çš„æ˜¯æ—¶é—´ä½œä¸ºåŒ¹é…è§„åˆ™ï¼Œåªè¦å½“å‰æ—¶é—´å¤§äºè®¾å®šæ—¶é—´ï¼Œè·¯ç”±æ‰ä¼šåŒ¹é…è¯·æ±‚ id:è¡¨ç¤ºè·¯ç”±åç§° uri:è·¯ç”±è½¬å‘çš„åœ°å€ predicates:æ–­è¨€è§„åˆ™ After:è¡¨ç¤ºå¤§äºè®¾å®šæ—¶é—´ 123456789101112spring: cloud: gateway: routes: - id: after_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚æ—¶çš„æ—¶é—´Afteré…ç½®çš„æ—¶é—´æ—¶ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # ç›®å‰é…ç½®ä¸ä¼šè¿›è¯¥è·¯ç”±é…ç½®ï¼Œæ‰€ä»¥è¿”å›404 # å°†æ—¶é—´æ”¹æˆ &lt; nowçš„æ—¶é—´ï¼Œåˆ™è®¿é—®localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - After&#x3D;2030-01-20T17:42:47.789-07:00[America&#x2F;Denver] Between Route Predicate Factory:ä½¿ç”¨ä¸¤ä¸ªæ—¶é—´ä½œä¸ºåŒ¹é…è§„åˆ™ï¼Œåªè¦å½“å‰æ—¶é—´å¤§äºç¬¬ä¸€ä¸ªè®¾å®šæ—¶é—´ï¼Œå¹¶å°äºç¬¬äºŒä¸ªè®¾å®šæ—¶é—´ï¼Œè·¯ç”±æ‰ä¼šåŒ¹é…è¯·æ±‚ã€‚ id:è¡¨ç¤ºè·¯ç”±åç§° uri:è·¯ç”±è½¬å‘çš„åœ°å€ predicates:æ–­è¨€è§„åˆ™ Between:è¡¨ç¤ºå¤§äºç¬¬ä¸€ä¸ªè®¾å®šæ—¶é—´å¹¶å°äºç¬¬äºŒä¸ªè®¾å®šæ—¶é—´ 1234567891011spring: cloud: gateway: routes: - id: between_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚æ—¶çš„æ—¶é—´Betweené…ç½®çš„æ—¶é—´æ—¶ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # å› æ­¤ï¼Œè®¿é—®localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Between&#x3D;2019-01-20T17:42:47.789-07:00[America&#x2F;Denver], 2027-01-21T17:42:47.789-07:00[America&#x2F;Denver] 2.2 Cookie Cookie Route Predicate Factory:ä½¿ç”¨çš„æ˜¯cookieåå­—å’Œæ­£åˆ™è¡¨è¾¾å¼çš„valueä½œä¸ºä¸¤ä¸ªè¾“å…¥å‚æ•°ï¼Œè¯·æ±‚çš„cookieéœ€è¦åŒ¹é…cookieåå’Œç¬¦åˆå…¶ä¸­valueçš„æ­£åˆ™ã€‚ 1234567891011spring: cloud: gateway: routes: - id: cookie_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“å¸¦æœ‰åä¸ºsomecookieï¼Œå¹¶ä¸”å€¼ç¬¦åˆæ­£åˆ™ch.pçš„Cookieæ—¶ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # å¦‚Cookieæ»¡è¶³æ¡ä»¶ï¼Œåˆ™è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Cookie&#x3D;somecookie, ch.p 2.3 Header Header Route Predicate Factory:ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªheaderçš„nameï¼Œä¸€ä¸ªæ˜¯æ­£åˆ™åŒ¹é…çš„valueã€‚ è¯·æ±‚å¤´ headerä¸­å¸¦ X-Request-Idï¼Œä¸”å€¼ä¸ºæ•°å­—ï¼Œå…è®¸è·¯ç”±ã€‚ 1234567891011spring: cloud: gateway: routes: - id: header_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“å¸¦æœ‰åä¸ºX-Request-Idï¼Œå¹¶ä¸”å€¼ç¬¦åˆæ­£åˆ™\\d+çš„Headeræ—¶ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # å¦‚Headeræ»¡è¶³æ¡ä»¶ï¼Œåˆ™è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Header&#x3D;X-Request-Id, \\d+ 2.4 Host 1234567891011spring: cloud: gateway: routes: - id: host_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“åä¸ºHostçš„Headerç¬¦åˆ**.somehost.orgæˆ–**.anotherhost.orgæ—¶ï¼Œæ‰ä¼šè½¬å‘ç”¨æˆ·å¾®æœåŠ¡ # å¦‚Hostæ»¡è¶³æ¡ä»¶ï¼Œåˆ™è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Host&#x3D;**.somehost.org,**.anotherhost.org 2.5 Method 1234567891011spring: cloud: gateway: routes: - id: method_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“HTTPè¯·æ±‚æ–¹æ³•æ˜¯GETæ—¶ï¼Œæ‰ä¼šè½¬å‘ç”¨æˆ·å¾®æœåŠ¡ # å¦‚è¯·æ±‚æ–¹æ³•æ»¡è¶³æ¡ä»¶ï¼Œè®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;** -&gt; user-center&#x2F;** # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Method&#x3D;GET 2.6 Path å®˜æ–¹æ–‡æ¡£ï¼šsegmentå°æŠ€å·§ 1234567891011spring: cloud: gateway: routes: - id: path_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è®¿é—®è·¯å¾„æ˜¯&#x2F;users&#x2F;*æˆ–è€…&#x2F;some-path&#x2F;**ï¼Œæ‰ä¼šè½¬å‘ç”¨æˆ·å¾®æœåŠ¡ # segmentæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å ä½ç¬¦ï¼Œå•å±‚è·¯å¾„åŒ¹é… # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-center&#x2F;users&#x2F;1 - Path&#x3D;&#x2F;users&#x2F;&#123;segment&#125;,&#x2F;some-path&#x2F;** 2.7 Query ç¤ºä¾‹1ï¼š 12345678910spring: cloud: gateway: routes: - id: query_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚å¸¦æœ‰bazçš„å‚æ•°ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1?baz&#x3D;xx -&gt; user-centerçš„&#x2F;users&#x2F;1 - Query&#x3D;baz ç¤ºä¾‹2ï¼š 12345678910spring: cloud: gateway: routes: - id: query_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚å¸¦æœ‰åä¸ºfooçš„å‚æ•°ï¼Œä¸”å‚æ•°å€¼ç¬¦åˆæ­£åˆ™ba.ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1?baz&#x3D;baz -&gt; user-centerçš„&#x2F;users&#x2F;1?baz&#x3D;baz - Query&#x3D;foo, ba. 2.8 RemoteAddr å®˜æ–¹æ–‡æ¡£ï¼šä»£ç†çš„ipå°æŠ€å·§ XForwardedRemoteAddressResolver::trustAllå¾—åˆ°çš„RemoteAddressResolveræ€»æ˜¯è·å–X-Forwarded-Forçš„ç¬¬ä¸€ä¸ªipåœ°å€ä½œä¸ºremote addressï¼Œè¿™ç§æ–¹å¼å°±æ¯”è¾ƒå®¹æ˜“è¢«ä¼ªè£…çš„è¯·æ±‚æ¬ºéª—ï¼Œæ¨¡æ‹Ÿè¯·æ±‚å¾ˆå®¹æ˜“é€šè¿‡è®¾ç½®åˆå§‹çš„X-Forwarded-Forå¤´ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¬ºéª—åˆ°gatewayã€‚ XForwardedRemoteAddressResolver::maxTrustedIndexå¾—åˆ°çš„RemoteAddressResolveråˆ™ä¼šåœ¨X-Forwarded-Forä¿¡æ¯é‡Œé¢ï¼Œä»å³åˆ°å·¦é€‰æ‹©ä¿¡ä»»æœ€å¤šmaxTrustedIndexä¸ªipï¼Œå› ä¸ºX-Forwarded-Foræ˜¯è¶Šå¾€å³æ˜¯è¶Šæ¥è¿‘gatewayçš„ä»£ç†æœºå™¨ipï¼Œæ‰€ä»¥æ˜¯è¶Šå¾€å³çš„ipï¼Œä¿¡ä»»åº¦æ˜¯è¶Šé«˜çš„ã€‚ é‚£ä¹ˆå¦‚æœå‰é¢åªæ˜¯æŒ¡äº†ä¸€å±‚Nginxçš„è¯ï¼Œå¦‚æœåªéœ€è¦Nginxå‰é¢å®¢æˆ·ç«¯çš„ipï¼Œåˆ™maxTrustedIndexå–1ï¼Œå°±å¯ä»¥æ¯”è¾ƒå®‰å…¨åœ°è·å–çœŸå®å®¢æˆ·ç«¯ipã€‚ 12345678910spring: cloud: gateway: routes: - id: remoteaddr_route uri: lb:&#x2F;&#x2F;user-center predicates: # å½“ä¸”ä»…å½“è¯·æ±‚IPæ˜¯192.168.1.1&#x2F;24ç½‘æ®µï¼Œä¾‹å¦‚192.168.1.10ï¼Œæ‰ä¼šè½¬å‘åˆ°ç”¨æˆ·å¾®æœåŠ¡ # eg. è®¿é—®http:&#x2F;&#x2F;localhost:8040&#x2F;users&#x2F;1 -&gt; user-centerçš„&#x2F;users&#x2F;1 - RemoteAddr&#x3D;192.168.1.1&#x2F;24 2.9 Weigth Weight Route Predicate Factory: 12 (ä¸‰)è¿‡æ»¤å™¨å·¥å‚ Route Predicate å†³å®šè·¯ç”±åˆ°å“ªä¸ªè·¯å¾„ï¼Œé‚£ä¹ˆè¿‡æ»¤å™¨å°±æ˜¯å…è®¸ä¿®æ”¹HTTPè¯·æ±‚çš„ä¸€äº›å±æ€§ã€‚spring cloud å†…ç½®äº†ä¸€éƒ¨åˆ†è¿‡æ»¤å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨ 3.1. AddRequestHeader GatewayFilter Factory 3.2. AddRequestParameter GatewayFilter Factory 3.3. AddResponseHeader GatewayFilter Factory 3.4. DedupeResponseHeader GatewayFilter Factory 3.5. Hystrix GatewayFilter Factory 3.6. FallbackHeaders GatewayFilter Factory 3.7. MapRequestHeader GatewayFilter Factory 3.8. PrefixPath GatewayFilter Factory 3.9. PreserveHostHeader GatewayFilter Factory 3.10. RequestRateLimiter GatewayFilter Factory 3.11. RedirectTo GatewayFilter Factory 3.12. RemoveHopByHopHeadersFilter GatewayFilter Factory 3.13. RemoveRequestHeader GatewayFilter Factory 3.14. RemoveResponseHeader GatewayFilter Factory 3.15. RemoveRequestParameter GatewayFilter Factory 3.16. RewritePath GatewayFilter Factory 3.17. RewriteLocationResponseHeader GatewayFilter Factory 3.18. RewriteResponseHeader GatewayFilter Factory 3.19. SaveSession GatewayFilter Factory 3.20. SecureHeaders GatewayFilter Factory 3.21. SetPath GatewayFilter Factory 3.22. SetRequestHeader GatewayFilter Factory 3.23. SetResponseHeader GatewayFilter Factory 3.24. SetStatus GatewayFilter Factory 3.25. StripPrefix GatewayFilter Factory 3.26. Retry GatewayFilter Factory 3.27. RequestSize GatewayFilter Factory 3.28. Modify Request Body GatewayFilter Factory 3.29. Modify Response Body GatewayFilter Factory 3.30. Default Filters","categories":[{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/categories/SpringCloud/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/tags/SpringCloud/"},{"name":"Gateway","slug":"Gateway","permalink":"http://blog.tgyf.com/tags/Gateway/"}]},{"title":"SpringCloud - Eureka","slug":"Javaæ¡†æ¶/SpringCloud/SpringCloud - Eureka","date":"2020-03-04T14:56:55.247Z","updated":"2020-03-04T14:56:55.248Z","comments":true,"path":"2020/03/04/Javaæ¡†æ¶/SpringCloud/SpringCloud - Eureka/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E6%A1%86%E6%9E%B6/SpringCloud/SpringCloud%20-%20Eureka/","excerpt":"","text":"æœåŠ¡å‘ç°ä¹‹Eureka/Ribbon æ·±åº¦å‰–ææœåŠ¡å‘ç°ç»„ä»¶~Netflix Eureka https://zhuanlan.zhihu.com/p/24829766 æ·±å…¥ç†è§£Ribbonä¹‹æºç è§£æ https://blog.csdn.net/forezp/article/details/74820899 (ä¸€)Spring Cloud EurekaæœåŠ¡ç«¯ä¸»è¦é…ç½®é¡¹ é…ç½®å‚æ•°(eureka.server.*) é»˜è®¤å€¼ è¯´æ˜ enableSelfPreservation true å¯ç”¨æ³¨å†Œä¸­å¿ƒçš„è‡ªä¿æŠ¤æœºåˆ¶ï¼ŒEureka å¦‚æœç»Ÿè®¡åˆ°15åˆ†é’Ÿä¹‹å†…æŸå¤±&gt;15%çš„å¾®æœåŠ¡å¿ƒè·³ï¼Œåˆ™å°†ä¼šè§¦å‘è‡ªä¿æŠ¤æœºåˆ¶ï¼Œä¸å†å‰”é™¤æœåŠ¡æä¾›è€…ã€‚ waitTimeInMsWhenSyncEmpty 1000 * 60 * 5 åœ¨EurekaæœåŠ¡å™¨è·å–ä¸åˆ°é›†ç¾¤é‡Œå¯¹ç­‰æœåŠ¡å™¨ä¸Šçš„å®ä¾‹æ—¶ï¼Œéœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤ä¸º1000 * 60 * 5ã€‚å•æœºå¼€å‘æ¨¡å¼å»ºè®®è®¾ç½®ä¸º0ã€‚ (äºŒ)Spring Cloud Eurekaå®¢æˆ·ç«¯ä¸»è¦é…ç½®é¡¹ é…ç½®å‚æ•°(eureka.client.*) é»˜è®¤å€¼ è¯´æ˜ serviceUrl æŒ‡å®šæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œç±»å‹ä¸º HashMapï¼Œå¹¶è®¾ç½®æœ‰ä¸€ç»„é»˜è®¤å€¼ï¼Œé»˜è®¤çš„Keyä¸ºdefaultZoneï¼›é»˜è®¤çš„Valueä¸º http://localhost:8761/eureka ï¼Œå¦‚æœæœåŠ¡æ³¨å†Œä¸­å¿ƒä¸ºé«˜å¯ç”¨é›†ç¾¤æ—¶ï¼Œå¤šä¸ªæ³¨å†Œä¸­å¿ƒåœ°å€ä»¥é€—å·åˆ†éš”ã€‚å¦‚æœæœåŠ¡æ³¨å†Œä¸­å¿ƒåŠ å…¥äº†å®‰å…¨éªŒè¯ï¼Œè¿™é‡Œé…ç½®çš„åœ°å€æ ¼å¼ä¸ºï¼šhttp://:@localhost:8761/eureka å…¶ä¸­ ä¸ºå®‰å…¨æ ¡éªŒçš„ç”¨æˆ·åï¼› ä¸ºè¯¥ç”¨æˆ·çš„å¯†ç  fetchRegistry true æ˜¯å¦ä»EurekaæœåŠ¡ç«¯è·å–æ³¨å†Œä¿¡æ¯ registryFetchIntervalSeconds 30 ä»EurekaæœåŠ¡ç«¯è·å–æ³¨å†Œä¿¡æ¯çš„é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ registerWithEureka true æ˜¯å¦è¦å°†è‡ªèº«çš„å®ä¾‹ä¿¡æ¯æ³¨å†Œåˆ°EurekaæœåŠ¡ç«¯ (ä¸‰)Spring Cloud Eurekaå®ä¾‹ä¸»è¦é…ç½®é¡¹ é…ç½®å‚æ•°(eureka.instance.*) é»˜è®¤å€¼ è¯´æ˜ leaseRenewalIntervalInSeconds 30 Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ leaseExpirationDurationInSeconds 90 EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³ä¹‹åç­‰å¾…çš„è¿‡æœŸæ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’ã€‚è¶…è¿‡è¯¥æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œåˆ™æœåŠ¡ç«¯ä¼šå°†è¯¥æœåŠ¡å®ä¾‹ä»æœåŠ¡æ¸…å•ä¸­å‰”é™¤ï¼Œä»è€Œç¦æ­¢æœåŠ¡è°ƒç”¨è¯·æ±‚è¢«å‘é€åˆ°è¯¥å®ä¾‹ä¸Š appname æœåŠ¡åï¼Œé»˜è®¤å–spring.application.nameçš„é…ç½®å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸ºunknown hostname ä¸»æœºåï¼Œä¸é…ç½®çš„æ—¶å€™å°†æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸»æœºåæ¥è·å– instance-id ä¸»æœºå æ³¨å†Œåˆ°eurekaçš„å®ä¾‹idï¼Œæ¨èspring.cloud.client.ipaddress:{spring.cloud.client.ipaddress}:spring.cloud.client.ipaddress:{spring.application.name}ğŸ˜’{server.port} (å››)Spring Cloud Ribbonä¸»è¦é…ç½®é¡¹ é…ç½®å‚æ•°({svc}.ribbon.*) é»˜è®¤å€¼ è¯´æ˜ ConnectionTimeout 1000ms è¿æ¥è¶…æ—¶æ—¶é—´ ReadTimeout 1000ms è¯»å–è¶…æ—¶æ—¶é—´ ServerListRefreshInterval 30ç§’ åˆ·æ–°æœåŠ¡åˆ—è¡¨æºçš„é—´éš”æ—¶é—´ NFLoadBalancerClassName com.netflix.loadbalancer.ZoneAwareLoadBalancer å®šåˆ¶ILoadBalancerå®ç° NFLoadBalancerRuleClassName com.netflix.loadbalancer.ZoneAvoidanceRule å®šåˆ¶IRuleå®ç° NFLoadBalancerPingClassName com.netflix.loadbalancer.DummyPing å®šåˆ¶IPing NIWSServerListClassName com.netflix.loadbalancer.ConfigurationBasedServerList å®šåˆ¶ServerList ServerListUpdateClassName com.netflix.loadbalancer.PollingServerListUpdater å®šåˆ¶ServerListUpdater NIWSServerListFilterClassName com.netflix.loadbalancer.ZonePreferenceServerListFilter å®šåˆ¶SeverListFilter (äº”)Spring Cloud Eureka è‡ªä¿æŠ¤æ¨¡å¼ ç¿»å¢™æŸ¥é˜…ï¼šhttps://medium.com/@fahimfarookme/the-mystery-of-eureka-self-preservation-c7aa0ed1b799 (å…­)å¥åº·æ£€æŸ¥å’Œè“ç»¿å‘å¸ƒ çŠ¶æ€APIä¾‹å­ï¼š PUT /eureka/apps/{appId}/{instanceId}?status=UP PUT /eureka/apps/ORDER-SERVICE/localhost:order-service:8886?status=UP PUT /eureka/apps/{app id}/{instance id}/status?value={status} DELETE /eureka/apps/{app id}/{instance id}/status PUT /eureka/apps/ORDER-SERVICE/localhost:order-service:8886/status?value=OUT_OF_SERVICE HealthCheckHandlerï¼š å®šåˆ¶æ³¨å†Œ EurekaClient#registerHealthCheck Spring Cloud eureka.client.healthcheck.enabled=true EurekaHealthCheckHandler DiskSpaceHealthIndicator RefreshScopeHealthIndicator HystrixHealthIndicator Ribbonè½¯è´Ÿè½½å®ä¾‹ä¿¡æ¯æ›´æ–°å»¶è¿Ÿï¼š æ³¨å†Œå»¶æ—¶ï¼ˆ30ç§’ï¼‰ EurekaæœåŠ¡å™¨å“åº”å»¶è¿Ÿï¼ˆ30ç§’ï¼‰ Eurekaå®¢æˆ·ç«¯æ›´æ–°å»¶è¿Ÿï¼ˆ30ç§’ï¼‰ RibbonæœåŠ¡åˆ—è¡¨æ›´æ–°å»¶è¿Ÿï¼ˆ30ç§’ï¼‰ æœ€å¤§å¯èƒ½æœ‰2åˆ†é’Ÿå»¶è¿Ÿ æµ‹è¯• é…ç½®æœåŠ¡å¯åŠ¨ç«¯ ç¬¬ä¸€æ¬¡è¿è¡Œä½¿ç”¨8081æœåŠ¡å™¨ç«¯å£ 12server.port&#x3D;8081eureka.client.service-url.defaultZone&#x3D;http:&#x2F;&#x2F;localhost:8082&#x2F;eureka&#x2F; ç¬¬äºŒæ¬¡è¿è¡Œä½¿ç”¨8082æœåŠ¡å™¨ç«¯å£ 12server.port&#x3D;8082eureka.client.service-url.defaultZone&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;eureka&#x2F; UIæ ¡éªŒï¼š 12http:&#x2F;&#x2F;localhost:8081&#x2F;http:&#x2F;&#x2F;localhost:8082&#x2F; APIæ ¡éªŒï¼š 12http:&#x2F;&#x2F;localhost:8081&#x2F;eureka&#x2F;appshttp:&#x2F;&#x2F;localhost:8082&#x2F;eureka&#x2F;apps","categories":[{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/categories/SpringCloud/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/tags/SpringCloud/"},{"name":"Eureka","slug":"Eureka","permalink":"http://blog.tgyf.com/tags/Eureka/"}]},{"title":"JVMè°ƒä¼˜åˆ°åº•è°ƒä»€ä¹ˆæ€ä¹ˆè°ƒ?","slug":"Javaè™šæ‹Ÿæœº/JVMè°ƒä¼˜åˆ°åº•è°ƒä»€ä¹ˆæ€ä¹ˆè°ƒ","date":"2020-03-04T14:32:18.344Z","updated":"2020-03-04T14:32:18.344Z","comments":true,"path":"2020/03/04/Javaè™šæ‹Ÿæœº/JVMè°ƒä¼˜åˆ°åº•è°ƒä»€ä¹ˆæ€ä¹ˆè°ƒ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/JVM%E8%B0%83%E4%BC%98%E5%88%B0%E5%BA%95%E8%B0%83%E4%BB%80%E4%B9%88%E6%80%8E%E4%B9%88%E8%B0%83/","excerpt":"","text":"è°ƒä¼˜ä¸‰æ­¥æ›²(å‘ç°/åˆ†æ/è§£å†³) é€šè¿‡ç›‘æ§, å®¢æˆ·, è€æ¿å¾—çŸ¥é—®é¢˜ åˆ†æå®šä½é—®é¢˜ è°ƒä¼˜è§£å†³é—®é¢˜ å‘ç° JVMæ€§èƒ½æŒ‡æ ‡ JVMæ€§èƒ½æŒ‡æ ‡ç®€å•è¯´æœ‰ä¸‰ç‚¹ï¼šCPUã€IOã€å†…å­˜ åŸºæœ¬æ£€æµ‹å·¥å…· CPUæ£€æµ‹å·¥å…· 12top, vmstat, ps, jpstop -Hp &lt;pid&gt; IOæ£€æµ‹å·¥å…· 1vmstat,netstat, iostat , pidstat å†…å­˜(JVMå†…å­˜)æ£€æµ‹å·¥å…· 1234567891011jps -lvm æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸‹javaåº”ç”¨è¿›ç¨‹jinfo &lt;pid&gt; æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯åŠjvmåƒåœ¾å›æ”¶å‚æ•°jstat -gcutil &lt;pid&gt; period count jvmç»Ÿè®¡ä¿¡æ¯ç›‘æ§jmap -heap &lt;pid&gt; å†…å­˜æ˜ å°„å·¥å…·jhat jstack -l &lt;pid&gt; å †æ ˆè·Ÿè¸ªå·¥å…·jcmdjvisualvm jconsolejmcgcview gclogå›¾å½¢åŒ–æŸ¥çœ‹ åˆ†æ/è§£å†³ æƒ…æ™¯ä¸€ï¼šå†…å­˜æ³„æ¼ Java heap space java.lang.OutOfMemoryError:Java heap space Java heap spaceï¼ŒJavaåº”ç”¨ç¨‹åºåˆ›å»ºçš„å¯¹è±¡å­˜æ”¾åœ¨è¿™ç‰‡åŒºåŸŸï¼Œåƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ä¹Ÿå‘ç”Ÿåœ¨è¿™å—åŒºåŸŸã€‚å¯¼è‡´è¯¥å¼‚å¸¸é€šå¸¸æœ‰ï¼šåˆ›å»ºå¤§é‡çš„å¯¹è±¡ï¼Œå±‚æ¬¡æ¯”è¾ƒæ·±çš„é€’å½’æ“ä½œç­‰ã€‚ è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§: ä¸€æ˜¯ä¼˜åŒ–åº”ç”¨ï¼Œæ‰¾åˆ°æ¶ˆè€—å¤§é‡å†…å­˜çš„åœ°æ–¹ï¼Œç„¶åä¼˜åŒ–ä»£ç æˆ–è€…ç®—æ³•ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒæ¨èï¼Œä½†æ˜¯éš¾åº¦æ¯”è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°è¿™ç§é—®é¢˜ï¼Œå¼€å‘äººå‘˜ä¸èƒ½å¾ˆå¥½çš„é‡ç°é—®é¢˜ã€‚ ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯æå‡Java heap sizeï¼Œè¿™ç§æ–¹å¼è™½ç„¶æ„Ÿè§‰æœ‰ç‚¹æ²»æ ‡ä¸æ²»æœ¬ï¼Œä½†æ˜¯å¯è¡Œæ€§éå¸¸é«˜ï¼Œæ“ä½œç®€å•ã€‚ å¯¹äºä¸€èˆ¬çš„åº”ç”¨ï¼Œé‡‡ç”¨å¦‚ä¸‹æ–¹å¼å³å¯ï¼ˆæ•°å­—æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´ï¼‰ï¼š -Xms -Set initial Java heap size -Xmx -Set maximum Java heap size å¦‚: java -Xms512m -Xmx1024m JavaApp å¦‚æœæ˜¯åœ¨tomcatä¸­ï¼Œå‡ºç°çš„è¿™ç§é—®é¢˜ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨{tomcat_dir}/bin/catalina.batåŠ ä¸Šä¸€è¡Œï¼ˆå†…å­˜è®¾ç½®å¤§å°æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´ï¼‰ï¼š set CATALINA_OPTS=-Xms512m -Xmx512m æƒ…æ™¯äºŒï¼šå†…å­˜æ³„æ¼ PermGen space java.lang.OutOfMemoryError:PermGen space Perm Gen Sizeï¼ˆPermanent Generation Sizeï¼‰ï¼Œç”¨æ¥å­˜å‚¨è¢«åŠ è½½çš„ç±»çš„å®šä¹‰ï¼ˆclass definitionï¼‰å’Œå…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼Œæ¯”å¦‚ï¼šClass Objectå’ŒMethod Objectç­‰ã€‚è¿™æ˜¯å†…å­˜ä¸­çš„ä¸€å—æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼ŒJVMçš„åƒåœ¾å›æ”¶ä¸ä¼šè§¦åŠè¿™å—åŒºåŸŸã€‚é€šå¸¸åœ¨åŠ è½½ä¸€ä¸ªå¤§é¡¹ç›®çš„æ—¶å€™æ‰ä¼šå‡ºç°è¯¥å¼‚å¸¸ã€‚ å¯¹äºä¸€èˆ¬çš„åº”ç”¨ï¼Œé‡‡ç”¨å¦‚ä¸‹æ–¹å¼å³å¯ï¼ˆæ•°å­—æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´ï¼‰ï¼š -XX:PermSize -Set initial PermGen Size. -XX:MaxPermSize -Set the maximum PermGen Size. å¦‚: java -XX:PermSize=64m -XX:MaxPermSize=128m JavaApp å¦‚æœæ˜¯åœ¨tomcatä¸­å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨{tomcat_dir}/bin/catalina.batä¸­æ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼š set CATALINA_OPTS=-server -Xms256m -Xmx1024m -XX:PermSize=512m -XX:MaxPermSize=512m æƒ…æ™¯ä¸‰ï¼šå†…å­˜æ³„æ¼ Metaspace java.lang.OutOfMemoryError:Metaspace åœ¨Java8ä¸­,å°†ä¹‹å‰PermGen ä¸­çš„æ‰€æœ‰å†…å®¹, éƒ½ç§»åˆ°äº†Metaspace ç©ºé—´ã€‚ ä¾‹å¦‚: class åç§°, å­—æ®µ, æ–¹æ³•, å­—èŠ‚ç , å¸¸é‡æ± , JITä¼˜åŒ–ä»£ç , ç­‰ç­‰ã€‚ -XX:MaxMetaspaceSize=64m æƒ…æ™¯ä¸‰ï¼šå†…å­˜æ³„æ¼ GC overhead limit exceeded java.lang.OutOfMemoryError:GC overhead limit exceeded è¿™ä¸ªé”™è¯¯ä¼šå‡ºç°åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼šGCå ç”¨äº†å¤šäº98%ï¼ˆé»˜è®¤å€¼ï¼‰çš„CPUæ—¶é—´å´åªå›æ”¶äº†å°‘äº2%ï¼ˆé»˜è®¤å€¼ï¼‰çš„å †ç©ºé—´ã€‚ç›®çš„æ˜¯ä¸ºäº†è®©åº”ç”¨ç»ˆæ­¢ï¼Œç»™å¼€å‘è€…æœºä¼šå»è¯Šæ–­é—®é¢˜ã€‚ ä¸€èˆ¬æ˜¯åº”ç”¨ç¨‹åºåœ¨æœ‰é™çš„å†…å­˜ä¸Šåˆ›å»ºäº†å¤§é‡çš„ä¸´æ—¶å¯¹è±¡æˆ–è€…å¼±å¼•ç”¨å¯¹è±¡ï¼Œä»è€Œå¯¼è‡´è¯¥å¼‚å¸¸ã€‚è™½ç„¶åŠ å¤§å†…å­˜å¯ä»¥æš‚æ—¶è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯å¼ºçƒˆå»ºè®®å»ä¼˜åŒ–ä»£ç ï¼Œåè€…æ›´åŠ æœ‰æ•ˆã€‚ é¦–å…ˆï¼Œä½ å¯ä»¥å…³é—­JVMè¿™ä¸ªé»˜è®¤çš„ç­–ç•¥ï¼šjava -XX:-UseGCOverheadLimit JavaApp å…¶æ¬¡ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•å»åŠ å¤§Heap Sizeï¼šjava -Xmx512m JavaApp JVMå¯åŠ¨å‚æ•° æ ‡å‡†å‚æ•° å‚æ•° å‚æ•°è¯´æ˜ -version -Dkey=value -Dfile.encoding=UTF-8 ç”¨äºæŒ‡å®šæ–‡ä»¶ç¼–ç æ ¼å¼ -Djava.awt.headless=true #Headlessæ¨¡å¼æ˜¯ç³»ç»Ÿçš„ä¸€ç§é…ç½®æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿç¼ºå°‘äº†æ˜¾ç¤ºè®¾å¤‡ã€é”®ç›˜æˆ–é¼ æ ‡ã€‚ -Djava.library.path=/bin/native æŒ‡å®šéjavaç±»åŒ…çš„ä½ç½®ï¼ˆå¦‚ï¼šdllï¼Œsoï¼‰ -Djava.security.egd=file:/dev/./urandom ä½¿ç”¨ä¼ªéšæœºæ•°-verbose:classè¾“å‡ºjvmè½½å…¥ç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œå½“jvmæŠ¥å‘Šè¯´æ‰¾ä¸åˆ°ç±»æˆ–è€…ç±»å†²çªæ—¶å¯æ­¤è¿›è¡Œè¯Šæ–­ã€‚ -verbose:gc è¾“å‡ºæ¯æ¬¡GCçš„ç›¸å…³æƒ…å†µã€‚ -verbose:jni è¾“å‡ºnativeæ–¹æ³•è°ƒç”¨çš„ç›¸å…³æƒ…å†µï¼Œä¸€èˆ¬ç”¨äºè¯Šæ–­jniè°ƒç”¨é”™è¯¯ä¿¡æ¯ã€‚ éæ ‡å‡†å‚æ•° -X å‚æ•° å‚æ•°è¯´æ˜ -Xmsn æŒ‡å®šjvmå †çš„åˆå§‹å¤§å°ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å°ä¸º1Mï¼›å¯ä»¥æŒ‡å®šå•ä½ï¼Œæ¯”å¦‚kã€mï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºå­—èŠ‚ã€‚ -Xmxn æŒ‡å®šjvmå †çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4æˆ–è€…1Gï¼Œæœ€å°ä¸º2Mï¼›å•ä½ä¸-Xmsä¸€è‡´ã€‚ -Xmnn æŒ‡å®šjvmå †ä¸­å¹´è½»ä»£çš„å¤§å° -Xssn è®¾ç½®å•ä¸ªçº¿ç¨‹æ ˆçš„å¤§å°ï¼Œä¸€èˆ¬é»˜è®¤ä¸º512kã€‚ -Xint è®¾ç½®jvmä»¥è§£é‡Šæ¨¡å¼è¿è¡Œï¼Œæ‰€æœ‰çš„å­—èŠ‚ç å°†è¢«ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸ä¼šç¼–è¯‘æˆæœ¬åœ°ç ã€‚ -Xbatch å…³é—­åå°ä»£ç ç¼–è¯‘ï¼Œå¼ºåˆ¶åœ¨å‰å°ç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆä¹‹åæ‰èƒ½è¿›è¡Œä»£ç æ‰§è¡Œï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œjvmåœ¨åå°è¿›è¡Œç¼–è¯‘ï¼Œè‹¥æ²¡æœ‰ç¼–è¯‘å®Œæˆï¼Œåˆ™å‰å°è¿è¡Œä»£ç æ—¶ä»¥è§£é‡Šæ¨¡å¼è¿è¡Œã€‚ -Xbootclasspath:bootclasspath è®©jvmä»æŒ‡å®šè·¯å¾„ï¼ˆå¯ä»¥æ˜¯åˆ†å·åˆ†éš”çš„ç›®å½•ã€jarã€æˆ–è€…zipï¼‰ä¸­åŠ è½½bootclassï¼Œç”¨æ¥æ›¿æ¢jdkçš„rt.jarï¼›è‹¥éå¿…è¦ï¼Œä¸€èˆ¬ä¸ä¼šç”¨åˆ°ï¼› -Xbootclasspath/a:path å°†æŒ‡å®šè·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶è¿½åŠ åˆ°é»˜è®¤bootstrapè·¯å¾„ä¸­ï¼› -Xbootclasspath/p:path è®©jvmä¼˜å…ˆäºbootstrapé»˜è®¤è·¯å¾„åŠ è½½æŒ‡å®šè·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶ï¼› -Xcheck:jni å¯¹JNIå‡½æ•°è¿›è¡Œé™„åŠ checkï¼›æ­¤æ—¶jvmå°†æ ¡éªŒä¼ é€’ç»™JNIå‡½æ•°å‚æ•°çš„åˆæ³•æ€§ï¼Œåœ¨æœ¬åœ°ä»£ç ä¸­é‡åˆ°éæ³•æ•°æ®æ—¶ï¼Œjmvå°†æŠ¥ä¸€ä¸ªè‡´å‘½é”™è¯¯è€Œç»ˆæ­¢ï¼›ä½¿ç”¨è¯¥å‚æ•°åå°†é€ æˆæ€§èƒ½ä¸‹é™ï¼Œè¯·æ…ç”¨ã€‚ -Xfuture è®©jvmå¯¹ç±»æ–‡ä»¶æ‰§è¡Œä¸¥æ ¼çš„æ ¼å¼æ£€æŸ¥ï¼ˆé»˜è®¤jvmä¸è¿›è¡Œä¸¥æ ¼æ ¼å¼æ£€æŸ¥ï¼‰ï¼Œä»¥ç¬¦åˆç±»æ–‡ä»¶æ ¼å¼è§„èŒƒï¼Œæ¨èå¼€å‘äººå‘˜ä½¿ç”¨è¯¥å‚æ•°ã€‚ -Xnoclassgc å…³é—­é’ˆå¯¹classçš„gcåŠŸèƒ½ï¼›å› ä¸ºå…¶é˜»æ­¢å†…å­˜å›æ”¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´OutOfMemoryErroré”™è¯¯ï¼Œæ…ç”¨ï¼› -Xincgc å¼€å¯å¢é‡gcï¼ˆé»˜è®¤ä¸ºå…³é—­ï¼‰ï¼›è¿™æœ‰åŠ©äºå‡å°‘é•¿æ—¶é—´GCæ—¶åº”ç”¨ç¨‹åºå‡ºç°çš„åœé¡¿ï¼›ä½†ç”±äºå¯èƒ½å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šé™ä½CPUå¯¹åº”ç”¨çš„å¤„ç†èƒ½åŠ›ã€‚ -Xloggc:file ä¸-verbose:gcåŠŸèƒ½ç±»ä¼¼ï¼Œåªæ˜¯å°†æ¯æ¬¡GCäº‹ä»¶çš„ç›¸å…³æƒ…å†µè®°å½•åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶çš„ä½ç½®æœ€å¥½åœ¨æœ¬åœ°ï¼Œä»¥é¿å…ç½‘ç»œçš„æ½œåœ¨é—®é¢˜ã€‚è‹¥ä¸verboseå‘½ä»¤åŒæ—¶å‡ºç°åœ¨å‘½ä»¤è¡Œä¸­ï¼Œåˆ™ä»¥-Xloggcä¸ºå‡†ã€‚ æ‰©å±•å‚æ•°ï¼ŒéStable -XX è¡Œä¸ºå‚æ•° å‚æ•° å‚æ•°è¯´æ˜ -XX:-DisableExplicitGC ç¦æ­¢è°ƒç”¨System.gc()ï¼›ä½†jvmçš„gcä»ç„¶æœ‰æ•ˆ -XX:+MaxFDLimit æœ€å¤§åŒ–æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡é™åˆ¶ -XX:+ScavengeBeforeFullGC æ–°ç”Ÿä»£GCä¼˜å…ˆäºFull GCæ‰§è¡Œ -XX:+UseGCOverheadLimit åœ¨æŠ›å‡ºOOMä¹‹å‰é™åˆ¶jvmè€—è´¹åœ¨GCä¸Šçš„æ—¶é—´æ¯”ä¾‹ -XX:-UseConcMarkSweepGC å¯¹è€ç”Ÿä»£é‡‡ç”¨å¹¶å‘æ ‡è®°äº¤æ¢ç®—æ³•è¿›è¡ŒGC -XX:-UseParallelGC å¯ç”¨å¹¶è¡ŒGC -XX:-UseParallelOldGC å¯¹Full GCå¯ç”¨å¹¶è¡Œï¼Œå½“-XX:-UseParallelGCå¯ç”¨æ—¶è¯¥é¡¹è‡ªåŠ¨å¯ç”¨ -XX:-UseSerialGC å¯ç”¨ä¸²è¡ŒGC -XX:+UseThreadPriorities å¯ç”¨æœ¬åœ°çº¿ç¨‹ä¼˜å…ˆçº§ æ€§èƒ½è°ƒä¼˜å‚æ•° å‚æ•° å‚æ•°è¯´æ˜ -XX:LargePageSizeInBytes=4m è®¾ç½®ç”¨äºJavaå †çš„å¤§é¡µé¢å°ºå¯¸ -XX:MaxHeapFreeRatio=70 GCåjavaå †ä¸­ç©ºé—²é‡å çš„æœ€å¤§æ¯”ä¾‹ -XX:MaxNewSize=size æ–°ç”Ÿæˆå¯¹è±¡èƒ½å ç”¨å†…å­˜çš„æœ€å¤§å€¼ -XX:MaxPermSize=64m è€ç”Ÿä»£å¯¹è±¡èƒ½å ç”¨å†…å­˜çš„æœ€å¤§å€¼ -XX:MinHeapFreeRatio=40 GCåjavaå †ä¸­ç©ºé—²é‡å çš„æœ€å°æ¯”ä¾‹ -XX:NewRatio=2 è€å¹´ä»£å†…å­˜å®¹é‡ä¸æ–°ç”Ÿä»£å†…å­˜å®¹é‡çš„æ¯”ä¾‹ï¼Œæ­¤å¤„è¡¨ç¤ºæ–°ç”Ÿä»£ä¸º1/3ï¼Œè€å¹´ä»£ä¸º2/3ã€‚ -XX:SurvivorRatio=3 æ–°ç”Ÿä»£ä¸­edenåŒºå’ŒsurvivoråŒºçš„æ¯”ä¾‹ï¼Œæ­¤å¤„è¡¨ç¤ºEden:survivor:survivor=3:1:1ï¼Œå³Edenå æ–°ç”Ÿä»£2/5ã€‚ -XX:NewSize=2.125m æ–°ç”Ÿä»£å¯¹è±¡ç”Ÿæˆæ—¶å ç”¨å†…å­˜çš„é»˜è®¤å€¼-XX:PretenureSizeThresholdå¤§äºè¿™ä¸ªè®¾ç½®å€¼(å•ä½ï¼šbyte)çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚ -XX:MaxTenuringThreshold å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º15å²ï¼‰,å¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„å¹´é¾„ã€‚(åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š) -XX:ReservedCodeCacheSize=32m ä¿ç•™ä»£ç å ç”¨çš„å†…å­˜å®¹é‡ -XX:ThreadStackSize=512 è®¾ç½®çº¿ç¨‹æ ˆå¤§å°ï¼Œè‹¥ä¸º0åˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼ -XX:+UseLargePages ä½¿ç”¨å¤§é¡µé¢å†…å­˜ è°ƒè¯•å‚æ•° å‚æ•° å‚æ•°è¯´æ˜ -XX:-CITime æ‰“å°æ¶ˆè€—åœ¨JITç¼–è¯‘çš„æ—¶é—´ -XX:ErrorFile=./hs_err_pid.log ä¿å­˜é”™è¯¯æ—¥å¿—æˆ–è€…æ•°æ®åˆ°æ–‡ä»¶ä¸­ -XX:-ExtendedDTraceProbes å¼€å¯solarisç‰¹æœ‰çš„dtraceæ¢é’ˆ -XX:HeapDumpPath=./java_pid.hprof æŒ‡å®šå¯¼å‡ºå †ä¿¡æ¯æ—¶çš„è·¯å¾„æˆ–æ–‡ä»¶å -XX:-HeapDumpOnOutOfMemoryError å½“é¦–æ¬¡é­é‡OOMæ—¶å¯¼å‡ºæ­¤æ—¶å †ä¸­ç›¸å…³ä¿¡æ¯ -XX:OnError=&quot;;&quot; å‡ºç°è‡´å‘½ERRORä¹‹åè¿è¡Œè‡ªå®šä¹‰å‘½ä»¤ -XX:OnOutOfMemoryError=&quot;;&quot; å½“é¦–æ¬¡é­é‡OOMæ—¶æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ -XX:-PrintClassHistogram é‡åˆ°Ctrl-Breakåæ‰“å°ç±»å®ä¾‹çš„æŸ±çŠ¶ä¿¡æ¯ï¼Œä¸jmap -histoåŠŸèƒ½ç›¸åŒ -XX:-PrintConcurrentLocks é‡åˆ°Ctrl-Breakåæ‰“å°å¹¶å‘é”çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸jstack -låŠŸèƒ½ç›¸åŒ -XX:-PrintCommandLineFlags æ‰“å°åœ¨å‘½ä»¤è¡Œä¸­å‡ºç°è¿‡çš„æ ‡è®° -XX:-PrintCompilation å½“ä¸€ä¸ªæ–¹æ³•è¢«ç¼–è¯‘æ—¶æ‰“å°ç›¸å…³ä¿¡æ¯ -XX:-PrintGC æ¯æ¬¡GCæ—¶æ‰“å°ç›¸å…³ä¿¡æ¯ -XX:-PrintGCDetails æ¯æ¬¡GCæ—¶æ‰“å°è¯¦ç»†ä¿¡æ¯ -XX:-PrintGCTimeStamps æ‰“å°æ¯æ¬¡GCçš„æ—¶é—´æˆ³ -XX:-TraceClassLoading è·Ÿè¸ªç±»çš„åŠ è½½ä¿¡æ¯ -XX:-TraceClassLoadingPreorder è·Ÿè¸ªè¢«å¼•ç”¨åˆ°çš„æ‰€æœ‰ç±»çš„åŠ è½½ä¿¡æ¯ -XX:-TraceClassResolution è·Ÿè¸ªå¸¸é‡æ±  -XX:-TraceClassUnloading è·Ÿè¸ªç±»çš„å¸è½½ä¿¡æ¯ -XX:-TraceLoaderConstraints è·Ÿè¸ªç±»åŠ è½½å™¨çº¦æŸçš„ç›¸å…³ä¿¡æ¯ JVM GCæ—¥å¿—æŸ¥çœ‹ å¼€å¯GCæ—¥å¿— 12345678910111213141516-verbose:gc -Djava.awt.headless=true -DAPP_NAME=myapp-Dcom.sun.management.jmxremote-Dcom.sun.management.jmxremote.port=20189 -Dcom.sun.management.jmxremote.authenticate=false-Dcom.sun.management.jmxremote.ssl=false-XX:NewRatio=1 -XX:SurvivorRatio=2 -XX:+PrintGCApplicationStoppedTime -XX:+PrintReferenceGC -Xloggc:gc.log -XX:+PrintCommandLineFlags -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=.-XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps jstat çœ‹æ‡‚GCæ—¥å¿— https://blog.csdn.net/renfufei/article/details/54885190 Option Displays Ex class ç”¨äºæŸ¥çœ‹ç±»åŠ è½½æƒ…å†µçš„ç»Ÿè®¡ jstat -class pid:æ˜¾ç¤ºåŠ è½½classçš„æ•°é‡ï¼ŒåŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯ã€‚ compiler æŸ¥çœ‹HotSpotä¸­å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æƒ…å†µçš„ç»Ÿè®¡ jstat -compiler pid:æ˜¾ç¤ºVMå®æ—¶ç¼–è¯‘çš„æ•°é‡ç­‰ä¿¡æ¯ã€‚ gc æŸ¥çœ‹JVMä¸­å †çš„åƒåœ¾æ”¶é›†æƒ…å†µçš„ç»Ÿè®¡ jstat -gc pid:å¯ä»¥æ˜¾ç¤ºgcçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹gcçš„æ¬¡æ•°ï¼ŒåŠæ—¶é—´ã€‚å…¶ä¸­æœ€åäº”é¡¹ï¼Œåˆ†åˆ«æ˜¯young gcçš„æ¬¡æ•°ï¼Œyoung gcçš„æ—¶é—´ï¼Œfull gcçš„æ¬¡æ•°ï¼Œfull gcçš„æ—¶é—´ï¼Œgcçš„æ€»æ—¶é—´ã€‚ gccapacity æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä¹…ä»£çš„å­˜å‚¨å®¹é‡æƒ…å†µ jstat -gccapacity:å¯ä»¥æ˜¾ç¤ºï¼ŒVMå†…å­˜ä¸­ä¸‰ä»£ï¼ˆyoung,old,permï¼‰å¯¹è±¡çš„ä½¿ç”¨å’Œå ç”¨å¤§å° gccause æŸ¥çœ‹åƒåœ¾æ”¶é›†çš„ç»Ÿè®¡æƒ…å†µï¼ˆè¿™ä¸ªå’Œ-gcutilé€‰é¡¹ä¸€æ ·ï¼‰ï¼Œå¦‚æœæœ‰å‘ç”Ÿåƒåœ¾æ”¶é›†ï¼Œå®ƒè¿˜ä¼šæ˜¾ç¤ºæœ€åä¸€æ¬¡åŠå½“å‰æ­£åœ¨å‘ç”Ÿåƒåœ¾æ”¶é›†çš„åŸå› ã€‚ jstat -gccause:æ˜¾ç¤ºgcåŸå›  gcnew æŸ¥çœ‹æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†çš„æƒ…å†µ jstat -gcnew pid:newå¯¹è±¡çš„ä¿¡æ¯ gcnewcapacity ç”¨äºæŸ¥çœ‹æ–°ç”Ÿä»£çš„å­˜å‚¨å®¹é‡æƒ…å†µ jstat -gcnewcapacity pid:newå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡ gcold ç”¨äºæŸ¥çœ‹è€ç”Ÿä»£åŠæŒä¹…ä»£å‘ç”ŸGCçš„æƒ…å†µ jstat -gcold pid:oldå¯¹è±¡çš„ä¿¡æ¯ gcoldcapacity ç”¨äºæŸ¥çœ‹è€ç”Ÿä»£çš„å®¹é‡ jstat -gcoldcapacity pid:oldå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡ gcpermcapacity ç”¨äºæŸ¥çœ‹æŒä¹…ä»£çš„å®¹é‡ jstat -gcpermcapacity pid: permå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡ gcutil æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä»£åƒåœ¾æ”¶é›†çš„æƒ…å†µ jstat -util pid:ç»Ÿè®¡gcä¿¡æ¯ç»Ÿè®¡ printcompilation HotSpotç¼–è¯‘æ–¹æ³•çš„ç»Ÿè®¡ jstat -printcompilation pid:å½“å‰VMæ‰§è¡Œçš„ä¿¡æ¯ GCViewer å›¾å½¢åŒ–GCæ—¥å¿—åˆ†æåˆ©å™¨ https://github.com/chewiebug/GCViewer 12mvn packagejava -jar target\\gcviewer-1.36-SNAPSHOT.jar gc.log summary.csv chart.png JVMè°ƒä¼˜æ¡ˆä¾‹ åç«¯æœåŠ¡ï¼Œå¢åŠ Edenå æ¯”ï¼Œå‡å°‘Edenåˆ°Suvivorå¤åˆ¶ 123-XX:SurvivorRatio=6 å¢åŠ äº†Edenåœ¨æ–°ç”Ÿä»£ä¸­çš„æ¯”ä¾‹å, å¦‚æœå¯¹è±¡å¾ˆå¿«å¯ä»¥ä½¿ç”¨å®Œæˆåˆ™ç›´æ¥è¢«æ¸…ç†, ä¸éœ€è¦è¢«å¤åˆ¶åˆ°SurvivoråŒºåŸŸ æœåŠ¡è½¬å‘åº”ç”¨ï¼Œå¢åŠ æ–°ç”Ÿä»£ç©ºé—´å‡å°‘Edenå æ¯”ï¼Œé¿å…æ¸…ç†è€å¹´ä»£ 12-XX:SurvivorRatio=3å‡å°‘Edenå æ¯”åï¼Œå¯¹è±¡èƒ½ä¿å­˜åˆ°SurvivoråŒºåŸŸï¼Œåç»­ä¸éœ€è¦è¢«å¤åˆ¶åˆ°è€å¹´ä»£ CMS-Remarkä¹‹å‰å¼ºåˆ¶è¿›è¡Œå¹´è½»ä»£çš„GC https://segmentfault.com/a/1190000005174819 çº¿ç¨‹æ­»é”æ£€æŸ¥ï¼ˆjstackåˆ†æçº¿ç¨‹å¿«ç…§ï¼‰ https://www.jianshu.com/p/f36a1db63ad2","categories":[{"name":"JVM","slug":"JVM","permalink":"http://blog.tgyf.com/categories/JVM/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"http://blog.tgyf.com/tags/JVM/"}]},{"title":"JVMå†…å­˜æ¨¡å‹åŠåƒåœ¾å›æ”¶","slug":"Javaè™šæ‹Ÿæœº/JVMå†…å­˜æ¨¡å‹åŠåƒåœ¾å›æ”¶","date":"2020-03-04T12:08:31.852Z","updated":"2020-03-04T12:08:31.852Z","comments":true,"path":"2020/03/04/Javaè™šæ‹Ÿæœº/JVMå†…å­˜æ¨¡å‹åŠåƒåœ¾å›æ”¶/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/","excerpt":"","text":"å†…å­˜å¸ƒå±€ ç¤ºæ„å›¾ åŸºæœ¬ä»‹ç» æ–¹æ³•åŒºå’Œå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼›è€Œjavaæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨æ˜¯è¿è¡Œæ—¶çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸã€‚å †ä¸­å­˜çš„æ˜¯å¯¹è±¡ã€‚æ ˆä¸­å­˜çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œå †ä¸­å¯¹è±¡çš„å¼•ç”¨; Javaå †ï¼ˆHeapï¼‰æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ æ–¹æ³•åŒºï¼ˆMethodAreaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ ç¨‹åºè®¡æ•°å™¨ï¼ˆProgramCounterRegisterï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ JVMæ ˆï¼ˆJVMStacksï¼‰å…¨ç§°Javaè™šæ‹Ÿæœºæ ˆï¼ˆJavaVirtualMachineStacksï¼‰ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼Œä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStackFrameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeMethodStacksï¼‰ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå…¶åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚ ç±»ç”Ÿå‘½å‘¨æœŸ ç±»ç”Ÿå‘½å‘¨æœŸ(å†…å­˜ä¸­) åŠ è½½ï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œåœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ã€‚ è¿æ¥ï¼Œè¿æ¥åˆåŒ…å«ä¸‰å—å†…å®¹ï¼šéªŒè¯ã€å‡†å¤‡ã€è§£æã€‚ 1231ï¼‰éªŒè¯ï¼Œæ–‡ä»¶æ ¼å¼ã€å…ƒæ•°æ®ã€å­—èŠ‚ç ã€ç¬¦å·å¼•ç”¨éªŒè¯ï¼›2ï¼‰å‡†å¤‡ï¼Œä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼›3ï¼‰è§£æï¼ŒæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼› åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ã€‚ ä½¿ç”¨ï¼Œnewå‡ºå¯¹è±¡ç¨‹åºä¸­ä½¿ç”¨ã€‚ å¸è½½ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ å †åŠåƒåœ¾å›æ”¶ å †åŠåƒåœ¾å›æ”¶ï¼ˆç©ºé—´ä½¿ç”¨æ–¹å¼ï¼‰ æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å°+å¹´è€ä»£å¤§å°+æŒä¹…ä»£å¤§å°ï¼› å¹´è½»ä»£åˆ†ä¸‰ä¸ªåŒºã€‚ä¸€ä¸ªEdenåŒºï¼Œä¸¤ä¸ªSurvivoråŒº(ä¸€èˆ¬è€Œè¨€)ã€‚å¤§éƒ¨åˆ†å¯¹è±¡åœ¨EdenåŒºä¸­ç”Ÿæˆã€‚å½“EdenåŒºæ»¡æ—¶ï¼Œè¿˜å­˜æ´»çš„å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°SurvivoråŒºï¼ˆä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼‰ï¼Œå½“è¿™ä¸ªSurvivoråŒºæ»¡æ—¶ï¼Œæ­¤åŒºçš„å­˜æ´»å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªSurvivoråŒºï¼Œå½“è¿™ä¸ªSurvivorå»ä¹Ÿæ»¡äº†çš„æ—¶å€™ï¼Œä» ç¬¬ ä¸€ ä¸ªS u r v i v o råŒº å¤ åˆ¶ è¿‡ æ¥ çš„ å¹¶ ä¸” æ­¤ æ—¶ è¿˜ å­˜ æ´» çš„ å¯¹ è±¡ï¼Œå°†è¢«å¤åˆ¶â€œå¹´ è€ åŒº( Te n u r e d )â€ï¼›-XX:PretenureSizeThresholdå³å¯¹è±¡çš„å¤§å°å¤§äºæ­¤å€¼ï¼Œå°±ä¼šç»•è¿‡æ–°ç”Ÿä»£ï¼Œç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼› åœ¨å¹´è½»ä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°å¹´è€ä»£ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºå¹´è€ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼› æŒä¹…ä»£:ç”¨äºå­˜æ”¾é™æ€æ–‡ä»¶ï¼Œå¦‚ä»ŠJavaç±»ã€æ–¹æ³•ç­‰ã€‚-XX:MaxPermSizeï¼ˆJDK8å»é™¤äº†æ°¸ä¹…ä»£ï¼Œå¼•å…¥äº†å…ƒç©ºé—´Metaspaceï¼Œ-XX:MaxMetaspaceSize=64mï¼‰ åƒåœ¾å›æ”¶ç®—æ³• å¼•ç”¨è®¡æ•° æ¯”è¾ƒå¤è€çš„å›æ”¶ç®—æ³•ã€‚ åŸç†æ˜¯æ­¤å¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨ï¼Œå³å¢åŠ ä¸€ä¸ªè®¡æ•°ï¼Œåˆ é™¤ä¸€ä¸ªå¼•ç”¨åˆ™å‡å°‘ä¸€ä¸ªè®¡æ•°ã€‚åƒåœ¾å›æ”¶æ—¶ï¼Œåªç”¨æ”¶é›†è®¡æ•°ä¸º0çš„å¯¹è±¡ã€‚æ­¤ç®—æ³•æœ€è‡´å‘½çš„æ˜¯æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ æ­¤ç®—æ³•æ‰§è¡Œåˆ†ä¸¤é˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ ç¬¬äºŒé˜¶æ®µéå†æ•´ä¸ªå †ï¼ŒæŠŠæœªæ ‡è®°çš„å¯¹è±¡æ¸…é™¤ æ­¤ç®—æ³•éœ€è¦æš‚åœæ•´ä¸ªåº”ç”¨ï¼ŒåŒæ—¶ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ç¢ç‰‡å¤ªå¤šå¯èƒ½å¼•å‘å¦ä¸€æ¬¡GCï¼› å¤åˆ¶ï¼ˆCopyingï¼‰ æ­¤ç®—æ³•æŠŠå†…å­˜ç©ºé—´åˆ’ä¸ºä¸¤ä¸ªç›¸ç­‰çš„åŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåŒºåŸŸã€‚ åƒåœ¾å›æ”¶æ—¶ï¼Œéå†å½“å‰ä½¿ç”¨åŒºåŸŸï¼ŒæŠŠæ­£åœ¨ä½¿ç”¨ä¸­çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªåŒºåŸŸä¸­ã€‚ æ­¤æ–¹æ³•æ¯æ¬¡åªå¤„ç†æ­£åœ¨ä½¿ç”¨ä¸­çš„å¯¹è±¡ï¼Œå› æ­¤å¤åˆ¶æˆæœ¬æ¯”è¾ƒå°ï¼ŒåŒæ—¶å¤åˆ¶è¿‡å»ä»¥åè¿˜èƒ½è¿›è¡Œç›¸åº”çš„å†…å­˜æ•´ç†ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚ å½“ç„¶ï¼Œæ­¤ç®—æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå°±æ˜¯éœ€è¦ä¸¤å€å†…å­˜ç©ºé—´ã€‚ 4. æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ æ­¤ç®—æ³•ç»“åˆäº†â€œæ ‡è®°-æ¸…é™¤â€å’Œâ€œå¤åˆ¶â€ä¸¤ä¸ªç®—æ³•çš„ä¼˜ç‚¹ã€‚ ä¹Ÿæ˜¯åˆ†ä¸¤é˜¶æ®µ: ç¬¬ä¸€é˜¶æ®µä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡ï¼Œ ç¬¬äºŒé˜¶æ®µéå†æ•´ä¸ªå †ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡å¹¶ä¸”æŠŠå­˜æ´»å¯¹è±¡â€œå‹ç¼©â€åˆ°å †çš„å…¶ä¸­ä¸€å—ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚ æ­¤ç®—æ³•é¿å…äº†â€œæ ‡è®°-æ¸…é™¤â€çš„ç¢ç‰‡é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†â€œå¤åˆ¶â€ç®—æ³•çš„ç©ºé—´é—®é¢˜ã€‚ åƒåœ¾å›æ”¶æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼ˆç”¨æˆ·æ—¶é—´å æ¯”ï¼‰ 1ååé‡ï¼ˆThroughputï¼‰=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ ç³»ç»Ÿåœé¡¿æ—¶é—´ï¼ˆç”¨æˆ·æ—¶é—´å»¶è¿Ÿï¼‰ 1GCé€ æˆçš„ç”¨æˆ·çº¿ç¨‹æœ€é•¿åœé¡¿æ—¶é—´ åƒåœ¾å›æ”¶å™¨ï¼ˆç®—æ³•å®ç°ï¼‰ Serialä¸²è¡Œæ”¶é›†å™¨ ç‰¹ç‚¹: ä»…ä»…ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œå†…å­˜å›æ”¶ï¼› å®ƒæ˜¯ç‹¬å å¼çš„å†…å­˜å›æ”¶ï¼› è¿›è¡Œå†…å­˜å›æ”¶æ—¶,æš‚åœæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹(â€œStop-The-Worldâ€)ï¼› ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼› é€‚åˆCPUç­‰ç¡¬ä»¶ä¸€èˆ¬çš„åœºåˆï¼› åˆ°JDK1.7ä¸ºæ­¢ï¼Œæ˜¯JVMClientæ¨¡å¼ä¸‹é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼› è®¾ç½®å‚æ•°: 1-XX:+UseSerialGCæŒ‡å®šä½¿ç”¨æ–°ç”Ÿä»£SerialGCå’Œè€å¹´ä»£SerialOldGC SerialOldæ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹ç‹¬å ï¼Œæ ‡è®°æ•´ç†ç®—æ³•ï¼‰ ç‰¹ç‚¹: åŒæ–°ç”Ÿä»£Serialæ”¶é›†å™¨ä¸€æ ·ï¼Œå•çº¿ç¨‹ã€ç‹¬å å¼çš„åƒåœ¾æ”¶é›†å™¨ï¼› ä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼› é€šå¸¸è€å¹´ä»£å†…å­˜å›æ”¶æ¯”æ–°ç”Ÿä»£å†…å­˜å›æ”¶è¦æ›´é•¿æ—¶é—´ï¼Œæ‰€ä»¥å¯èƒ½ä¼šä½¿åº”ç”¨ç¨‹åºåœé¡¿è¾ƒé•¿æ—¶é—´ï¼› è®¾ç½®å‚æ•°: 123-XX:+UseSerialGCæ–°ç”Ÿä»£ã€è€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡ŒGCï¼›ï¼ˆåˆ†åˆ«æ˜¯Serialå’ŒSerialOldï¼‰-XX:+UseParNewGCæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä½¿ç”¨SerialOldï¼›-XX:+UseParallelGCæ–°ç”Ÿä»£ä½¿ç”¨Parallelï¼Œè€å¹´ä»£ä½¿ç”¨SerialOldï¼› ParNewæ”¶é›†å™¨ï¼Œå¹¶è¡ŒGC ç‰¹ç‚¹: Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼› ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼› åƒåœ¾å›æ”¶æ—¶ï¼Œåº”ç”¨ç¨‹åºä»ä¼šæš‚åœï¼Œåªä¸è¿‡ç”±äºæ˜¯å¤šçº¿ç¨‹å›æ”¶ï¼Œåœ¨å¤šæ ¸CPUä¸Šï¼Œå›æ”¶æ•ˆç‡ä¼šé«˜äºä¸²è¡ŒGCã€‚åä¹‹åœ¨å•æ ¸CPUï¼Œæ•ˆç‡ä¼šä¸å¦‚ä¸²è¡ŒGCï¼› è®¾ç½®å‚æ•°: 123-XX:+UseParNewGCæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä½¿ç”¨SerialOldï¼›-XX:+UseConcMarkSweepGCæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä½¿ç”¨CMSï¼›-XX:ParallelGCThreads=næŒ‡å®šParNewæ”¶é›†å™¨å·¥ä½œæ—¶çš„æ”¶é›†çº¿ç¨‹æ•°ï¼Œå½“CPUæ ¸æ•°å°äº8æ—¶ï¼Œé»˜è®¤å¼€å¯çš„çº¿ç¨‹æ•°ç­‰äºCPUæ•°é‡ï¼Œå½“é«˜äº8æ—¶ï¼Œå¯ä½¿ç”¨å…¬å¼ï¼š3+((5*CPU_count)/8)ã€‚ åœ¨JVMServeræ¨¡å¼ä¸‹é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› æ˜¯ï¼šé™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨(å¹¶å‘GC)é…åˆå·¥ä½œã€‚ ParNewæ”¶é›†å™¨åœ¨å•CPUç¯å¢ƒä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯”Serialæ”¶é›†å™¨æ›´å¥½çš„æ•ˆæœã€‚ Parallelæ”¶é›†å™¨ ç‰¹ç‚¹: åŒParNewå›æ”¶å™¨ä¸€æ ·ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå®ƒéå¸¸å…³æ³¨ç³»ç»Ÿçš„ååé‡(é€šè¿‡å‚æ•°æ§åˆ¶)ï¼› ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼› æ”¯æŒè‡ªé€‚åº”çš„GCè°ƒèŠ‚ç­–ç•¥ï¼› è®¾ç½®å‚æ•°: 12345-XX:+UseParallelGCæ–°ç”Ÿä»£ä½¿ç”¨Parallelï¼Œè€å¹´ä»£ä½¿ç”¨SerialOldï¼›-XX:+UseParallelOldGCæ–°ç”Ÿä»£ä½¿ç”¨Parallelï¼Œè€å¹´ä»£ä½¿ç”¨ParallelOldï¼›-XX:MaxGCPauseMillis=nè®¾ç½®å†…å­˜å›æ”¶çš„æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå•ä½msï¼›-XX:GCTimeRatio=nè®¾ç½®ååé‡çš„å¤§å°ï¼Œå‡è®¾å€¼ä¸ºn(åœ¨0-100ä¹‹é—´)ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†èŠ±è´¹ä¸è¶…è¿‡1/(n+1)çš„æ—¶é—´ç”¨äºå†…å­˜å›æ”¶ã€‚é»˜è®¤å€¼ä¸º99ï¼Œå°±æ˜¯å…è®¸æœ€å¤§1%çš„åƒåœ¾æ”¶é›†æ—¶é—´ï¼›-XX:+UseAdaptiveSizePolicyè‡ªé€‚åº”GCç­–ç•¥çš„å¼€å…³å‚æ•°ã€‚ ParallelOldæ”¶é›†å™¨ ç‰¹ç‚¹: å…³æ³¨ååé‡çš„è€å¹´ä»£å¹¶å‘æ”¶é›†å™¨ï¼› ä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼› è®¾ç½®å‚æ•°: 1-XX:+UseParallelOldGCæ–°ç”Ÿä»£ä½¿ç”¨Parallelï¼Œè€å¹´ä»£ä½¿ç”¨ParallelOldã€‚è¿™ä¸ªæ”¶é›†å™¨æ˜¯åœ¨JDK1.6ä¸­æ‰å¼€å§‹æä¾›ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¦‚æœæ–°ç”Ÿä»£é€‰æ‹©äº†Parallelæ”¶é›†å™¨ï¼Œè€å¹´ä»£é™¤äº†SerialOldæ”¶é›†å™¨å¤–åˆ«æ— é€‰æ‹©ã€‚ CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰ ç‰¹ç‚¹: éç‹¬å å¼çš„è€å¹´ä»£å¹¶å‘æ”¶é›†å™¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™åº”ç”¨ç¨‹åºä¸ä¼šåœæ­¢è¿è¡Œï¼›â€“ä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œå› æ­¤å›æ”¶åä¼šæœ‰å†…å­˜ç¢ç‰‡ï¼Œå¯è®¾ç½®å‚æ•°è¿›è¡Œå†…å­˜ç¢ç‰‡çš„å‹ç¼©æ•´ç†ï¼› ä¸Parallelå’ŒParallelOldä¸åŒï¼ŒCMSä¸»è¦å…³æ³¨ç³»ç»Ÿåœé¡¿æ—¶é—´ï¼› ç¼ºç‚¹: å¯¹CPUèµ„æºæ•æ„Ÿï¼› æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼ˆFloatingGarbageï¼‰ï¼› å†…å­˜ç¢ç‰‡é—®é¢˜ è®¾ç½®å‚æ•°: 12345678-XX:-CMSPrecleaningEnabledå…³é—­é¢„æ¸…ç†ï¼Œé»˜è®¤åœ¨å¹¶å‘æ ‡è®°åä¼šæœ‰ä¸€ä¸ªé¢„æ¸…ç†çš„æ“ä½œï¼›-XX:+UseConcMarkSweepGCæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä½¿ç”¨CMS-XX:ConcGCThreads=nè®¾ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼›ï¼ˆæ—©æœŸç‰ˆæœ¬æ˜¯-XX:ParallelCMSThreads=nï¼‰-XX:CMSInitiatingOccupancyFraction=næŒ‡å®šè€å¹´ä»£å›æ”¶é˜€å€¼ï¼Œé»˜è®¤å€¼ä¸º68ï¼›-XX:+UseCMSCompactAtFullCollectionå¼€å¯å†…å­˜ç¢ç‰‡æ•´ç†ï¼›-XX:CMSFullGCsBeforeCompation=næŒ‡å®šè¿›è¡Œå¤šå°‘æ¬¡CMSåƒåœ¾å›æ”¶åå†è¿›è¡Œä¸€æ¬¡å†…å­˜å‹ç¼©ï¼›-XX:+CMSParallelRemarkEnabledåœ¨ä½¿ç”¨UseParNewGCå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå°½é‡å‡å°‘mark(æ ‡è®°)çš„æ—¶é—´ï¼›-XX:+UseCMSInitiatingOccupancyOnlyè¡¨ç¤ºåªæœ‰è¾¾åˆ°é˜€å€¼æ—¶æ‰è¿›è¡ŒCMSåƒåœ¾å›æ”¶ G1 å–ä»£äº†CMS ç”±äºG1çš„å‡ºç°ï¼ŒCMSåœ¨Java9ä¸­å·²è¢«åºŸå¼ƒï¼›http://openjdk.java.net/jeps/291 G1ï¼ˆGarbageFirstï¼‰æ˜¯ä¸€ä¸ªæ¨ªè·¨æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ã€‚å®é™…ä¸Šï¼Œå®ƒå·²ç»æ‰“ä¹±äº†å‰é¢æ‰€è¯´çš„å †ç»“æ„ï¼Œç›´æ¥å°†å †åˆ†æˆæå…¶å¤šä¸ªåŒºåŸŸã€‚æ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“EdenåŒºã€SurvivoråŒºæˆ–è€…è€å¹´ä»£ä¸­çš„ä¸€ä¸ªã€‚å®ƒé‡‡ç”¨çš„æ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•(æ ‡è®°-æ¸…é™¤-æ•´ç†)ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚è€Œä¸”å’ŒCMSä¸€æ ·éƒ½èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¹¶å‘åœ°è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ G1æ˜¯é€»è¾‘åˆ†ä»£ï¼Œç‰©ç†ä¸åˆ†ä»£ é™¤æ­¤ä¹‹å¤–ä¸ä»…é€»è¾‘åˆ†ä»£ï¼Œè€Œä¸”ç‰©ç†åˆ†ä»£ G1èƒ½å¤Ÿé’ˆå¯¹æ¯ä¸ªç»†åˆ†çš„åŒºåŸŸæ¥è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨é€‰æ‹©è¿›è¡Œåƒåœ¾å›æ”¶çš„åŒºåŸŸæ—¶ï¼Œå®ƒä¼šä¼˜å…ˆå›æ”¶æ­»äº¡å¯¹è±¡è¾ƒå¤šçš„åŒºåŸŸã€‚è¿™ä¹Ÿæ˜¯G1åå­—çš„ç”±æ¥ã€‚ https://blog.csdn.net/baiye_xing/article/details/73743395 å…³äºG1çš„ç»†èŠ‚ï¼Œå¦‚æœæƒ³äº†è§£å¾—æ›´å¤šï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹èµ„æ–™ï¼š http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html https://www.zhihu.com/question/50398881/answer/120831226 ZGC â€œZeroâ€é›¶æš‚åœåƒåœ¾å›æ”¶å™¨æš‚åœæ—¶é—´ä¸è¶…è¿‡10ms å‚è€ƒå¦‚ä¸‹èµ„æ–™ï¼š http://openjdk.java.net/projects/zgc/ åƒåœ¾å›æ”¶å™¨ç»„åˆ æŸ¥çœ‹å‘½ä»¤ 1java -XX:+PrintCommandLineFlags -version åœ¨ç½‘ä¸Šæ‰¾äº†å¼ å›¾ï¼Œè¿™æ ·å¯ä»¥ç›´è§‚çš„å±•ç¤ºå‡ºä»–ä»¬æ˜¯æ€æ ·ç»„åˆçš„. ä¸Šå›¾å±•ç¤ºäº†JDK1.7+åï¼ŒHotspot JVMçš„æ‰€æœ‰åƒåœ¾æ”¶é›†å™¨ä»¥åŠå®ƒä»¬é€‚ç”¨çš„â€œä»£â€,é€‚åˆæ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨æœ‰ï¼šSerialã€ParNewã€Parallel Scavengeã€G1ã€‚é€‚åˆå¹´è€ä»£çš„åƒåœ¾æ”¶é›†å™¨æœ‰ï¼šCMSã€Serial Oldã€Parallel Oldã€G1ã€‚å®ƒä»¬ä¹‹é—´çš„ç»„åˆå…³ç³»å¦‚ä¸Šå›¾è¿çº¿ï¼ˆç²—çº¿ç›¸è¿çš„æ˜¯æœ€ä½³ç»„åˆï¼‰ï¼Œå…¶ä¸­G1æ˜¯JDK1.7 Update14è¿™ä¸ªç‰ˆæœ¬ä¸­æ­£å¼æä¾›çš„å•†ä¸šæ”¶é›†å™¨ï¼Œå®ƒå¯ä»¥åŒæ—¶é€‚ç”¨äºæ–°ç”Ÿä»£å’Œå¹´è€ä»£ã€‚ ç»„åˆç›¸å…³JVMå‚æ•°ï¼Œå¦‚å›¾ï¼š ç¬¬ä¸€ä¸ªç»„åˆï¼šSerial + Serial Old Serialä½œä¸ºå¹´è½»ä»£å›æ”¶å™¨å’ŒSerial Oldåƒåœ¾å›æ”¶å™¨(JDK1.3ç‰ˆæœ¬ä¹‹å‰)ä½œä¸ºè€å¹´ä»£å›æ”¶å™¨ã€‚åœ¨JDK1.3ç‰ˆæœ¬ä¹‹å‰æ˜¯å”¯ä¸€é€‰æ‹©ï¼Œç°åœ¨åŸºæœ¬ä¸ç”¨ï¼Œå› ä¸ºæ˜¯å•è¿›ç¨‹æ”¶é›†å™¨ï¼Œæ²¡æœ‰å‘æŒ¥å‡ºç°åœ¨å¤šæ ¸å¹¶è¡Œå¤„ç†çš„ä¼˜åŠ¿ã€‚ ç¬¬äºŒä¸ªç»„åˆï¼šParNew + CMS ParNewä½œä¸ºå¹´è½»ä»£å›æ”¶å™¨ï¼ŒCMSä½œä¸ºè€å¹´ä»£å›æ”¶å™¨,ä¸€èˆ¬éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œå‚æ•°æ˜¯ï¼š -XX:+UseParNewGC -XX:+UseConcMarkSweepGC å› ä¸ºç°åœ¨jdk7,8é»˜è®¤ä¸æ˜¯ä½¿ç”¨è¿™ä¸ªç­–ç•¥ã€‚è€Œæ˜¯ä½¿ç”¨çš„ä¸‹é¢çš„Parallel Scavenge + Parallel Oldã€‚å…¶åŸºæœ¬æ”¶é›†åŸç†å’Œä¸‹é¢çš„Parallel Scavenge + Parallel Oldæ²¡æœ‰åŒºåˆ«ï¼ŒåŒºåˆ«åœ¨äºParallel Scavengeå’Œ Parallel Oldæœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼Œç›´æ¥å¯ä»¥é€‚åº”æœ€å¤§ååé‡ã€‚ä½†å¿½ç•¥äº†åœé¡¿æ—¶é—´ï¼Œä¸é€‚ç”¨äºè¦æ±‚ç”¨æˆ·ä½“éªŒçš„åœºæ™¯ï¼Œä¸ªåˆ«è¯·æ±‚å¯èƒ½ç­‰å¾…æ—¶é—´è¾ƒé•¿ã€‚è€ŒParNew + CMSä¸»è¦åœºæ™¯æ˜¯æ³¨é‡æ§åˆ¶å•æ¬¡å›æ”¶åœé¡¿æ—¶é—´ã€‚ ç¬¬ä¸‰ä¸ªç»„åˆï¼šParallel Scavenge + Parallel Old JDK6ç‰ˆæœ¬ä¹‹åå¼•å…¥ï¼ŒParallel Scavengeä½œä¸ºå¹´è½»ä»£å›æ”¶å™¨ï¼ŒParallel Oldä½œä¸ºè€å¹´ä»£å›æ”¶å™¨ï¼Œåœ¨JDK6ä¹‹å‰ï¼ŒParallel Scavengeåªèƒ½é€‚é…Serial Oldï¼Œç°åœ¨æ˜¯JDK7,JDK8çš„é»˜è®¤ç»„åˆã€‚ç‰¹ç‚¹ä¸Šé¢è¯´äº†å°±æ˜¯é€‚åº”æœ€å¤§ååé‡ã€‚ ç¬¬å››ä¸ªç»„åˆï¼šG1å›æ”¶å™¨ G1å›æ”¶å™¨ï¼ŒJDK7å‡ºç°ï¼ŒJDK9ä¹‹åçš„é»˜è®¤å›æ”¶å™¨ï¼Œè€å¹´ä»£å’Œå¹´è½»ä»£éƒ½å¯ä»¥å›æ”¶ï¼Œç‰¹ç‚¹æ˜¯ç›´æ¥å¯¹åœé¡¿æ—¶é—´è¿›è¡Œè®¾ç½®ã€‚","categories":[{"name":"JVM","slug":"JVM","permalink":"http://blog.tgyf.com/categories/JVM/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"http://blog.tgyf.com/tags/JVM/"}]},{"title":"SpringCloudæ¡†æ¶åŸç†","slug":"Javaæ¡†æ¶/SpringCloud/SpringCloudæ¡†æ¶åŸç†","date":"2020-03-04T07:52:58.339Z","updated":"2020-03-04T07:52:58.339Z","comments":true,"path":"2020/03/04/Javaæ¡†æ¶/SpringCloud/SpringCloudæ¡†æ¶åŸç†/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E6%A1%86%E6%9E%B6/SpringCloud/SpringCloud%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/","excerpt":"","text":"Spring Cloudæ˜¯ä¸€ä¸ªå…¨å®¶æ¡¶å¼çš„æŠ€æœ¯æ ˆï¼ŒåŒ…å«äº†å¾ˆå¤šç»„ä»¶ã€‚æœ¬æ–‡å…ˆä»å…¶æœ€æ ¸å¿ƒçš„å‡ ä¸ªç»„ä»¶å…¥æ‰‹ï¼Œæ¥å‰–æä¸€ä¸‹å…¶åº•å±‚çš„å·¥ä½œåŸç†ã€‚ æ ¸å¿ƒç»„ä»¶ Eureka Feign Ribbon Hystrix Zuul å‡è®¾çš„ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ ç›´æ¥è¯´ä»–ä»¬çš„åŸç†å¤ªç©ºæ³›äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å‡è®¾äº†ä¸€ä¸ªç”µå•†çš„ä¸šåŠ¡åœºæ™¯.å°±æŠŠä»–æœ€æ ¸å¿ƒé‚£ä¸ªå®ç°æ”¯ä»˜è®¢å•çš„åŠŸèƒ½æ‹¿å‡ºæ¥è¯´ä¸€ä¸‹. ä¸šåŠ¡æµç¨‹ï¼š åˆ›å»ºä¸€ä¸ªè®¢å•ä¹‹åï¼Œå¦‚æœç”¨æˆ·ç«‹åˆ»æ”¯ä»˜äº†è¿™ä¸ªè®¢å•ï¼Œæˆ‘ä»¬éœ€è¦å°†è®¢å•çŠ¶æ€æ›´æ–°ä¸ºâ€œå·²æ”¯ä»˜â€ æ‰£å‡ç›¸åº”çš„å•†å“åº“å­˜ é€šçŸ¥ä»“å‚¨ä¸­å¿ƒï¼Œè¿›è¡Œå‘è´§ ç»™ç”¨æˆ·çš„è¿™æ¬¡è´­ç‰©å¢åŠ ç›¸åº”çš„ç§¯åˆ† é’ˆå¯¹ä¸Šè¿°æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æœ‰è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€ä»“å‚¨æœåŠ¡ã€ç§¯åˆ†æœåŠ¡. æ•´ä½“æ€è·¯ï¼š ç”¨æˆ·é’ˆå¯¹ä¸€ä¸ªè®¢å•å®Œæˆæ”¯ä»˜ä¹‹åï¼Œå°±ä¼šå»æ‰¾è®¢å•æœåŠ¡ï¼Œæ›´æ–°è®¢å•çŠ¶æ€ï¼ˆæ ‡è®°ä¸ºå·²æ”¯ä»˜ï¼‰ è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡ï¼Œæ‰£å‡åº“å­˜å¹¶å®Œæˆç›¸åº”åŠŸèƒ½ è®¢å•æœåŠ¡è°ƒç”¨ä»“å‚¨æœåŠ¡ï¼Œé€šçŸ¥ä»“å‚¨å‘è´§å¹¶å®Œæˆç›¸åº”åŠŸèƒ½ è®¢å•æœåŠ¡è°ƒç”¨ç§¯åˆ†æœåŠ¡ï¼Œä¸ºç”¨æˆ·å¢åŠ ç§¯åˆ†å¹¶å®Œæˆç›¸åº”åŠŸèƒ½ Spring Cloudå¾®æœåŠ¡æ¶æ„å„ç»„ä»¶åä½œä¸ä½œç”¨ æ ¸å¿ƒç»„ä»¶ï¼šEureka Eurekaæ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„æ³¨å†Œä¸­å¿ƒï¼Œä¸“é—¨è´Ÿè´£æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯å‘Šè¯‰Eureka Serverï¼Œè‡ªå·±åœ¨å“ªå°æœºå™¨ä¸Šï¼Œç›‘å¬ç€å“ªä¸ªç«¯å£ã€‚è€ŒEureka Serveræ˜¯ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œä¿å­˜äº†å„æœåŠ¡æ‰€åœ¨çš„æœºå™¨å’Œç«¯å£å· è®¢å•æœåŠ¡é‡Œä¹Ÿæœ‰ä¸€ä¸ªEureka Clientç»„ä»¶ï¼Œè¿™ä¸ªEureka Clientç»„ä»¶ä¼šæ‰¾Eureka Serveré—®ä¸€ä¸‹ï¼šåº“å­˜æœåŠ¡åœ¨å“ªå°æœºå™¨å•Šï¼Ÿç›‘å¬ç€å“ªä¸ªç«¯å£å•Šï¼Ÿä»“å‚¨æœåŠ¡å‘¢ï¼Ÿç§¯åˆ†æœåŠ¡å‘¢ï¼Ÿç„¶åå°±å¯ä»¥æŠŠè¿™äº›ç›¸å…³ä¿¡æ¯ä»Eureka Serverçš„æ³¨å†Œè¡¨ä¸­æ‹‰å–åˆ°è‡ªå·±æœ¬åœ°ç¼“å­˜èµ·æ¥ã€‚ è¿™æ—¶å¦‚æœè®¢å•æœåŠ¡æƒ³è¦è°ƒç”¨åº“å­˜æœåŠ¡ï¼Œä¸å°±å¯ä»¥æ‰¾è‡ªå·±æœ¬åœ°çš„Eureka Clienté—®ä¸€ä¸‹åº“å­˜æœåŠ¡åœ¨å“ªå°æœºå™¨ï¼Ÿç›‘å¬å“ªä¸ªç«¯å£å—ï¼Ÿæ”¶åˆ°å“åº”åï¼Œç´§æ¥ç€å°±å¯ä»¥å‘é€ä¸€ä¸ªè¯·æ±‚è¿‡å»ï¼Œè°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜çš„é‚£ä¸ªæ¥å£ï¼åŒç†ï¼Œå¦‚æœè®¢å•æœåŠ¡è¦è°ƒç”¨ä»“å‚¨æœåŠ¡ã€ç§¯åˆ†æœåŠ¡ï¼Œä¹Ÿæ˜¯å¦‚æ³•ç‚®åˆ¶ã€‚ æ€»ç»“ä¸€ä¸‹ï¼š Eureka Clientï¼šè´Ÿè´£å°†è¿™ä¸ªæœåŠ¡çš„ä¿¡æ¯æ³¨å†Œåˆ°Eureka Serverä¸­ Eureka Serverï¼šæ³¨å†Œä¸­å¿ƒï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œä¿å­˜äº†å„ä¸ªæœåŠ¡æ‰€åœ¨çš„æœºå™¨å’Œç«¯å£å· æ ¸å¿ƒç»„ä»¶ï¼šFeign Feign Clientä¼šåœ¨åº•å±‚æ ¹æ®ä½ çš„æ³¨è§£ï¼Œè·Ÿä½ æŒ‡å®šçš„æœåŠ¡å»ºç«‹è¿æ¥ã€æ„é€ è¯·æ±‚ã€å‘èµ·é•æ±‚ã€è·å–å“åº”ã€è§£æå“åº” Feignçš„ä¸€ä¸ªå…³é”®æœºåˆ¶å°±æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ã€‚ é¦–å…ˆï¼Œå¦‚æœä½ å¯¹æŸä¸ªæ¥å£å®šä¹‰äº†@FeignClientæ³¨è§£ï¼ŒFeignå°±ä¼šé’ˆå¯¹è¿™ä¸ªæ¥å£åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç† æ¥ç€ä½ è¦æ˜¯è°ƒç”¨é‚£ä¸ªæ¥å£ï¼Œæœ¬è´¨å°±æ˜¯ä¼šè°ƒç”¨ Feignåˆ›å»ºçš„åŠ¨æ€ä»£ç†ï¼Œè¿™æ˜¯æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ Feignçš„åŠ¨æ€ä»£ç†ä¼šæ ¹æ®ä½ åœ¨æ¥å£ä¸Šçš„@RequestMappingç­‰æ³¨è§£ï¼Œæ¥åŠ¨æ€æ„é€ å‡ºä½ è¦è¯·æ±‚çš„æœåŠ¡çš„åœ°å€ æœ€åé’ˆå¯¹è¿™ä¸ªåœ°å€ï¼Œå‘èµ·è¯·æ±‚ã€è§£æå“åº” æ ¸å¿ƒç»„ä»¶ï¼šRibbon Ribbonçš„ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ï¼Œä¼šå¸®ä½ åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é€‰æ‹©ä¸€å°æœºå™¨ï¼Œå‡åŒ€çš„æŠŠè¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœºå™¨ä¸Š. Ribbonçš„è´Ÿè½½å‡è¡¡é»˜è®¤ä½¿ç”¨çš„æœ€ç»å…¸çš„Round Robinè½®è¯¢ç®—æ³•ã€‚è¿™æ˜¯å•¥ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœè®¢å•æœåŠ¡å¯¹åº“å­˜æœåŠ¡å‘èµ·10æ¬¡è¯·æ±‚ï¼Œé‚£å°±å…ˆè®©ä½ è¯·æ±‚ç¬¬1å°æœºå™¨ã€ç„¶åæ˜¯ç¬¬2å°æœºå™¨ã€ç¬¬3å°æœºå™¨ã€ç¬¬4å°æœºå™¨ã€ç¬¬5å°æœºå™¨ï¼Œæ¥ç€å†æ¥â€”ä¸ªå¾ªç¯ï¼Œç¬¬1å°æœºå™¨ã€ç¬¬2å°æœºå™¨â€¦ä»¥æ­¤ç±»æ¨ã€‚ æ­¤å¤–ï¼ŒRibbonæ˜¯å’ŒFeignä»¥åŠEurekaç´§å¯†åä½œï¼Œå®Œæˆå·¥ä½œçš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š é¦–å…ˆRibbonä¼šä» Eureka Clienté‡Œè·å–åˆ°å¯¹åº”çš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œä¹Ÿå°±çŸ¥é“äº†æ‰€æœ‰çš„æœåŠ¡éƒ½éƒ¨ç½²åœ¨äº†å“ªäº›æœºå™¨ä¸Šï¼Œåœ¨ç›‘å¬å“ªäº›ç«¯å£å·ã€‚ ç„¶åRibbonå°±å¯ä»¥ä½¿ç”¨é»˜è®¤çš„Round Robinç®—æ³•ï¼Œä»ä¸­é€‰æ‹©ä¸€å°æœºå™¨ Feignå°±ä¼šé’ˆå¯¹è¿™å°æœºå™¨ï¼Œæ„é€ å¹¶å‘èµ·è¯·æ±‚ã€‚ æ ¸å¿ƒç»„ä»¶ï¼šHystrix Hystrixç›¸å½“äºSpringcloudä¸­çš„ä¿é™©ï¼Œä½œç”¨æ˜¯éš”ç¦»ã€ç†”æ–­ä»¥åŠé™çº§ï¼Œé¿å…å› ä¸ºæŸäº›æœåŠ¡çš„ä¸å¯ç”¨å¯¼è‡´æœåŠ¡é›ªå´©é—®é¢˜. ä¸šåŠ¡åœºæ™¯ä¸ºä¾‹ï¼šè®¢å•æœåŠ¡åœ¨ä¸€ä¸ªä¸šåŠ¡æµç¨‹é‡Œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡ã€‚ç°åœ¨å‡è®¾è®¢å•æœåŠ¡è‡ªå·±æœ€å¤šåªæœ‰100ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œç„¶åå‘¢ï¼Œç§¯åˆ†æœåŠ¡ä¸å¹¸çš„æŒ‚äº†ï¼Œæ¯æ¬¡è®¢å•æœåŠ¡è°ƒç”¨ç§¯åˆ†æœåŠ¡çš„æ—¶å€™ï¼Œéƒ½ä¼šå¡ä½å‡ ç§’é’Ÿï¼Œç„¶åæŠ›å‡ºâ€”ä¸ªè¶…æ—¶å¼‚å¸¸ã€‚ è¿™æ ·ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœç³»ç»Ÿå¤„äºé«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¤§é‡è¯·æ±‚æ¶Œè¿‡æ¥çš„æ—¶å€™ï¼Œè®¢å•æœåŠ¡çš„100ä¸ªçº¿ç¨‹éƒ½ä¼šå¡åœ¨è¯·æ±‚ç§¯åˆ†æœåŠ¡è¿™å—ã€‚å¯¼è‡´è®¢å•æœåŠ¡æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†è¯·æ±‚ ç„¶åå°±ä¼šå¯¼è‡´åˆ«äººè¯·æ±‚è®¢å•æœåŠ¡çš„æ—¶å€™ï¼Œå‘ç°è®¢å•æœåŠ¡ä¹ŸæŒ‚äº†ï¼Œä¸å“åº”ä»»ä½•è¯·æ±‚äº† è¿™ä¸ªå°±æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­ææ€–çš„æœåŠ¡é›ªå´©é—®é¢˜ æœåŠ¡é›ªå´©é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ Hystrixä¼šæå¾ˆå¤šä¸ªå°å°çš„çº¿ç¨‹æ± ï¼Œæ¯”å¦‚è®¢å•æœåŠ¡è¯·æ±‚åº“å­˜æœåŠ¡æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¯·æ±‚ä»“å‚¨æœåŠ¡æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¯·æ±‚ç§¯åˆ†æœåŠ¡æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ã€‚æ¯ä¸ªçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹å°±ä»…ä»…ç”¨äºè¯·æ±‚é‚£ä¸ªæœåŠ¡ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼šç°åœ¨å¾ˆä¸å¹¸ï¼Œç§¯åˆ†æœåŠ¡æŒ‚äº†ï¼Œä¼šå’‹æ ·ï¼Ÿ å½“ç„¶ä¼šå¯¼è‡´è®¢å•æœåŠ¡é‡Œçš„é‚£ä¸ªç”¨æ¥è°ƒç”¨ç§¯åˆ†æœåŠ¡çš„çº¿ç¨‹éƒ½å¡æ­»ä¸èƒ½å·¥ä½œäº†å•Šï¼ä½†æ˜¯ç”±äºè®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡ã€ä»“å‚¨æœåŠ¡çš„è¿™ä¸¤ä¸ªçº¿ç¨‹æ± éƒ½æ˜¯æ­£å¸¸å·¥ä½œçš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæœåŠ¡ä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚ è¿™ä¸ªæ—¶å€™å¦‚æœåˆ«äººè¯·æ±‚è®¢å•æœåŠ¡ï¼Œè®¢å•æœåŠ¡è¿˜æ˜¯å¯ä»¥æ­£å¸¸è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ï¼Œè°ƒç”¨ä»“å‚¨æœåŠ¡é€šçŸ¥å‘è´§ã€‚åªä¸è¿‡è°ƒç”¨ç§¯åˆ†æœåŠ¡çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½ä¼šæŠ¥é”™ã€‚ä½†æ˜¯å¦‚æœç§¯åˆ†æœåŠ¡éƒ½æŒ‚äº†ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦å»å¡ä½å‡ ç§’é’Ÿå¹²å•¥å‘¢ï¼Ÿæœ‰æ„ä¹‰å—ï¼Ÿå½“ç„¶æ²¡æœ‰ï¼æ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯¹ç§¯åˆ†æœåŠ¡ç†”æ–­ä¸å°±å¾—äº†ï¼Œæ¯”å¦‚åœ¨5åˆ†é’Ÿå†…è¯·æ±‚ç§¯åˆ†æœåŠ¡ç›´æ¥å°±è¿”å›äº†ï¼Œä¸è¦å»èµ°ç½‘ç»œè¯·æ±‚å¡ä½å‡ ç§’é’Ÿï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯æ‰€è°“çš„ç†”æ–­ï¼ é‚£äººå®¶åˆè¯´ï¼Œå…„å¼Ÿï¼Œç§¯åˆ†æœåŠ¡æŒ‚äº†ä½ å°±ç†”æ–­ï¼Œå¥½æ­¹ä½ å¹²ç‚¹å„¿ä»€ä¹ˆå•Šï¼åˆ«å•¥éƒ½ä¸å¹²å°±ç›´æ¥è¿”å›å•Šï¼Ÿæ²¡é—®é¢˜ï¼Œå’±ä»¬å°±æ¥ä¸ªé™çº§ï¼šæ¯æ¬¡è°ƒç”¨ç§¯åˆ†æœåŠ¡ï¼Œä½ å°±åœ¨æ•°æ®åº“é‡Œè®°å½•ä¸€æ¡æ¶ˆæ¯ï¼Œè¯´ç»™æŸæŸç”¨æˆ·å¢åŠ äº†å¤šå°‘ç§¯åˆ†ï¼Œå› ä¸ºç§¯åˆ†æœåŠ¡æŒ‚äº†ï¼Œå¯¼è‡´æ²¡å¢åŠ æˆåŠŸï¼è¿™æ ·ç­‰ç§¯åˆ†æœåŠ¡æ¢å¤äº†ï¼Œä½ å¯ä»¥æ ¹æ®è¿™äº›è®°å½•æ‰‹å·¥åŠ ä¸€ä¸‹ç§¯åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯æ‰€è°“çš„é™çº§ã€‚ æ ¸å¿ƒç»„ä»¶ï¼šZuul Zuulï¼Œä¹Ÿå°±æ˜¯å¾®æœåŠ¡ç½‘å…³ï¼Œè¿™ä¸ªç»„ä»¶æ˜¯è´Ÿè´£ç½‘ç»œè·¯ç”±çš„. å‡è®¾ä½ åå°éƒ¨ç½²äº†å‡ ç™¾ä¸ªæœåŠ¡ï¼Œç°åœ¨æœ‰ä¸ªå‰ç«¯å…„å¼Ÿï¼Œäººå®¶è¯·æ±‚æ˜¯ç›´æ¥ä»æµè§ˆå™¨é‚£å„¿å‘è¿‡æ¥çš„ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼šäººå®¶è¦è¯·æ±‚ä¸€ä¸‹åº“å­˜æœåŠ¡ï¼Œä½ éš¾é“è¿˜è®©äººå®¶è®°ç€è¿™æœåŠ¡çš„åå­—å«åšinventory-serviceï¼Ÿéƒ¨ç½²åœ¨5å°æœºå™¨ä¸Šï¼Ÿå°±ç®—äººå®¶è‚¯è®°ä½è¿™ä¸€ä¸ªï¼Œä½ åå°å¯æœ‰å‡ ç™¾ä¸ªæœåŠ¡çš„åç§°å’Œåœ°å€å‘¢ï¼Ÿéš¾ä¸æˆäººå®¶è¯·æ±‚ä¸€ä¸ªï¼Œå°±å¾—è®°ä½ä¸€ä¸ªï¼Ÿä½ è¦è¿™æ ·ç©å„¿ï¼Œé‚£çœŸæ˜¯å‹è°Šçš„å°èˆ¹ï¼Œè¯´ç¿»å°±ç¿»ï¼ ä¸Šé¢è¿™ç§æƒ…å†µï¼Œå‹æ ¹å„¿æ˜¯ä¸ç°å®çš„ã€‚æ‰€ä»¥ä¸€èˆ¬å¾®æœåŠ¡æ¶æ„ä¸­éƒ½å¿…ç„¶ä¼šè®¾è®¡ä¸€ä¸ªç½‘å…³åœ¨é‡Œé¢ï¼Œåƒandroidã€iosã€pcå‰ç«¯ã€å¾®ä¿¡å°ç¨‹åºã€H5ç­‰ç­‰ï¼Œä¸ç”¨å»å…³å¿ƒåç«¯æœ‰å‡ ç™¾ä¸ªæœåŠ¡ï¼Œå°±çŸ¥é“æœ‰ä¸€ä¸ªç½‘å…³ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¾€ç½‘å…³èµ°ï¼Œç½‘å…³ä¼šæ ¹æ®è¯·æ±‚ä¸­çš„ä¸€äº›ç‰¹å¾ï¼Œå°†è¯·æ±‚è½¬å‘ç»™åç«¯çš„å„ä¸ªæœåŠ¡ã€‚ è€Œä¸”æœ‰ä¸€ä¸ªç½‘å…³ä¹‹åï¼Œè¿˜æœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚å¯ä»¥åšç»Ÿä¸€çš„é™çº§ã€é™æµã€è®¤è¯æˆæƒã€å®‰å…¨ï¼Œç­‰ç­‰ã€‚ æ€»ç»“ Eurekaï¼šå„ä¸ªæœåŠ¡å¯åŠ¨æ—¶ï¼ŒEureka Clientéƒ½ä¼šå°†æœåŠ¡æ³¨å†Œåˆ°Eureka Serverï¼Œå¹¶ä¸”Eureka Clientè¿˜å¯ä»¥åè¿‡æ¥ä»Eureka Serveræ‹‰å–æ³¨å†Œè¡¨ï¼Œä»è€ŒçŸ¥é“å…¶ä»–æœåŠ¡åœ¨å“ªé‡Œ Ribbonï¼šæœåŠ¡é—´å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼ŒåŸºäºRibbonåšè´Ÿè½½å‡è¡¡ï¼Œä»ä¸€ä¸ªæœåŠ¡çš„å¤šå°æœºå™¨ä¸­é€‰æ‹©ä¸€å° Feignï¼šåŸºäºFeignçš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£å’Œé€‰æ‹©çš„æœºå™¨ï¼Œæ‹¼æ¥è¯·æ±‚URLåœ°å€ï¼Œå‘èµ·è¯·æ±‚ Hystrixï¼šå‘èµ·è¯·æ±‚æ˜¯é€šè¿‡Hystrixçš„çº¿ç¨‹æ± æ¥èµ°çš„ï¼Œä¸åŒçš„æœåŠ¡èµ°ä¸åŒçš„çº¿ç¨‹æ± ï¼Œå®ç°äº†ä¸åŒæœåŠ¡è°ƒç”¨çš„éš”ç¦»ï¼Œé¿å…äº†æœåŠ¡é›ªå´©çš„é—®é¢˜ Zuulï¼šå¦‚æœå‰ç«¯ã€ç§»åŠ¨ç«¯è¦è°ƒç”¨åç«¯ç³»ç»Ÿï¼Œç»Ÿä¸€ä»Zuulç½‘å…³è¿›å…¥ï¼Œç”±Zuulç½‘å…³è½¬å‘è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡","categories":[{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/categories/SpringCloud/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://blog.tgyf.com/tags/SpringCloud/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆå…­ï¼‰å¦‚æœå†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº”è¯¥æ€æ ·è€ƒè™‘?","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆå…­ï¼‰å¦‚æœå†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº”è¯¥æ€æ ·è€ƒè™‘","date":"2020-03-04T06:45:47.084Z","updated":"2020-03-04T06:45:47.084Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆå…­ï¼‰å¦‚æœå†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº”è¯¥æ€æ ·è€ƒè™‘/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E5%85%AD%EF%BC%89%E5%A6%82%E6%9E%9C%E5%86%99%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%80%8E%E6%A0%B7%E8%80%83%E8%99%91/","excerpt":"","text":"å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½æ²¡è€ƒè™‘è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºå¹³æ—¶çš„å·¥ä½œä¸­é™¤éæ˜¯æ¡†æ¶éƒ¨é—¨çš„ï¼Œä¸ç„¶å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬éƒ½æ˜¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯å»ææ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶çš„å¼€å‘. ä¹‹æ‰€ä»¥æœ‰è¿™ç¯‡æ€è€ƒæ€§çš„æ–‡ç« ï¼Œä¸»è¦æ˜¯ä¹‹å‰ç”±äºä¹‹å‰å»é¢è¯•ä¸€å®¶å…¬å¸è¢«é—®åˆ°æ€æ ·å»è®¾è®¡ä¸€ä¸ªmybatisçš„æ¡†æ¶.å…¶å®è¿™ç±»é—®é¢˜éƒ½æ˜¯å¯ä»¥å‘æ•£çš„ï¼Œæ¯”å¦‚è¿˜å¯ä»¥æ€è€ƒæ€æ ·å»è®¾è®¡springæ¡†æ¶ã€dubboæ¡†æ¶ã€nettyæ¡†æ¶ã€springcloudæ¡†æ¶ç­‰ç­‰. å…¶å®ï¼Œè¯´ç™½äº†å°±æ˜¯å¯¹æ¯”å‡ ä¸ªåŒç±»å‹äº§å“ï¼ŒæŠ€æœ¯çš„åŸºæœ¬åŸç†ï¼Œæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼ŒåŸºæœ¬æ¶æ„æ„æˆï¼Œç„¶åå‚ç…§ä»–ä»¬æ‹¿å‡ºä¸€ä¸ªç³»ç»Ÿè®¾è®¡å‡ºæ¥çš„æ€è·¯. è®¾è®¡è€ƒè™‘çš„å‡ ä¸ªæ–¹å‘ å¯ä¼¸ç¼©æ€§ å°±æ˜¯éœ€è¦çš„æ—¶å€™å¿«é€Ÿæ‰©å®¹ï¼Œå°±å¯ä»¥å¢åŠ ååé‡å’Œå®¹é‡ï¼Œé‚£æ€ä¹ˆæï¼Ÿè®¾è®¡ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿå‘—ï¼Œå‚ç…§ä¸€ä¸‹kafkaçš„è®¾è®¡ç†å¿µï¼Œbroker -&gt; topic -&gt; partitionï¼Œæ¯ä¸ªpartitionæ”¾ä¸€ä¸ªæœºå™¨ï¼Œå°±å­˜ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœç°åœ¨èµ„æºä¸å¤Ÿäº†ï¼Œç®€å•å•Šï¼Œç»™topicå¢åŠ partitionï¼Œç„¶ååšæ•°æ®è¿ç§»ï¼Œå¢åŠ æœºå™¨ï¼Œä¸å°±å¯ä»¥å­˜æ”¾æ›´å¤šæ•°æ®ï¼Œæä¾›æ›´é«˜çš„ååé‡äº†ï¼Ÿ æ•°æ®è½ç›˜ è½ç£ç›˜ï¼Œæ‰èƒ½ä¿è¯åˆ«è¿›ç¨‹æŒ‚äº†æ•°æ®å°±ä¸¢äº†ã€‚é‚£è½ç£ç›˜çš„æ—¶å€™æ€ä¹ˆè½å•Šï¼Ÿé¡ºåºå†™ï¼Œè¿™æ ·å°±æ²¡æœ‰ç£ç›˜éšæœºè¯»å†™çš„å¯»å€å¼€é”€ï¼Œç£ç›˜é¡ºåºè¯»å†™çš„æ€§èƒ½æ˜¯å¾ˆé«˜çš„ï¼Œè¿™å°±æ˜¯kafkaçš„æ€è·¯ã€‚ å¯ç”¨æ€§ å‚è€ƒä¸€ä¸‹kafkaçš„é«˜å¯ç”¨ä¿éšœæœºåˆ¶ã€‚å¤šå‰¯æœ¬ -&gt; leader &amp; follower -&gt; brokeræŒ‚äº†é‡æ–°é€‰ä¸¾leaderå³å¯å¯¹å¤–æœåŠ¡ã€‚ æ•°æ®é›¶ä¸¢å¤± å‚è€ƒkafkaæ•°æ®é›¶ä¸¢å¤±æ–¹æ¡ˆ","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆäº”ï¼‰æ¶ˆæ¯é˜Ÿåˆ—é‡Œäº§ç”Ÿç§¯å‹æ€ä¹ˆè§£å†³ï¼Ÿ","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆäº”ï¼‰æ¶ˆæ¯é˜Ÿåˆ—é‡Œäº§ç”Ÿç§¯å‹æ€ä¹ˆè§£å†³","date":"2020-03-04T06:18:17.269Z","updated":"2020-03-04T06:18:17.269Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆäº”ï¼‰æ¶ˆæ¯é˜Ÿåˆ—é‡Œäº§ç”Ÿç§¯å‹æ€ä¹ˆè§£å†³/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E4%BA%94%EF%BC%89%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%87%8C%E4%BA%A7%E7%94%9F%E7%A7%AF%E5%8E%8B%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3/","excerpt":"","text":"æ¶ˆæ¯ç§¯å‹å¸¸è§çš„é—®é¢˜ å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿ æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ æ¶ˆæ¯ç§¯å‹æƒ…æ™¯å†ç° å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ç°åœ¨æ¶ˆè´¹ç«¯å‡ºæ•…éšœäº†ï¼Œç„¶åå¤§é‡æ¶ˆæ¯åœ¨mqé‡Œç§¯å‹ï¼Œå‡ºç°ç”Ÿäº§äº‹æ•…äº†. åœºæ™¯ä¸€:å¤§é‡æ¶ˆæ¯åœ¨mqé‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³ å‡ åƒä¸‡æ¡æ•°æ®åœ¨MQé‡Œç§¯å‹äº†ä¸ƒå…«ä¸ªå°æ—¶ï¼Œä»ä¸‹åˆ4ç‚¹å¤šï¼Œç§¯å‹åˆ°äº†æ™šä¸Šå¾ˆæ™šï¼Œ10ç‚¹å¤šï¼Œ11ç‚¹å¤š è¿™ä¸ªæ—¶å€™è¦ä¸ç„¶å°±æ˜¯ä¿®å¤consumerçš„é—®é¢˜ï¼Œè®©ä»–æ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå‚»å‚»çš„ç­‰å¾…å‡ ä¸ªå°æ—¶æ¶ˆè´¹å®Œæ¯•ã€‚è¿™ä¸ªè‚¯å®šä¸èƒ½åœ¨é¢è¯•çš„æ—¶å€™è¯´å§ã€‚ ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ç§’æ˜¯1000æ¡ï¼Œä¸€ç§’3ä¸ªæ¶ˆè´¹è€…æ˜¯3000æ¡ï¼Œä¸€åˆ†é’Ÿæ˜¯18ä¸‡æ¡ï¼Œ1000å¤šä¸‡æ¡ æ‰€ä»¥å¦‚æœä½ ç§¯å‹äº†å‡ ç™¾ä¸‡åˆ°ä¸Šåƒä¸‡çš„æ•°æ®ï¼Œå³ä½¿æ¶ˆè´¹è€…æ¢å¤äº†ï¼Œä¹Ÿéœ€è¦å¤§æ¦‚1å°æ—¶çš„æ—¶é—´æ‰èƒ½æ¢å¤è¿‡æ¥ ä¸€èˆ¬è¿™ä¸ªæ—¶å€™ï¼Œåªèƒ½æ“ä½œä¸´æ—¶ç´§æ€¥æ‰©å®¹äº†ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å’Œæ€è·¯å¦‚ä¸‹ï¼š å…ˆä¿®å¤consumerçš„é—®é¢˜ï¼Œç¡®ä¿å…¶æ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå°†ç°æœ‰cnosumeréƒ½åœæ‰ æ–°å»ºä¸€ä¸ªtopicï¼Œpartitionæ˜¯åŸæ¥çš„10å€ï¼Œä¸´æ—¶å»ºç«‹å¥½åŸå…ˆ10å€æˆ–è€…20å€çš„queueæ•°é‡ ç„¶åå†™ä¸€ä¸ªä¸´æ—¶çš„åˆ†å‘æ•°æ®çš„consumerç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéƒ¨ç½²ä¸Šå»æ¶ˆè´¹ç§¯å‹çš„æ•°æ®ï¼Œæ¶ˆè´¹ä¹‹åä¸åšè€—æ—¶çš„å¤„ç†ï¼Œç›´æ¥å‡åŒ€è½®è¯¢å†™å…¥ä¸´æ—¶å»ºç«‹å¥½çš„10å€æ•°é‡çš„queue æ¥ç€ä¸´æ—¶å¾ç”¨10å€çš„æœºå™¨æ¥éƒ¨ç½²consumerï¼Œæ¯ä¸€æ‰¹consumeræ¶ˆè´¹ä¸€ä¸ªä¸´æ—¶queueçš„æ•°æ® è¿™ç§åšæ³•ç›¸å½“äºæ˜¯ä¸´æ—¶å°†queueèµ„æºå’Œconsumerèµ„æºæ‰©å¤§10å€ï¼Œä»¥æ­£å¸¸çš„10å€é€Ÿåº¦æ¥æ¶ˆè´¹æ•°æ® ç­‰å¿«é€Ÿæ¶ˆè´¹å®Œç§¯å‹æ•°æ®ä¹‹åï¼Œå¾—æ¢å¤åŸå…ˆéƒ¨ç½²æ¶æ„ï¼Œé‡æ–°ç”¨åŸå…ˆçš„consumeræœºå™¨æ¥æ¶ˆè´¹æ¶ˆæ¯ åœºæ™¯äºŒ:è¶…è¿‡rabbitmqè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰æ•°æ®ç›´æ¥è¢«æ¸…ç†æ‰ è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå°±ä¸æ˜¯è¯´è¦å¢åŠ consumeræ¶ˆè´¹ç§¯å‹çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®é™…ä¸Šæ²¡å•¥ç§¯å‹ï¼Œè€Œæ˜¯ä¸¢äº†å¤§é‡çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€ä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯æ‰¹é‡é‡å¯¼ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰çº¿ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„åœºæ™¯å¹²è¿‡ã€‚å°±æ˜¯å¤§é‡ç§¯å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“æ—¶å°±ç›´æ¥ä¸¢å¼ƒæ•°æ®äº†ï¼Œç„¶åç­‰è¿‡äº†é«˜å³°æœŸä»¥åï¼Œæ¯”å¦‚å¤§å®¶ä¸€èµ·å–å’–å•¡ç†¬å¤œåˆ°æ™šä¸Š12ç‚¹ä»¥åï¼Œç”¨æˆ·éƒ½ç¡è§‰äº†ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¼€å§‹å†™ç¨‹åºï¼Œå°†ä¸¢å¤±çš„é‚£æ‰¹æ•°æ®ï¼Œå†™ä¸ªä¸´æ—¶ç¨‹åºï¼Œä¸€ç‚¹ä¸€ç‚¹çš„æŸ¥å‡ºæ¥ï¼Œç„¶åé‡æ–°çŒå…¥mqé‡Œé¢å»ï¼ŒæŠŠç™½å¤©ä¸¢çš„æ•°æ®ç»™ä»–è¡¥å›æ¥ã€‚ä¹Ÿåªèƒ½æ˜¯è¿™æ ·äº†ã€‚ å‡è®¾1ä¸‡ä¸ªè®¢å•ç§¯å‹åœ¨mqé‡Œé¢ï¼Œæ²¡æœ‰å¤„ç†ï¼Œå…¶ä¸­1000ä¸ªè®¢å•éƒ½ä¸¢äº†ï¼Œä½ åªèƒ½æ‰‹åŠ¨å†™ç¨‹åºæŠŠé‚£1000ä¸ªè®¢å•ç»™æŸ¥å‡ºæ¥ï¼Œæ‰‹åŠ¨å‘åˆ°mqé‡Œå»å†è¡¥ä¸€æ¬¡ åœºæ™¯ä¸‰:å¤§é‡æ¶ˆæ¯åœ¨mqé‡Œç§¯å‹é•¿æ—¶é—´éƒ½æ²¡å¤„ç†æ‰ï¼Œå¯¼è‡´mqå¿«å†™æ»¡äº† ä¸´æ—¶å†™ç¨‹åºï¼Œæ¥å…¥æ•°æ®æ¥æ¶ˆè´¹ï¼Œæ¶ˆè´¹ä¸€ä¸ªä¸¢å¼ƒä¸€ä¸ªï¼Œéƒ½ä¸è¦äº†ï¼Œå¿«é€Ÿæ¶ˆè´¹æ‰æ‰€æœ‰çš„æ¶ˆæ¯ã€‚ç„¶åèµ°ç¬¬äºŒä¸ªåœºæ™¯çš„æ–¹æ¡ˆï¼Œåˆ°äº†æ™šä¸Šå†è¡¥æ•°æ®å§ã€‚","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆå››ï¼‰ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ‹¿åˆ°çš„æ•°æ®æŒ‰é¡ºåºæ‰§è¡Œæ€ä¹ˆä¿è¯ï¼Ÿ","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆå››ï¼‰ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ‹¿åˆ°çš„æ•°æ®æŒ‰é¡ºåºæ‰§è¡Œæ€ä¹ˆä¿è¯","date":"2020-03-04T05:57:17.413Z","updated":"2020-03-04T05:57:17.414Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆå››ï¼‰ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ‹¿åˆ°çš„æ•°æ®æŒ‰é¡ºåºæ‰§è¡Œæ€ä¹ˆä¿è¯/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%87%8C%E6%8B%BF%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81/","excerpt":"","text":"å‡è®¾çš„ä¸€ä¸ªæ¶ˆæ¯çš„é¡ºåºæ€§æƒ…æ™¯ è¦åšä¸€ä¸ªmysql binlogåŒæ­¥çš„ç³»ç»Ÿï¼Œåœ¨mysqlé‡Œå¢åˆ æ”¹ä¸€æ¡æ•°æ®ï¼Œå¯¹åº”å‡ºæ¥äº†å¢åˆ æ”¹3æ¡binlogï¼Œæ¥ç€è¿™ä¸‰æ¡binlogå‘é€åˆ°MQé‡Œé¢ï¼Œåˆ°æ¶ˆè´¹å‡ºæ¥ä¾æ¬¡æ‰§è¡Œï¼Œèµ·ç å¾—ä¿è¯äººå®¶æ˜¯æŒ‰ç…§é¡ºåºæ¥çš„å§ï¼Ÿä¸ç„¶æœ¬æ¥æ˜¯ï¼šå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼›ä½ æ¥æ˜¯æ¢äº†é¡ºåºç»™æ‰§è¡Œæˆåˆ é™¤ã€ä¿®æ”¹ã€å¢åŠ ï¼Œä¸å…¨é”™äº†ä¹ˆ. rabbitmqæ¶ˆæ¯çš„é¡ºåºæ€§ rabbitmqé”™ä¹±çš„åœºæ™¯ ä¸€ä¸ªqueueï¼Œå¤šä¸ªconsumer. rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ æ‹†åˆ†å¤šä¸ªqueueï¼Œæ¯ä¸ªqueueä¸€ä¸ªconsumerï¼Œå°±æ˜¯å¤šä¸€äº›queueè€Œå·²ï¼Œç¡®å®æ˜¯éº»çƒ¦ç‚¹ï¼›æˆ–è€…å°±ä¸€ä¸ªqueueä½†æ˜¯å¯¹åº”ä¸€ä¸ªconsumerï¼Œç„¶åè¿™ä¸ªconsumerå†…éƒ¨ç”¨å†…å­˜é˜Ÿåˆ—åšæ’é˜Ÿï¼Œç„¶ååˆ†å‘ç»™åº•å±‚ä¸åŒçš„workeræ¥å¤„ç†. kafkaæ¶ˆæ¯çš„é¡ºåºæ€§ kafkaé”™ä¹±çš„åœºæ™¯ ä¸€ä¸ªtopicï¼Œä¸€ä¸ªpartitionï¼Œä¸€ä¸ªconsumerï¼Œå†…éƒ¨å¤šçº¿ç¨‹. kafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ ä¸€ä¸ªtopicï¼Œä¸€ä¸ªpartitionï¼Œä¸€ä¸ªconsumerï¼Œå†…éƒ¨å•çº¿ç¨‹æ¶ˆè´¹ï¼Œå†™Nä¸ªå†…å­˜queueï¼Œç„¶åNä¸ªçº¿ç¨‹åˆ†åˆ«æ¶ˆè´¹ä¸€ä¸ªå†…å­˜queueå³å¯","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆä¸‰ï¼‰å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢çš„æ•°æ®ä¸è§äº†æ€ä¹ˆåŠ?","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆä¸‰ï¼‰å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢çš„æ•°æ®ä¸è§äº†æ€ä¹ˆåŠ","date":"2020-03-04T05:45:36.942Z","updated":"2020-03-04T05:45:36.942Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆä¸‰ï¼‰å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢çš„æ•°æ®ä¸è§äº†æ€ä¹ˆåŠ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E4%B8%89%EF%BC%89%E5%8F%91%E5%88%B0%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E8%A7%81%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E/","excerpt":"","text":"ç”¨mqæœ‰ä¸ªåŸºæœ¬åŸåˆ™ï¼šæ•°æ®ä¸èƒ½å¤šä¸€æ¡ï¼Œä¹Ÿä¸èƒ½å°‘ä¸€æ¡. ä¸èƒ½å¤šï¼Œå°±æ˜¯é‡å¤æ¶ˆè´¹å’Œå¹‚ç­‰æ€§é—®é¢˜. ä¸èƒ½å°‘ï¼Œå°±æ˜¯è¯´è¿™æ•°æ®åˆ«æä¸¢äº†. ä¸¢æ•°æ®çš„æƒ…æ™¯ ä¸¢æ•°æ®ï¼Œmqå¤§ä½“ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ï¼š è¦ä¹ˆæ˜¯æˆ‘ä»¬æŠŠæ¶ˆæ¯é€è¾¾mqçš„æ—¶å€™å¼„ä¸¢äº† è¦ä¹ˆæ˜¯mqè‡ªå·±å¼„ä¸¢äº† è¦ä¹ˆæ˜¯æˆ‘ä»¬æ¶ˆè´¹mqçš„æ—¶å€™å¼„ä¸¢äº† rabbitmqä¸¢æ•°æ®çš„ä¸‰ç§æƒ…æ™¯ ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ® ç”Ÿäº§è€…å°†æ•°æ®å‘é€åˆ°rabbitmqçš„æ—¶å€™ï¼Œå¯èƒ½æ•°æ®å°±åœ¨åŠè·¯ç»™æä¸¢äº†ï¼Œå› ä¸ºç½‘ç»œå•¥çš„é—®é¢˜ï¼Œéƒ½æœ‰å¯èƒ½ã€‚ æ­¤æ—¶å¯ä»¥é€‰æ‹©ç”¨rabbitmqæä¾›çš„äº‹åŠ¡åŠŸèƒ½ï¼Œå°±æ˜¯ç”Ÿäº§è€…å‘é€æ•°æ®ä¹‹å‰å¼€å¯rabbitmqäº‹åŠ¡ï¼ˆchannel.txSelectï¼‰ï¼Œç„¶åå‘é€æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰æˆåŠŸè¢«rabbitmqæ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šæ”¶åˆ°å¼‚å¸¸æŠ¥é”™ï¼Œæ­¤æ—¶å°±å¯ä»¥å›æ»šäº‹åŠ¡ï¼ˆchannel.txRollbackï¼‰ï¼Œç„¶åé‡è¯•å‘é€æ¶ˆæ¯ï¼›å¦‚æœæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥æäº¤äº‹åŠ¡ï¼ˆchannel.txCommitï¼‰ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œrabbitmqäº‹åŠ¡æœºåˆ¶ä¸€æï¼ŒåŸºæœ¬ä¸Šååé‡ä¼šä¸‹æ¥ï¼Œå› ä¸ºå¤ªè€—æ€§èƒ½ã€‚ æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ è¦ç¡®ä¿è¯´å†™rabbitmqçš„æ¶ˆæ¯åˆ«ä¸¢ï¼Œå¯ä»¥å¼€å¯confirmæ¨¡å¼ï¼Œåœ¨ç”Ÿäº§è€…é‚£é‡Œè®¾ç½®å¼€å¯confirmæ¨¡å¼ä¹‹åï¼Œä½ æ¯æ¬¡å†™çš„æ¶ˆæ¯éƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idï¼Œç„¶åå¦‚æœå†™å…¥äº†rabbitmqä¸­ï¼Œrabbitmqä¼šç»™ä½ å›ä¼ ä¸€ä¸ªackæ¶ˆæ¯ï¼Œå‘Šè¯‰ä½ è¯´è¿™ä¸ªæ¶ˆæ¯okäº†ã€‚å¦‚æœrabbitmqæ²¡èƒ½å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œä¼šå›è°ƒä½ ä¸€ä¸ªnackæ¥å£ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶å¤±è´¥ï¼Œä½ å¯ä»¥é‡è¯•ã€‚è€Œä¸”ä½ å¯ä»¥ç»“åˆè¿™ä¸ªæœºåˆ¶è‡ªå·±åœ¨å†…å­˜é‡Œç»´æŠ¤æ¯ä¸ªæ¶ˆæ¯idçš„çŠ¶æ€ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´è¿˜æ²¡æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯çš„å›è°ƒï¼Œé‚£ä¹ˆä½ å¯ä»¥é‡å‘ã€‚ äº‹åŠ¡æœºåˆ¶å’Œcnofirmæœºåˆ¶æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œäº‹åŠ¡æœºåˆ¶æ˜¯åŒæ­¥çš„ï¼Œä½ æäº¤ä¸€ä¸ªäº‹åŠ¡ä¹‹åä¼šé˜»å¡åœ¨é‚£å„¿ï¼Œä½†æ˜¯confirmæœºåˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œä½ å‘é€ä¸ªæ¶ˆæ¯ä¹‹åå°±å¯ä»¥å‘é€ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åé‚£ä¸ªæ¶ˆæ¯rabbitmqæ¥æ”¶äº†ä¹‹åä¼šå¼‚æ­¥å›è°ƒä½ ä¸€ä¸ªæ¥å£é€šçŸ¥ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶åˆ°äº†ã€‚ æ‰€ä»¥ä¸€èˆ¬åœ¨ç”Ÿäº§è€…è¿™å—é¿å…æ•°æ®ä¸¢å¤±ï¼Œéƒ½æ˜¯ç”¨confirmæœºåˆ¶çš„ã€‚ rabbitmqå¼„ä¸¢äº†æ•°æ® å°±æ˜¯rabbitmqè‡ªå·±å¼„ä¸¢äº†æ•°æ®ï¼Œè¿™ä¸ªä½ å¿…é¡»å¼€å¯rabbitmqçš„æŒä¹…åŒ–ï¼Œå°±æ˜¯æ¶ˆæ¯å†™å…¥ä¹‹åä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå“ªæ€•æ˜¯rabbitmqè‡ªå·±æŒ‚äº†ï¼Œæ¢å¤ä¹‹åä¼šè‡ªåŠ¨è¯»å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®ï¼Œä¸€èˆ¬æ•°æ®ä¸ä¼šä¸¢ã€‚é™¤éæå…¶ç½•è§çš„æ˜¯ï¼Œrabbitmqè¿˜æ²¡æŒä¹…åŒ–ï¼Œè‡ªå·±å°±æŒ‚äº†ï¼Œå¯èƒ½å¯¼è‡´å°‘é‡æ•°æ®ä¼šä¸¢å¤±çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡è¾ƒå°ã€‚ è®¾ç½®æŒä¹…åŒ–æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆ›å»ºqueueçš„æ—¶å€™å°†å…¶è®¾ç½®ä¸ºæŒä¹…åŒ–çš„ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯rabbitmqæŒä¹…åŒ–queueçš„å…ƒæ•°æ®ï¼Œä½†æ˜¯ä¸ä¼šæŒä¹…åŒ–queueé‡Œçš„æ•°æ®ï¼›ç¬¬äºŒä¸ªæ˜¯å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†æ¶ˆæ¯çš„deliveryModeè®¾ç½®ä¸º2ï¼Œå°±æ˜¯å°†æ¶ˆæ¯è®¾ç½®ä¸ºæŒä¹…åŒ–çš„ï¼Œæ­¤æ—¶rabbitmqå°±ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šå»ã€‚å¿…é¡»è¦åŒæ—¶è®¾ç½®è¿™ä¸¤ä¸ªæŒä¹…åŒ–æ‰è¡Œï¼Œrabbitmqå“ªæ€•æ˜¯æŒ‚äº†ï¼Œå†æ¬¡é‡å¯ï¼Œä¹Ÿä¼šä»ç£ç›˜ä¸Šé‡å¯æ¢å¤queueï¼Œæ¢å¤è¿™ä¸ªqueueé‡Œçš„æ•°æ®ã€‚ è€Œä¸”æŒä¹…åŒ–å¯ä»¥è·Ÿç”Ÿäº§è€…é‚£è¾¹çš„confirmæœºåˆ¶é…åˆèµ·æ¥ï¼Œåªæœ‰æ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹åï¼Œæ‰ä¼šé€šçŸ¥ç”Ÿäº§è€…ackäº†ï¼Œæ‰€ä»¥å“ªæ€•æ˜¯åœ¨æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰ï¼ŒrabbitmqæŒ‚äº†ï¼Œæ•°æ®ä¸¢äº†ï¼Œç”Ÿäº§è€…æ”¶ä¸åˆ°ackï¼Œä½ ä¹Ÿæ˜¯å¯ä»¥è‡ªå·±é‡å‘çš„ã€‚ å“ªæ€•æ˜¯ä½ ç»™rabbitmqå¼€å¯äº†æŒä¹…åŒ–æœºåˆ¶ï¼Œä¹Ÿæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿™ä¸ªæ¶ˆæ¯å†™åˆ°äº†rabbitmqä¸­ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œç»“æœä¸å·§ï¼Œæ­¤æ—¶rabbitmqæŒ‚äº†ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜é‡Œçš„ä¸€ç‚¹ç‚¹æ•°æ®ä¼šä¸¢å¤±ã€‚ æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ® rabbitmqå¦‚æœä¸¢å¤±äº†æ•°æ®ï¼Œä¸»è¦æ˜¯å› ä¸ºä½ æ¶ˆè´¹çš„æ—¶å€™ï¼Œåˆšæ¶ˆè´¹åˆ°ï¼Œè¿˜æ²¡å¤„ç†ï¼Œç»“æœè¿›ç¨‹æŒ‚äº†ï¼Œæ¯”å¦‚é‡å¯äº†ï¼Œé‚£ä¹ˆå°±å°´å°¬äº†ï¼Œrabbitmqè®¤ä¸ºä½ éƒ½æ¶ˆè´¹äº†ï¼Œè¿™æ•°æ®å°±ä¸¢äº†ã€‚ è¿™ä¸ªæ—¶å€™å¾—ç”¨rabbitmqæä¾›çš„ackæœºåˆ¶ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½ å…³é—­rabbitmqè‡ªåŠ¨ackï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªapiæ¥è°ƒç”¨å°±è¡Œï¼Œç„¶åæ¯æ¬¡ä½ è‡ªå·±ä»£ç é‡Œç¡®ä¿å¤„ç†å®Œçš„æ—¶å€™ï¼Œå†ç¨‹åºé‡Œackä¸€æŠŠã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœä½ è¿˜æ²¡å¤„ç†å®Œï¼Œä¸å°±æ²¡æœ‰ackï¼Ÿé‚£rabbitmqå°±è®¤ä¸ºä½ è¿˜æ²¡å¤„ç†å®Œï¼Œè¿™ä¸ªæ—¶å€™rabbitmqä¼šæŠŠè¿™ä¸ªæ¶ˆè´¹åˆ†é…ç»™åˆ«çš„consumerå»å¤„ç†ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢çš„ã€‚ kafkaä¸¢æ•°æ®çš„æƒ…æ™¯ æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ® å”¯ä¸€å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…å¼„ä¸¢æ•°æ®çš„æƒ…å†µï¼Œå°±æ˜¯è¯´ï¼Œä½ é‚£ä¸ªæ¶ˆè´¹åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶åæ¶ˆè´¹è€…é‚£è¾¹è‡ªåŠ¨æäº¤äº†offsetï¼Œè®©kafkaä»¥ä¸ºä½ å·²ç»æ¶ˆè´¹å¥½äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œå…¶å®ä½ åˆšå‡†å¤‡å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œä½ è¿˜æ²¡å¤„ç†ï¼Œä½ è‡ªå·±å°±æŒ‚äº†ï¼Œæ­¤æ—¶è¿™æ¡æ¶ˆæ¯å°±ä¸¢å’¯ã€‚ è¿™ä¸æ˜¯ä¸€æ ·ä¹ˆï¼Œå¤§å®¶éƒ½çŸ¥é“kafkaä¼šè‡ªåŠ¨æäº¤offsetï¼Œé‚£ä¹ˆåªè¦å…³é—­è‡ªåŠ¨æäº¤offsetï¼Œåœ¨å¤„ç†å®Œä¹‹åè‡ªå·±æ‰‹åŠ¨æäº¤offsetï¼Œå°±å¯ä»¥ä¿è¯æ•°æ®ä¸ä¼šä¸¢ã€‚ä½†æ˜¯æ­¤æ—¶ç¡®å®è¿˜æ˜¯ä¼šé‡å¤æ¶ˆè´¹ï¼Œæ¯”å¦‚ä½ åˆšå¤„ç†å®Œï¼Œè¿˜æ²¡æäº¤offsetï¼Œç»“æœè‡ªå·±æŒ‚äº†ï¼Œæ­¤æ—¶è‚¯å®šä¼šé‡å¤æ¶ˆè´¹ä¸€æ¬¡ï¼Œè‡ªå·±ä¿è¯å¹‚ç­‰æ€§å°±å¥½äº†ã€‚ ç”Ÿäº§ç¯å¢ƒç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬çš„kafkaæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†æ•°æ®ä¹‹åæ˜¯å†™åˆ°ä¸€ä¸ªå†…å­˜çš„queueé‡Œå…ˆç¼“å†²ä¸€ä¸‹ï¼Œç»“æœæœ‰çš„æ—¶å€™ï¼Œä½ åˆšæŠŠæ¶ˆæ¯å†™å…¥å†…å­˜queueï¼Œç„¶åæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æäº¤offsetã€‚ ç„¶åæ­¤æ—¶æˆ‘ä»¬é‡å¯äº†ç³»ç»Ÿï¼Œå°±ä¼šå¯¼è‡´å†…å­˜queueé‡Œè¿˜æ²¡æ¥å¾—åŠå¤„ç†çš„æ•°æ®å°±ä¸¢å¤±äº† kafkaå¼„ä¸¢äº†æ•°æ® è¿™å—æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯kafkaæŸä¸ªbrokerå®•æœºï¼Œç„¶åé‡æ–°é€‰ä¸¾partitonçš„leaderæ—¶ã€‚å¤§å®¶æƒ³æƒ³ï¼Œè¦æ˜¯æ­¤æ—¶å…¶ä»–çš„followeråˆšå¥½è¿˜æœ‰äº›æ•°æ®æ²¡æœ‰åŒæ­¥ï¼Œç»“æœæ­¤æ—¶leaderæŒ‚äº†ï¼Œç„¶åé€‰ä¸¾æŸä¸ªfolloweræˆleaderä¹‹åï¼Œä»–ä¸å°±å°‘äº†ä¸€äº›æ•°æ®ï¼Ÿè¿™å°±ä¸¢äº†ä¸€äº›æ•°æ®å•Šã€‚ ç”Ÿäº§ç¯å¢ƒä¹Ÿé‡åˆ°è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ï¼Œä¹‹å‰kafkaçš„leaderæœºå™¨å®•æœºäº†ï¼Œå°†followeråˆ‡æ¢ä¸ºleaderä¹‹åï¼Œå°±ä¼šå‘ç°è¯´è¿™ä¸ªæ•°æ®å°±ä¸¢äº† æ‰€ä»¥æ­¤æ—¶ä¸€èˆ¬æ˜¯è¦æ±‚èµ·ç è®¾ç½®å¦‚ä¸‹4ä¸ªå‚æ•°ï¼š ç»™è¿™ä¸ªtopicè®¾ç½®replication.factorå‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº1ï¼Œè¦æ±‚æ¯ä¸ªpartitionå¿…é¡»æœ‰è‡³å°‘2ä¸ªå‰¯æœ¬ åœ¨kafkaæœåŠ¡ç«¯è®¾ç½®min.insync.replicaså‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº1ï¼Œè¿™ä¸ªæ˜¯è¦æ±‚ä¸€ä¸ªleaderè‡³å°‘æ„ŸçŸ¥åˆ°æœ‰è‡³å°‘ä¸€ä¸ªfollowerè¿˜è·Ÿè‡ªå·±ä¿æŒè”ç³»ï¼Œæ²¡æ‰é˜Ÿï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿leaderæŒ‚äº†è¿˜æœ‰ä¸€ä¸ªfollowerå§ åœ¨producerç«¯è®¾ç½®acks=allï¼šè¿™ä¸ªæ˜¯è¦æ±‚æ¯æ¡æ•°æ®ï¼Œå¿…é¡»æ˜¯å†™å…¥æ‰€æœ‰replicaä¹‹åï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯å†™æˆåŠŸäº† åœ¨producerç«¯è®¾ç½®retries=MAXï¼ˆå¾ˆå¤§å¾ˆå¤§å¾ˆå¤§çš„ä¸€ä¸ªå€¼ï¼Œæ— é™æ¬¡é‡è¯•çš„æ„æ€ï¼‰ï¼šè¿™ä¸ªæ˜¯è¦æ±‚ä¸€æ—¦å†™å…¥å¤±è´¥ï¼Œå°±æ— é™é‡è¯•ï¼Œå¡åœ¨è¿™é‡Œäº† æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒå°±æ˜¯æŒ‰ç…§ä¸Šè¿°è¦æ±‚é…ç½®çš„ï¼Œè¿™æ ·é…ç½®ä¹‹åï¼Œè‡³å°‘åœ¨kafka brokerç«¯å°±å¯ä»¥ä¿è¯åœ¨leaderæ‰€åœ¨brokerå‘ç”Ÿæ•…éšœï¼Œè¿›è¡Œleaderåˆ‡æ¢æ—¶ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤± ç”Ÿäº§è€…ä¼šä¸ä¼šå¼„ä¸¢æ•°æ® å¦‚æœæŒ‰ç…§ä¸Šè¿°çš„æ€è·¯è®¾ç½®äº†ack=allï¼Œä¸€å®šä¸ä¼šä¸¢ï¼Œè¦æ±‚æ˜¯ï¼Œä½ çš„leaderæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰€æœ‰çš„followeréƒ½åŒæ­¥åˆ°äº†æ¶ˆæ¯ä¹‹åï¼Œæ‰è®¤ä¸ºæœ¬æ¬¡å†™æˆåŠŸäº†ã€‚å¦‚æœæ²¡æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨ä¸æ–­çš„é‡è¯•ï¼Œé‡è¯•æ— é™æ¬¡ã€‚","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆä¸€ï¼‰å¦‚æœMQæŒ‚äº†æ€ä¹ˆåŠ?","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆä¸€ï¼‰å¦‚æœMQæŒ‚äº†æ€ä¹ˆåŠ","date":"2020-03-04T05:08:46.039Z","updated":"2020-03-04T05:08:46.039Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆä¸€ï¼‰å¦‚æœMQæŒ‚äº†æ€ä¹ˆåŠ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E4%B8%80%EF%BC%89%E5%A6%82%E6%9E%9CMQ%E6%8C%82%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E/","excerpt":"","text":"å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Ÿ å¦‚æœMQæŒ‚äº†ï¼Œå¯¼è‡´å‡ ä¸ªå°æ—¶ç³»ç»Ÿä¸å¯ç”¨ï¼Œå…¬å¸æŸå¤±å‡ åƒä¸‡ï¼ŒTeamèƒŒé”…ï¼Œä½ é—¹çš„ç¥¸ï¼Œä½ è€å¤§å¸®ä½ ä¸€èµ·èƒŒé”…. æ‰€ä»¥è¯´ï¼Œåœ¨éå¸¸æ ¸å¿ƒçš„ç³»ç»Ÿé‡Œï¼Œä¸€å®šè¦è€ƒè™‘å¼•å…¥MQæ‰€å¯¼è‡´ç³»ç»Ÿå¯ç”¨æ€§é™ä½çš„é—®é¢˜. RabbitMQçš„é«˜å¯ç”¨æ€§ Rabbitmqæœ‰ä¸‰ç§æ¨¡å¼ï¼šå•æœºæ¨¡å¼ï¼Œæ™®é€šé›†ç¾¤æ¨¡å¼ï¼Œé•œåƒé›†ç¾¤æ¨¡å¼. RabbitMQ â€“ å•æœºæ¨¡å¼ å°±æ˜¯demoçº§åˆ«çš„ï¼Œä¸€èˆ¬å°±æ˜¯ä½ æœ¬åœ°å¯åŠ¨äº†ç©ç©å„¿çš„ï¼Œç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œæ²¡äººåœ¨ç”Ÿäº§ç¯å¢ƒç”¨å•æœºæ¨¡å¼. RabbitMQ â€“ æ™®é€šé›†ç¾¤æ¨¡å¼ å°±æ˜¯åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªrabbitmqå®ä¾‹ï¼Œæ¯ä¸ªæœºå™¨å¯åŠ¨ä¸€ä¸ª.ä½†æ˜¯ä½ åˆ›å»ºçš„queueï¼Œåªä¼šæ”¾åœ¨ä¸€ä¸ªrabbtimqå®ä¾‹ä¸Šï¼Œä½†æ˜¯æ¯ä¸ªå®ä¾‹éƒ½åŒæ­¥queueçš„å…ƒæ•°æ®.å®Œäº†ä½ æ¶ˆè´¹çš„æ—¶å€™ï¼Œå®é™…ä¸Šå¦‚æœè¿æ¥åˆ°äº†å¦å¤–ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆé‚£ä¸ªå®ä¾‹ä¼šä»queueæ‰€åœ¨å®ä¾‹ä¸Šæ‹‰å–æ•°æ®è¿‡æ¥. ç¼ºç‚¹ï¼š è¿™ç§æ–¹å¼ç¡®å®å¾ˆéº»çƒ¦ï¼Œä¹Ÿä¸æ€ä¹ˆå¥½ï¼Œæ²¡åšåˆ°æ‰€è°“çš„åˆ†å¸ƒå¼ï¼Œå°±æ˜¯ä¸ªæ™®é€šé›†ç¾¤.å› ä¸ºè¿™å¯¼è‡´ä½ è¦ä¹ˆæ¶ˆè´¹è€…æ¯æ¬¡éšæœºè¿æ¥ä¸€ä¸ªå®ä¾‹ç„¶åæ‹‰å–æ•°æ®ï¼Œè¦ä¹ˆå›ºå®šè¿æ¥é‚£ä¸ªqueueæ‰€åœ¨å®ä¾‹æ¶ˆè´¹æ•°æ®ï¼Œå‰è€…æœ‰æ•°æ®æ‹‰å–çš„å¼€é”€ï¼Œåè€…å¯¼è‡´å•å®ä¾‹æ€§èƒ½ç“¶é¢ˆ. å¦‚æœé‚£ä¸ªæ”¾queueçš„å®ä¾‹å®•æœºäº†ï¼Œä¼šå¯¼è‡´æ¥ä¸‹æ¥å…¶ä»–å®ä¾‹å°±æ— æ³•ä»é‚£ä¸ªå®ä¾‹æ‹‰å–ï¼Œå¦‚æœä½ å¼€å¯äº†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œè®©rabbitmqè½åœ°å­˜å‚¨æ¶ˆæ¯çš„è¯ï¼Œæ¶ˆæ¯ä¸ä¸€å®šä¼šä¸¢ï¼Œå¾—ç­‰è¿™ä¸ªå®ä¾‹æ¢å¤äº†ï¼Œç„¶åæ‰å¯ä»¥ç»§ç»­ä»è¿™ä¸ªqueueæ‹‰å–æ•°æ®. æ€»ç»“ï¼š æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°è¿™å°±æ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„é«˜å¯ç”¨æ€§å¯è¨€äº†ï¼Œè¿™æ–¹æ¡ˆä¸»è¦æ˜¯æé«˜ååé‡çš„ï¼Œå°±æ˜¯è¯´è®©é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹æ¥æœåŠ¡æŸä¸ªqueueçš„è¯»å†™æ“ä½œ. RabbitMQ â€“ é•œåƒé›†ç¾¤æ¨¡å¼ è¿™ç§æ¨¡å¼ï¼Œæ‰æ˜¯æ‰€è°“çš„rabbitmqçš„é«˜å¯ç”¨æ¨¡å¼ï¼Œè·Ÿæ™®é€šé›†ç¾¤æ¨¡å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œä½ åˆ›å»ºçš„queueï¼Œæ— è®ºå…ƒæ•°æ®è¿˜æ˜¯queueé‡Œçš„æ¶ˆæ¯éƒ½ä¼šå­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸Šï¼Œç„¶åæ¯æ¬¡ä½ å†™æ¶ˆæ¯åˆ°queueçš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠæ¶ˆæ¯åˆ°å¤šä¸ªå®ä¾‹çš„queueé‡Œè¿›è¡Œæ¶ˆæ¯åŒæ­¥. ä¼˜ç‚¹ï¼š ä½ ä»»ä½•ä¸€ä¸ªæœºå™¨å®•æœºäº†ï¼Œæ²¡äº‹å„¿ï¼Œåˆ«çš„æœºå™¨éƒ½å¯ä»¥ç”¨. ç¼ºç‚¹ï¼š ç¬¬ä¸€ è¿™ä¸ªæ€§èƒ½å¼€é”€å¤ªå¤§äº†ï¼Œæ¶ˆæ¯åŒæ­¥æ‰€æœ‰æœºå™¨ï¼Œå¯¼è‡´ç½‘ç»œå¸¦å®½å‹åŠ›å’Œæ¶ˆè€—å¾ˆé‡ï¼ ç¬¬äºŒ è¿™ä¹ˆç©ï¼Œå°±æ²¡æœ‰æ‰©å±•æ€§å¯è¨€äº†ï¼Œå¦‚æœæŸä¸ªqueueè´Ÿè½½å¾ˆé‡ï¼Œä½ åŠ æœºå™¨ï¼Œæ–°å¢çš„æœºå™¨ä¹ŸåŒ…å«äº†è¿™ä¸ªqueueçš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶æ²¡æœ‰åŠæ³•çº¿æ€§æ‰©å±•ä½ çš„queue. æ€ä¹ˆå¼€å¯é•œåƒé›†ç¾¤æ¨¡å¼? rabbitmqæœ‰å¾ˆå¥½çš„ç®¡ç†æ§åˆ¶å°ï¼Œå°±æ˜¯åœ¨åå°æ–°å¢ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯é•œåƒé›†ç¾¤æ¨¡å¼çš„ç­–ç•¥ï¼ŒæŒ‡å®šçš„æ—¶å€™å¯ä»¥è¦æ±‚æ•°æ®åŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ï¼Œä¹Ÿå¯ä»¥è¦æ±‚å°±åŒæ­¥åˆ°æŒ‡å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œç„¶åä½ å†æ¬¡åˆ›å»ºqueueçš„æ—¶å€™ï¼Œåº”ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå°±ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šå»äº†. kafkaçš„é«˜å¯ç”¨æ€§ kafkaæœ€åŸºæœ¬çš„æ¶æ„è®¤è¯† å¤šä¸ªbrokerç»„æˆï¼Œæ¯ä¸ªbrokeræ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›ä½ åˆ›å»ºä¸€ä¸ªtopicï¼Œè¿™ä¸ªtopicå¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionå¯ä»¥å­˜åœ¨äºä¸åŒçš„brokerä¸Šï¼Œæ¯ä¸ªpartitionå°±æ”¾ä¸€éƒ¨åˆ†æ•°æ®. è¿™å°±æ˜¯å¤©ç„¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªtopicçš„æ•°æ®ï¼Œæ˜¯åˆ†æ•£æ”¾åœ¨å¤šä¸ªæœºå™¨ä¸Šçš„ï¼Œæ¯ä¸ªæœºå™¨å°±æ”¾ä¸€éƒ¨åˆ†æ•°æ®. å®é™…ä¸Šrabbitmqä¹‹ç±»çš„ï¼Œå¹¶ä¸æ˜¯åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»–å°±æ˜¯ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªä¸è¿‡æä¾›äº†ä¸€äº›é›†ç¾¤ã€HAçš„æœºåˆ¶è€Œå·²ï¼Œå› ä¸ºæ— è®ºæ€ä¹ˆç©å„¿ï¼Œrabbitmqä¸€ä¸ªqueueçš„æ•°æ®éƒ½æ˜¯æ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹é‡Œçš„ï¼Œé•œåƒé›†ç¾¤ä¸‹ï¼Œä¹Ÿæ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æ”¾è¿™ä¸ªqueueçš„å®Œæ•´æ•°æ®. kafkaçš„HAæœºåˆ¶ kafka 0.8ä»¥å‰ï¼Œæ˜¯æ²¡æœ‰HAæœºåˆ¶çš„ï¼Œå°±æ˜¯ä»»ä½•ä¸€ä¸ªbrokerå®•æœºäº†ï¼Œé‚£ä¸ªbrokerä¸Šçš„partitionå°±åºŸäº†ï¼Œæ²¡æ³•å†™ä¹Ÿæ²¡æ³•è¯»ï¼Œæ²¡æœ‰ä»€ä¹ˆé«˜å¯ç”¨æ€§å¯è¨€. kafka 0.8ä»¥åï¼Œæä¾›äº†HAæœºåˆ¶ï¼Œå°±æ˜¯replicaå‰¯æœ¬æœºåˆ¶.æ¯ä¸ªpartitionçš„æ•°æ®éƒ½ä¼šåŒæ­¥åˆ°å‰ä»–æœºå™¨ä¸Šï¼Œå½¢æˆè‡ªå·±çš„å¤šä¸ªreplicaå‰¯æœ¬.ç„¶åæ‰€æœ‰replicaä¼šé€‰ä¸¾ä¸€ä¸ªleaderå‡ºæ¥ï¼Œé‚£ä¹ˆç”Ÿäº§å’Œæ¶ˆè´¹éƒ½è·Ÿè¿™ä¸ªleaderæ‰“äº¤é“ï¼Œç„¶åå…¶ä»–replicaå°±æ˜¯follower.å†™çš„æ—¶å€™ï¼Œleaderä¼šè´Ÿè´£æŠŠæ•°æ®åŒæ­¥åˆ°æ‰€æœ‰followerä¸Šå»ï¼Œè¯»çš„æ—¶å€™å°±ç›´æ¥è¯»leaderä¸Šæ•°æ®å³å¯.åªèƒ½è¯»å†™leaderï¼Ÿå¾ˆç®€å•ï¼Œè¦æ˜¯ä½ å¯ä»¥éšæ„è¯»å†™æ¯ä¸ªfollowerï¼Œé‚£ä¹ˆå°±è¦careæ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œç³»ç»Ÿå¤æ‚åº¦å¤ªé«˜ï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜.kafkaä¼šå‡åŒ€çš„å°†ä¸€ä¸ªpartitionçš„æ‰€æœ‰replicaåˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·æ‰å¯ä»¥æé«˜å®¹é”™æ€§. å°±æœ‰æ‰€è°“çš„é«˜å¯ç”¨æ€§äº†ï¼Œå› ä¸ºå¦‚æœæŸä¸ªbrokerå®•æœºäº†ï¼Œæ²¡äº‹å„¿ï¼Œé‚£ä¸ªbrokerä¸Šé¢çš„partitionåœ¨å…¶ä»–æœºå™¨ä¸Šéƒ½æœ‰å‰¯æœ¬çš„ï¼Œå¦‚æœè¿™ä¸Šé¢æœ‰æŸä¸ªpartitionçš„leaderï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šé‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„leaderå‡ºæ¥ï¼Œå¤§å®¶ç»§ç»­è¯»å†™é‚£ä¸ªæ–°çš„leaderå³å¯.è¿™å°±æœ‰æ‰€è°“çš„é«˜å¯ç”¨æ€§äº†. å†™æ•°æ®çš„æ—¶å€™ï¼Œç”Ÿäº§è€…å°±å†™leaderï¼Œç„¶åleaderå°†æ•°æ®è½åœ°å†™æœ¬åœ°ç£ç›˜ï¼Œæ¥ç€å…¶ä»–followerè‡ªå·±ä¸»åŠ¨ä»leaderæ¥pullæ•°æ®.ä¸€æ—¦æ‰€æœ‰followeråŒæ­¥å¥½æ•°æ®äº†ï¼Œå°±ä¼šå‘é€ackç»™leaderï¼Œleaderæ”¶åˆ°æ‰€æœ‰followerçš„ackä¹‹åï¼Œå°±ä¼šè¿”å›å†™æˆåŠŸçš„æ¶ˆæ¯ç»™ç”Ÿäº§è€….ï¼ˆå½“ç„¶ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§æ¨¡å¼ï¼Œè¿˜å¯ä»¥é€‚å½“è°ƒæ•´è¿™ä¸ªè¡Œä¸ºï¼‰ æ¶ˆè´¹çš„æ—¶å€™ï¼Œåªä¼šä»leaderå»è¯»ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å·²ç»è¢«æ‰€æœ‰followeréƒ½åŒæ­¥æˆåŠŸè¿”å›ackçš„æ—¶å€™ï¼Œè¿™ä¸ªæ¶ˆæ¯æ‰ä¼šè¢«æ¶ˆè´¹è€…è¯»åˆ°.","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"LinkedListæºç åˆ†æ","slug":"JavaåŸºç¡€/LinkedListæºç åˆ†æ","date":"2020-03-04T05:02:08.647Z","updated":"2020-03-04T05:02:08.648Z","comments":true,"path":"2020/03/04/JavaåŸºç¡€/LinkedListæºç åˆ†æ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Java%E5%9F%BA%E7%A1%80/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"LinkedListä»‹ç» LinkedList æ˜¯ Java é›†åˆæ¡†æ¶ä¸­ä¸€ä¸ªé‡è¦çš„å®ç°ï¼Œå…¶åº•å±‚é‡‡ç”¨çš„åŒå‘é“¾è¡¨ç»“æ„.å’Œ ArrayList ä¸€æ ·ï¼ŒLinkedList ä¹Ÿæ”¯æŒç©ºå€¼å’Œé‡å¤å€¼.ç”±äº LinkedList åŸºäºé“¾è¡¨å®ç°ï¼Œå­˜å‚¨å…ƒç´ è¿‡ç¨‹ä¸­ï¼Œæ— éœ€åƒ ArrayList é‚£æ ·è¿›è¡Œæ‰©å®¹.ä½†æœ‰å¾—å¿…æœ‰å¤±ï¼ŒLinkedList å­˜å‚¨å…ƒç´ çš„èŠ‚ç‚¹éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨å‰é©±å’Œåç»§çš„å¼•ç”¨.å¦ä¸€æ–¹é¢ï¼ŒLinkedList åœ¨é“¾è¡¨å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†åœ¨æŒ‡å®šä½ç½®è¿›è¡Œæ’å…¥æ—¶ï¼Œæ•ˆç‡ä¸€èˆ¬.åŸå› æ˜¯ï¼Œåœ¨æŒ‡å®šä½ç½®æ’å…¥éœ€è¦å®šä½åˆ°è¯¥ä½ç½®å¤„çš„èŠ‚ç‚¹ï¼Œæ­¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N).æœ€åï¼ŒLinkedList æ˜¯éçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œå¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ LinkedListï¼Œä¼šå¼•å‘ä¸å¯é¢„çŸ¥çš„é”™è¯¯. ç»§æ‰¿ä½“ç³» LinkedList çš„ç»§æ‰¿ä½“ç³»è¾ƒä¸ºå¤æ‚ï¼Œç»§æ‰¿è‡ª AbstractSequentialListï¼ŒåŒæ—¶åˆå®ç°äº† List å’Œ Deque æ¥å£.ç»§æ‰¿ä½“ç³»å›¾å¦‚ä¸‹: LinkedList ç»§æ‰¿è‡ª AbstractSequentialListï¼ŒAbstractSequentialList åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»å®ç°ä¸Šï¼ŒAbstractSequentialList æä¾›äº†ä¸€å¥—åŸºäºé¡ºåºè®¿é—®çš„æ¥å£.é€šè¿‡ç»§æ‰¿æ­¤ç±»ï¼Œå­ç±»ä»…éœ€å®ç°éƒ¨åˆ†ä»£ç å³å¯æ‹¥æœ‰å®Œæ•´çš„ä¸€å¥—è®¿é—®æŸç§åºåˆ—è¡¨ï¼ˆæ¯”å¦‚é“¾è¡¨ï¼‰çš„æ¥å£.æ·±å…¥æºç ï¼ŒAbstractSequentialList æä¾›çš„æ–¹æ³•åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ ListIterator å®ç°çš„ï¼Œæ¯”å¦‚ï¼š 123456789101112131415161718public E get(int index) &#123; try &#123; return listIterator(index).next(); &#125; catch (NoSuchElementException exc) &#123; throw new IndexOutOfBoundsException(\"Index: \"+index); &#125;&#125;public void add(int index, E element) &#123; try &#123; listIterator(index).add(element); &#125; catch (NoSuchElementException exc) &#123; throw new IndexOutOfBoundsException(\"Index: \"+index); &#125;&#125;// ç•™ç»™å­ç±»å®ç°public abstract ListIterator&lt;E&gt; listIterator(int index); æ‰€ä»¥åªè¦ç»§æ‰¿ç±»å®ç°äº† listIterator æ–¹æ³•ï¼Œå®ƒä¸éœ€è¦å†é¢å¤–å®ç°ä»€ä¹ˆå³å¯ä½¿ç”¨.å¯¹äºéšæœºè®¿é—®é›†åˆç±»ä¸€èˆ¬å»ºè®®ç»§æ‰¿ AbstractList è€Œä¸æ˜¯ AbstractSequentialList.LinkedList å’Œå…¶çˆ¶ç±»ä¸€æ ·ï¼Œä¹Ÿæ˜¯åŸºäºé¡ºåºè®¿é—®.æ‰€ä»¥ LinkedList ç»§æ‰¿äº† AbstractSequentialListï¼Œä½† LinkedList å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œæ˜¯é‡æ–°å®ç°äº†ä¸€å¥—çš„æ–¹æ³•. å¦å¤–ï¼ŒLinkedList è¿˜å®ç°äº† Deque (double ended queue)ï¼ŒDeque åˆç»§æ‰¿è‡ª Queue æ¥å£.è¿™æ · LinkedList å°±å…·å¤‡äº†é˜Ÿåˆ—çš„åŠŸèƒ½.æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š 1Queue&lt;T&gt; queue = new LinkedList&lt;&gt;(); é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åŸºäº LinkedList è¿˜å¯ä»¥å®ç°ä¸€äº›å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ ˆï¼Œä»¥æ­¤æ¥æ›¿æ¢ Java é›†åˆæ¡†æ¶ä¸­çš„ Stack ç±»ï¼ˆè¯¥ç±»å®ç°çš„ä¸å¥½ï¼Œã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹ä¸€ä¹¦çš„ä½œè€…ä¹Ÿå¯¹æ­¤ç±»è¿›è¡Œäº†åæ§½ï¼‰. å…³äº LinkedList ç»§æ‰¿ä½“ç³»å…ˆè¯´åˆ°è¿™ï¼Œä¸‹é¢è¿›å…¥æºç åˆ†æéƒ¨åˆ†. æºç åˆ†æ æŸ¥æ‰¾ LinkedList åº•å±‚åŸºäºé“¾è¡¨ç»“æ„ï¼Œæ— æ³•å‘ ArrayList é‚£æ ·éšæœºè®¿é—®æŒ‡å®šä½ç½®çš„å…ƒç´ .LinkedList æŸ¥æ‰¾è¿‡ç¨‹è¦ç¨éº»çƒ¦ä¸€äº›ï¼Œéœ€è¦ä»é“¾è¡¨å¤´ç»“ç‚¹ï¼ˆæˆ–å°¾èŠ‚ç‚¹ï¼‰å‘åæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N).ç›¸å…³æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223public E get(int index) &#123; checkElementIndex(index); return node(index).item;&#125;Node&lt;E&gt; node(int index) &#123; /* * åˆ™ä»å¤´èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œå¦åˆ™ä»å°¾èŠ‚ç‚¹æŸ¥æ‰¾ * æŸ¥æ‰¾ä½ç½® index å¦‚æœå°äºèŠ‚ç‚¹æ•°é‡çš„ä¸€åŠï¼Œ */ if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; // å¾ªç¯å‘åæŸ¥æ‰¾ï¼Œç›´è‡³ i == index for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; ä¸Šé¢çš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡éå†çš„æ–¹å¼å®šä½ç›®æ ‡ä½ç½®çš„èŠ‚ç‚¹.è·å–åˆ°èŠ‚ç‚¹åï¼Œå–å‡ºèŠ‚ç‚¹å­˜å‚¨çš„å€¼è¿”å›å³å¯.è¿™é‡Œé¢æœ‰ä¸ªå°ä¼˜åŒ–ï¼Œå³é€šè¿‡æ¯”è¾ƒ index ä¸èŠ‚ç‚¹æ•°é‡ size/2 çš„å¤§å°ï¼Œå†³å®šä»å¤´ç»“ç‚¹è¿˜æ˜¯å°¾èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾.æŸ¥æ‰¾æ“ä½œçš„ä»£ç æ²¡ä»€ä¹ˆå¤æ‚çš„åœ°æ–¹ï¼Œè¿™é‡Œå…ˆè®²åˆ°è¿™é‡Œ. éå† é“¾è¡¨çš„éå†è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œå’Œä¸Šé¢æŸ¥æ‰¾è¿‡ç¨‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä»å¤´èŠ‚ç‚¹å¾€åéå†å°±è¡Œäº†.ä½†å¯¹äº LinkedList çš„éå†è¿˜æ˜¯éœ€è¦æ³¨æ„ä¸€äº›ï¼Œä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´ä»£ç æ•ˆç‡ä½ä¸‹.é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ foreach éå† LinkedListï¼Œè€Œ foreach æœ€ç»ˆè½¬æ¢æˆè¿­ä»£å™¨å½¢å¼.æ‰€ä»¥åˆ†æ LinkedList çš„éå†çš„æ ¸å¿ƒå°±æ˜¯å®ƒçš„è¿­ä»£å™¨å®ç°ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435public ListIterator&lt;E&gt; listIterator(int index) &#123; checkPositionIndex(index); return new ListItr(index);&#125;private class ListItr implements ListIterator&lt;E&gt; &#123; private Node&lt;E&gt; lastReturned; private Node&lt;E&gt; next; private int nextIndex; private int expectedModCount = modCount; /** æ„é€ æ–¹æ³•å°† next å¼•ç”¨æŒ‡å‘æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ */ ListItr(int index) &#123; // assert isPositionIndex(index); next = (index == size) ? null : node(index); nextIndex = index; &#125; public boolean hasNext() &#123; return nextIndex &lt; size; &#125; public E next() &#123; checkForComodification(); if (!hasNext()) throw new NoSuchElementException(); lastReturned = next; next = next.next; // è°ƒç”¨ next æ–¹æ³•åï¼Œnext å¼•ç”¨éƒ½ä¼šæŒ‡å‘ä»–çš„åç»§èŠ‚ç‚¹ nextIndex++; return lastReturned.item; &#125; // çœç•¥éƒ¨åˆ†æ–¹æ³•&#125; ä¸Šé¢çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå¤§å®¶åº”è¯¥éƒ½èƒ½å¾ˆå¿«çœ‹æ‡‚ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†.ä¸‹é¢æ¥è¯´è¯´éå† LinkedList éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹. æˆ‘ä»¬éƒ½çŸ¥é“ LinkedList ä¸æ“…é•¿éšæœºä½ç½®è®¿é—®ï¼Œå¦‚æœå¤§å®¶ç”¨éšæœºè®¿é—®çš„æ–¹å¼éå† LinkedListï¼Œæ•ˆç‡ä¼šå¾ˆå·®.æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š 12345678List&lt;Integet&gt; list = new LinkedList&lt;&gt;();list.add(1)list.add(2)......for (int i = 0; i &lt; list.size(); i++) &#123; Integet item = list.get(i); // do something&#125; å½“é“¾è¡¨ä¸­å­˜å‚¨çš„å…ƒç´ å¾ˆå¤šæ—¶ï¼Œä¸Šé¢çš„éå†æ–¹å¼å¯¹äºæ•ˆç‡æ¥è¯´å°±æ˜¯ç¾éš¾.åŸå› åœ¨äºï¼Œé€šè¿‡ä¸Šé¢çš„æ–¹å¼æ¯è·å–ä¸€ä¸ªå…ƒç´ ï¼ŒLinkedList éƒ½éœ€è¦ä»å¤´èŠ‚ç‚¹ï¼ˆæˆ–å°¾èŠ‚ç‚¹ï¼‰è¿›è¡Œéå†ï¼Œæ•ˆç‡ä¸å¯è°“ä¸ä½.åœ¨æˆ‘çš„ç”µè„‘ï¼ˆMacBook Pro Early 2015, 2.7 GHz Intel Core i5ï¼‰å®æµ‹10ä¸‡çº§çš„æ•°æ®é‡ï¼Œè€—æ—¶çº¦7ç§’é’Ÿ.20ä¸‡çº§çš„æ•°æ®é‡è€—æ—¶è¾¾åˆ°äº†çº¦34ç§’çš„æ—¶é—´.50ä¸‡çº§çš„æ•°æ®é‡è€—æ—¶çº¦250ç§’.ä»æµ‹è¯•ç»“æœä¸Šæ¥çœ‹ï¼Œä¸Šé¢çš„éå†æ–¹å¼åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œæ•ˆç‡å¾ˆå·®.å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­åº”è¯¥å°½é‡é¿å…è¿™ç§ç”¨æ³•. æ’å…¥ LinkedList é™¤äº†å®ç°äº† List æ¥å£ç›¸å…³æ–¹æ³•ï¼Œè¿˜å®ç°äº† Deque æ¥å£çš„å¾ˆå¤šæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¾ˆå¤šç§æ–¹å¼æ’å…¥å…ƒç´ .ä½†è¿™é‡Œï¼Œæˆ‘åªæ‰“ç®—åˆ†æ List æ¥å£ä¸­ç›¸å…³çš„æ’å…¥æ–¹æ³•ï¼Œå…¶ä»–çš„æ–¹æ³•å¤§å®¶è‡ªå·±çœ‹å§.LinkedList æ’å…¥å…ƒç´ çš„è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯é“¾è¡¨é“¾å…¥èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå­¦è¿‡æ•°æ®ç»“æ„çš„åŒå­¦å¯¹æ­¤åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰äº†.è¿™é‡Œç®€å•åˆ†æä¸€ä¸‹ï¼Œå…ˆçœ‹æºç å§ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥å…ƒç´  */public boolean add(E e) &#123; linkLast(e); return true;&#125;/** åœ¨é“¾è¡¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  */public void add(int index, E element) &#123; checkPositionIndex(index); // åˆ¤æ–­ index æ˜¯ä¸æ˜¯é“¾è¡¨å°¾éƒ¨ä½ç½®ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥å°†å…ƒç´ èŠ‚ç‚¹æ’å…¥é“¾è¡¨å°¾éƒ¨å³å¯ if (index == size) linkLast(element); else linkBefore(element, node(index));&#125;/** å°†å…ƒç´ èŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨ */void linkLast(E e) &#123; final Node&lt;E&gt; l = last; // åˆ›å»ºèŠ‚ç‚¹ï¼Œå¹¶æŒ‡å®šèŠ‚ç‚¹å‰é©±ä¸ºé“¾è¡¨å°¾èŠ‚ç‚¹ lastï¼Œåç»§å¼•ç”¨ä¸ºç©º final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); // å°† last å¼•ç”¨æŒ‡å‘æ–°èŠ‚ç‚¹ last = newNode; // åˆ¤æ–­å°¾èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¡¨ç¤ºå½“å‰é“¾è¡¨è¿˜æ²¡æœ‰èŠ‚ç‚¹ if (l == null) first = newNode; else l.next = newNode; // è®©åŸå°¾èŠ‚ç‚¹åç»§å¼•ç”¨ next æŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ size++; modCount++;&#125;/** å°†å…ƒç´ èŠ‚ç‚¹æ’å…¥åˆ° succ ä¹‹å‰çš„ä½ç½® */void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; final Node&lt;E&gt; pred = succ.prev; // 1. åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œå¹¶æŒ‡æ˜å‰é©±å’Œåç»§èŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); // 2. å°† succ èŠ‚ç‚¹å‰é©±å¼•ç”¨ prev æŒ‡å‘æ–°èŠ‚ç‚¹ succ.prev = newNode; // åˆ¤æ–­å°¾èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¡¨ç¤ºå½“å‰é“¾è¡¨è¿˜æ²¡æœ‰èŠ‚ç‚¹ if (pred == null) first = newNode; else pred.next = newNode; // 3. succ èŠ‚ç‚¹å‰é©±çš„åç»§å¼•ç”¨æŒ‡å‘æ–°èŠ‚ç‚¹ size++; modCount++;&#125; ä¸Šé¢æ˜¯æ’å…¥è¿‡ç¨‹çš„æºç ï¼Œæˆ‘å¯¹æºç è¿›è¡Œäº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šï¼Œåº”è¯¥ä¸éš¾çœ‹æ‡‚.ä¸Šé¢ä¸¤ä¸ª add æ–¹æ³•åªæ˜¯å¯¹æ“ä½œé“¾è¡¨çš„æ–¹æ³•åšäº†ä¸€å±‚åŒ…è£…ï¼Œæ ¸å¿ƒé€»è¾‘åœ¨ linkBefore å’Œ linkLast ä¸­.è¿™é‡Œä»¥ linkBefore ä¸ºä¾‹ï¼Œå®ƒçš„é€»è¾‘æµç¨‹å¦‚ä¸‹ï¼š åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œå¹¶æŒ‡æ˜æ–°èŠ‚ç‚¹çš„å‰é©±å’Œåç»§ å°† succ çš„å‰é©±å¼•ç”¨æŒ‡å‘æ–°èŠ‚ç‚¹ å¦‚æœ succ çš„å‰é©±ä¸ä¸ºç©ºï¼Œåˆ™å°† succ å‰é©±çš„åç»§å¼•ç”¨æŒ‡å‘æ–°èŠ‚ç‚¹ åˆ é™¤ å¦‚æœå¤§å®¶çœ‹æ‡‚äº†ä¸Šé¢çš„æ’å…¥æºç åˆ†æï¼Œé‚£ä¹ˆå†çœ‹åˆ é™¤æ“ä½œå®é™…ä¸Šä¹Ÿå¾ˆç®€å•äº†.åˆ é™¤æ“ä½œé€šè¿‡è§£é™¤å¾…åˆ é™¤èŠ‚ç‚¹ä¸å‰åèŠ‚ç‚¹çš„é“¾æ¥ï¼Œå³å¯å®Œæˆä»»åŠ¡.è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œçœ‹æºç å§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public boolean remove(Object o) &#123; if (o == null) &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) &#123; unlink(x); return true; &#125; &#125; &#125; else &#123; // éå†é“¾è¡¨ï¼Œæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) &#123; unlink(x); // å°†èŠ‚ç‚¹ä»é“¾è¡¨ä¸­ç§»é™¤ return true; &#125; &#125; &#125; return false;&#125;public E remove(int index) &#123; checkElementIndex(index); // é€šè¿‡ node æ–¹æ³•å®šä½èŠ‚ç‚¹ï¼Œå¹¶è°ƒç”¨ unlink å°†èŠ‚ç‚¹ä»é“¾è¡¨ä¸­ç§»é™¤ return unlink(node(index));&#125;/** å°†æŸä¸ªèŠ‚ç‚¹ä»é“¾è¡¨ä¸­ç§»é™¤ */E unlink(Node&lt;E&gt; x) &#123; // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; final Node&lt;E&gt; prev = x.prev; // prev ä¸ºç©ºï¼Œè¡¨æ˜åˆ é™¤çš„æ˜¯å¤´èŠ‚ç‚¹ if (prev == null) &#123; first = next; &#125; else &#123; // å°† x çš„å‰é©±çš„åç»§æŒ‡å‘ x çš„åç»§ prev.next = next; // å°† x çš„å‰é©±å¼•ç”¨ç½®ç©ºï¼Œæ–­å¼€ä¸å‰é©±çš„é“¾æ¥ x.prev = null; &#125; // next ä¸ºç©ºï¼Œè¡¨æ˜åˆ é™¤çš„æ˜¯å°¾èŠ‚ç‚¹ if (next == null) &#123; last = prev; &#125; else &#123; // å°† x çš„åç»§çš„å‰é©±æŒ‡å‘ x çš„å‰é©± next.prev = prev; // å°† x çš„åç»§å¼•ç”¨ç½®ç©ºï¼Œæ–­å¼€ä¸åç»§çš„é“¾æ¥ x.next = null; &#125; // å°† item ç½®ç©ºï¼Œæ–¹ä¾¿ GC å›æ”¶ x.item = null; size--; modCount++; return element;&#125; å’Œæ’å…¥æ“ä½œä¸€æ ·ï¼Œåˆ é™¤æ“ä½œæ–¹æ³•ä¹Ÿæ˜¯å¯¹åº•å±‚æ–¹æ³•çš„ä¸€å±‚ä¿è¯ï¼Œæ ¸å¿ƒé€»è¾‘åœ¨åº•å±‚ unlink æ–¹æ³•ä¸­.æ‰€ä»¥é•¿é©±ç›´å…¥ï¼Œç›´æ¥åˆ†æ unlink æ–¹æ³•å§.unlink æ–¹æ³•çš„é€»è¾‘å¦‚ä¸‹ï¼ˆå‡è®¾åˆ é™¤çš„èŠ‚ç‚¹æ—¢ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œä¹Ÿä¸æ˜¯å°¾èŠ‚ç‚¹ï¼‰ï¼š å°†å¾…åˆ é™¤èŠ‚ç‚¹ x çš„å‰é©±çš„åç»§æŒ‡å‘ x çš„åç»§ å°†å¾…åˆ é™¤èŠ‚ç‚¹ x çš„å‰é©±å¼•ç”¨ç½®ç©ºï¼Œæ–­å¼€ä¸å‰é©±çš„é“¾æ¥ å°†å¾…åˆ é™¤èŠ‚ç‚¹ x çš„åç»§çš„å‰é©±æŒ‡å‘ x çš„å‰é©± å°†å¾…åˆ é™¤èŠ‚ç‚¹ x çš„åç»§å¼•ç”¨ç½®ç©ºï¼Œæ–­å¼€ä¸åç»§çš„é“¾æ¥ æ€»ç»“ é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¤§å®¶å¯¹ LinkedList çš„åº•å±‚å®ç°åº”è¯¥å¾ˆæ¸…æ¥šäº†.æ€»ä½“æ¥çœ‹ LinkedList çš„æºç å¹¶ä¸å¤æ‚ï¼Œå¤§å®¶è€å¿ƒçœ‹ä¸€ä¸‹ï¼Œä¸€èˆ¬éƒ½èƒ½çœ‹æ‡‚.","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"http://blog.tgyf.com/categories/Java%E5%9F%BA%E7%A1%80/"},{"name":"Javaé›†åˆæ¡†æ¶","slug":"JavaåŸºç¡€/Javaé›†åˆæ¡†æ¶","permalink":"http://blog.tgyf.com/categories/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://blog.tgyf.com/tags/Java/"},{"name":"LinkedList","slug":"LinkedList","permalink":"http://blog.tgyf.com/tags/LinkedList/"},{"name":"Javaé›†åˆæ¡†æ¶","slug":"Javaé›†åˆæ¡†æ¶","permalink":"http://blog.tgyf.com/tags/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/"}]},{"title":"å…³äºä¸­é—´ä»¶çš„ä¸€äº›æ€è€ƒ","slug":"Middleware/ThinkInMiddleware","date":"2020-03-04T01:57:25.884Z","updated":"2020-03-04T01:57:25.885Z","comments":true,"path":"2020/03/04/Middleware/ThinkInMiddleware/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/ThinkInMiddleware/","excerpt":"","text":"ä¸ºä»€ä¹ˆæœ‰è¿™ç¯‡æ–‡ç« ï¼Ÿ åœ¨é¡¹ç›®å›¢é˜Ÿä¸­å¾€å¾€æœ‰è¿™æ ·ä¸€äº›äººï¼Œå¹¶ä¸çŸ¥é“è‡ªå·±ä¸ºä»€ä¹ˆè¦åœ¨é¡¹ç›®ç”¨ä¸­é—´ä»¶è¿™ä¸ªä¸œè¥¿.å…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸ºäº†ç”¨è€Œç”¨.æˆ–è€…æ˜¯åˆ«äººè®¾è®¡çš„æ¶æ„ï¼Œä»å¤´åˆ°å°¾æ²¡æœ‰æ€è€ƒè¿‡.è¿™äº›äººç»™æˆ‘çš„æ˜ åƒå°±æ˜¯æœ¨å¤´æœ¨è„‘çš„å¹²å‘†æ´»å„¿ï¼Œä¸€æœ¬æ­£ç»çš„æŒ–å‘.ä¸ºäº†é¿å…ä»¥åå›¢é˜Ÿä¸­å‡ºç°è¿™ç±»å‹äººï¼Œæ‰€ä»¥æœ‰äº†è¿™ç¯‡æ€ç»´å¯¼å›¾å‹çš„æ–‡ç« . 1.ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªç±»å‹ä¸­é—´ä»¶ï¼Ÿ å…¶å®å°±æ˜¯è¿™ä¸ªä¸­é—´ä»¶éƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Œç„¶ååœ¨é¡¹ç›®é‡Œå…·ä½“æ˜¯ä»€ä¹ˆåœºæ™¯ï¼Œè¿™ä¸ªä¸šåŠ¡åœºæ™¯æœ‰ä¸ªä»€ä¹ˆæŠ€æœ¯æŒ‘æˆ˜ï¼Œå¦‚æœä¸ç”¨å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œä½†æ˜¯ä½ ç°åœ¨ç”¨äº†ä¹‹åå¸¦ç»™äº†ä½ å¾ˆå¤šçš„å¥½å¤„. 2.æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼ŸåŸç†æ˜¯æ€æ ·çš„ï¼Ÿ å¼•å…¥ä¸­é—´ä»¶ä¹‹åä¼šä¸ä¼šæœ‰ä»€ä¹ˆåå¤„ï¼Ÿè¦æ˜¯æ²¡è€ƒè™‘è¿‡è¿™ä¸ªï¼Œé‚£ç›²ç›®å¼„ä¸ªä¸­é—´ä»¶è¿›ç³»ç»Ÿé‡Œï¼Œåé¢å‡ºäº†é—®é¢˜æ˜¯ä¸æ˜¯å½“äº‹äººå°±æºœäº†ï¼Œè¿™å°±æ˜¯ç»™å…¬å¸åæ¥æ¥ç›˜çš„äººç•™å‘.è¦æ˜¯æ²¡è€ƒè™‘è¿‡å¼•å…¥ä¸€ä¸ªæŠ€æœ¯å¯èƒ½å­˜åœ¨çš„å¼Šç«¯å’Œé£é™©ï¼Œè¿™ç±»å“¥ä»¬ï¼ŒåŸºæœ¬å¯èƒ½å°±æ˜¯æŒ–å‘å‹é€‰æ‰‹. 3.åŒç±»å‹äº§å“è°ƒç ”å¯¹æ¯”ï¼Œåˆ†åˆ«é€‚åˆå“ªäº›åœºæ™¯ï¼Ÿ ä¸­é—´ä»¶æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œä½†æ˜¯å°±æ˜¯çœ‹ç”¨åœ¨å“ªä¸ªåœºæ™¯å¯ä»¥æ‰¬é•¿é¿çŸ­ï¼Œåˆ©ç”¨å…¶ä¼˜åŠ¿ï¼Œè§„é¿å…¶åŠ£åŠ¿. å¦‚æœå»è®¾è®¡ä¸ªä»€ä¹ˆç³»ç»Ÿï¼Œåœ¨é‡Œé¢ç”¨ä¸€äº›æŠ€æœ¯ï¼Œå¯èƒ½éƒ½æ²¡è€ƒè™‘è¿‡é€‰å‹ï¼Œæœ€åé€‰çš„æŠ€æœ¯å¯èƒ½å¹¶ä¸ä¸€å®šåˆé€‚ï¼Œä¸€æ ·æ˜¯ç•™å‘.","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"}]},{"title":"MQæ€»ç»“ï¼šï¼ˆäºŒï¼‰MQé‡Œæ¶ˆè´¹åˆ°é‡å¤æ•°æ®æ€ä¹ˆåŠï¼Ÿ","slug":"Middleware/MQæ€»ç»“ï¼šï¼ˆäºŒï¼‰MQé‡Œæ¶ˆè´¹åˆ°é‡å¤æ•°æ®æ€ä¹ˆåŠ","date":"2020-03-04T01:56:02.060Z","updated":"2020-03-04T01:56:02.060Z","comments":true,"path":"2020/03/04/Middleware/MQæ€»ç»“ï¼šï¼ˆäºŒï¼‰MQé‡Œæ¶ˆè´¹åˆ°é‡å¤æ•°æ®æ€ä¹ˆåŠ/","link":"","permalink":"http://blog.tgyf.com/2020/03/04/Middleware/MQ%E6%80%BB%E7%BB%93%EF%BC%9A%EF%BC%88%E4%BA%8C%EF%BC%89MQ%E9%87%8C%E6%B6%88%E8%B4%B9%E5%88%B0%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E6%80%8E%E4%B9%88%E5%8A%9E/","excerpt":"","text":"å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„å¹‚ç­‰æ€§ï¼Ÿï¼ˆæˆ–ï¼šå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿï¼‰ æ—¢ç„¶æ˜¯æ¶ˆè´¹æ¶ˆæ¯ï¼Œé‚£è‚¯å®šè¦è€ƒè™‘è€ƒè™‘è¿™ä¸‰ç‚¹ï¼š ä¼šä¸ä¼šé‡å¤æ¶ˆè´¹ï¼Ÿ èƒ½ä¸èƒ½é¿å…é‡å¤æ¶ˆè´¹ï¼Ÿ æˆ–è€…é‡å¤æ¶ˆè´¹äº†ä¹Ÿåˆ«é€ æˆç³»ç»Ÿå¼‚å¸¸å¯ä»¥å—ï¼Ÿ å¤§æ¦‚å¯èƒ½ä¼šæœ‰å“ªäº›é‡å¤æ¶ˆè´¹ å¦‚rabbitmqã€rocketmqã€kafkaï¼Œéƒ½æœ‰å¯èƒ½ä¼šå‡ºç°æ¶ˆè´¹é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæ­£å¸¸.å› ä¸ºè¿™é—®é¢˜é€šå¸¸ä¸æ˜¯mqè‡ªå·±ä¿è¯çš„ï¼Œæ˜¯ç»™ä½ ä¿è¯çš„.ç„¶åæˆ‘ä»¬æŒ‘ä¸€ä¸ªkafkaæ¥ä¸¾ä¸ªä¾‹å­ï¼Œè¯´è¯´æ€ä¹ˆé‡å¤æ¶ˆè´¹å§. kafkaå®é™…ä¸Šæœ‰ä¸ªoffsetçš„æ¦‚å¿µï¼Œå°±æ˜¯æ¯ä¸ªæ¶ˆæ¯å†™è¿›å»ï¼Œéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œä»£è¡¨ä»–çš„åºå·ï¼Œç„¶åconsumeræ¶ˆè´¹äº†æ•°æ®ä¹‹åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œä¼šæŠŠè‡ªå·±æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯çš„offsetæäº¤ä¸€ä¸‹ï¼Œä»£è¡¨æˆ‘å·²ç»æ¶ˆè´¹è¿‡äº†ï¼Œä¸‹æ¬¡æˆ‘è¦æ˜¯é‡å¯å•¥çš„ï¼Œä½ å°±è®©æˆ‘ç»§ç»­ä»ä¸Šæ¬¡æ¶ˆè´¹åˆ°çš„offsetæ¥ç»§ç»­æ¶ˆè´¹å§. ä½†æ˜¯å‡¡äº‹æ€»æœ‰æ„å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ç”Ÿäº§ç»å¸¸é‡åˆ°çš„ï¼Œå°±æ˜¯ä½ æœ‰æ—¶å€™é‡å¯ç³»ç»Ÿï¼Œçœ‹ä½ æ€ä¹ˆé‡å¯äº†ï¼Œå¦‚æœç¢°åˆ°ç‚¹ç€æ€¥çš„ï¼Œç›´æ¥killè¿›ç¨‹äº†ï¼Œå†é‡å¯.è¿™ä¼šå¯¼è‡´consumeræœ‰äº›æ¶ˆæ¯å¤„ç†äº†ï¼Œä½†æ˜¯æ²¡æ¥å¾—åŠæäº¤offsetï¼Œå°´å°¬äº†.é‡å¯ä¹‹åï¼Œå°‘æ•°æ¶ˆæ¯ä¼šå†æ¬¡æ¶ˆè´¹ä¸€æ¬¡. å…¶å®é‡å¤æ¶ˆè´¹ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ä½ æ²¡è€ƒè™‘åˆ°é‡å¤æ¶ˆè´¹ä¹‹åï¼Œæ€ä¹ˆä¿è¯å¹‚ç­‰æ€§. æ€ä¹ˆä¿è¯æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹çš„å¹‚ç­‰æ€§ å…¶å®è¿˜æ˜¯å¾—ç»“åˆä¸šåŠ¡æ¥æ€è€ƒï¼Œè¿™é‡Œç»™å‡ ä¸ªæ€è·¯ï¼š æ¯”å¦‚ä½ æ‹¿ä¸ªæ•°æ®è¦å†™åº“ï¼Œä½ å…ˆæ ¹æ®ä¸»é”®æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœè¿™æ•°æ®éƒ½æœ‰äº†ï¼Œä½ å°±åˆ«æ’å…¥äº†ï¼Œupdateä¸€ä¸‹å¥½å§ æ¯”å¦‚ä½ æ˜¯å†™redisï¼Œé‚£æ²¡é—®é¢˜äº†ï¼Œåæ­£æ¯æ¬¡éƒ½æ˜¯setï¼Œå¤©ç„¶å¹‚ç­‰æ€§ æ¯”å¦‚ä½ ä¸æ˜¯ä¸Šé¢ä¸¤ä¸ªåœºæ™¯ï¼Œé‚£åšçš„ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½ éœ€è¦è®©ç”Ÿäº§è€…å‘é€æ¯æ¡æ•°æ®çš„æ—¶å€™ï¼Œé‡Œé¢åŠ ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„idï¼Œç±»ä¼¼è®¢å•idä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åä½ è¿™é‡Œæ¶ˆè´¹åˆ°äº†ä¹‹åï¼Œå…ˆæ ¹æ®è¿™ä¸ªidå»æ¯”å¦‚redisé‡ŒæŸ¥ä¸€ä¸‹ï¼Œä¹‹å‰æ¶ˆè´¹è¿‡å—ï¼Ÿå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œä½ å°±å¤„ç†ï¼Œç„¶åè¿™ä¸ªidå†™redis.å¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œé‚£ä½ å°±åˆ«å¤„ç†äº†ï¼Œä¿è¯åˆ«é‡å¤å¤„ç†ç›¸åŒçš„æ¶ˆæ¯å³å¯. è¿˜æœ‰æ¯”å¦‚åŸºäºæ•°æ®åº“çš„å”¯ä¸€é”®æ¥ä¿è¯é‡å¤æ•°æ®ä¸ä¼šé‡å¤æ’å…¥å¤šæ¡ï¼Œæˆ‘ä»¬ä¹‹å‰çº¿ä¸Šç³»ç»Ÿå°±æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ‹¿åˆ°æ•°æ®çš„æ—¶å€™ï¼Œæ¯æ¬¡é‡å¯å¯èƒ½ä¼šæœ‰é‡å¤ï¼Œå› ä¸ºkafkaæ¶ˆè´¹è€…è¿˜æ²¡æ¥å¾—åŠæäº¤offsetï¼Œé‡å¤æ•°æ®æ‹¿åˆ°äº†ä»¥åæˆ‘ä»¬æ’å…¥çš„æ—¶å€™ï¼Œå› ä¸ºæœ‰å”¯ä¸€é”®çº¦æŸäº†ï¼Œæ‰€ä»¥é‡å¤æ•°æ®åªä¼šæ’å…¥æŠ¥é”™ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®åº“ä¸­å‡ºç°è„æ•°æ® å¦‚ä½•ä¿è¯MQçš„æ¶ˆè´¹æ˜¯å¹‚ç­‰æ€§çš„ï¼Œéœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡æ¥çœ‹","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"}],"tags":[{"name":"ä¸€äº›æ€è€ƒ","slug":"ä¸€äº›æ€è€ƒ","permalink":"http://blog.tgyf.com/tags/%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"}]},{"title":"RabbitMQï¼ˆå››ï¼‰ - ä¼˜å…ˆçº§é˜Ÿåˆ—(PriorityQueue)","slug":"Middleware/RabbitMQ/RabbitMQ-PriorityQueue","date":"2020-02-24T15:11:23.490Z","updated":"2020-02-24T15:11:23.490Z","comments":true,"path":"2020/02/24/Middleware/RabbitMQ/RabbitMQ-PriorityQueue/","link":"","permalink":"http://blog.tgyf.com/2020/02/24/Middleware/RabbitMQ/RabbitMQ-PriorityQueue/","excerpt":"","text":"RabbitMQ - ä¼˜å…ˆçº§é˜Ÿåˆ—(PriorityQueue) åœ¨RabbitMQä¸­ä½¿ç”¨ä¼˜å…ˆçº§ç‰¹æ€§éœ€è¦çš„ç‰ˆæœ¬ä¸º3.5+ã€‚ ä½¿ç”¨ä¼˜å…ˆçº§ç‰¹æ€§åªéœ€åšä¸¤ä»¶äº‹æƒ…ï¼š 1. å°†é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå³åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™æ·»åŠ å‚æ•° x-max-priority ä»¥æŒ‡å®šæœ€å¤§çš„ä¼˜å…ˆçº§ï¼Œå€¼ä¸º0-255ï¼ˆæ•´æ•°ï¼‰ã€‚ 2. ä¸ºä¼˜å…ˆçº§æ¶ˆæ¯æ·»åŠ ä¼˜å…ˆçº§ã€‚ æ³¨æ„:æ²¡æœ‰æŒ‡å®šä¼˜å…ˆçº§çš„æ¶ˆæ¯ä¼šå°†ä¼˜å…ˆçº§ä»¥0å¯¹å¾…ã€‚ å¯¹äºè¶…è¿‡ä¼˜å…ˆçº§é˜Ÿåˆ—æ‰€å®šæœ€å¤§ä¼˜å…ˆçº§çš„æ¶ˆæ¯ï¼Œä¼˜å…ˆçº§ä»¥æœ€å¤§ä¼˜å…ˆçº§å¯¹å¾…ã€‚å¯¹äºç›¸åŒä¼˜å…ˆçº§çš„æ¶ˆæ¯ï¼Œåè¿›çš„æ’åœ¨å‰é¢ã€‚ æ ¸å¿ƒä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.tgyf.rabbit.config;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.util.HashMap;import java.util.Map;/** * direct exchange -- ç›´æ¥äº¤æ¢å™¨ * å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°ä¸ routing key åŒ¹é…çš„é˜Ÿåˆ—ä¸­ * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 1:29 PM * @remark */@Configuration@Slf4jpublic class DirectExchangeConf &#123; public static final String QUEUE = \"direct-queue-priority\"; public static final String EXCHANGE = \"exchange-direct\"; public static final String ROUTING_KEY = \"direct.queue.priority\"; @Bean Queue directQueuePriority() &#123; //åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™æ·»åŠ å‚æ•° x-max-priority ä»¥æŒ‡å®šæœ€å¤§çš„ä¼˜å…ˆçº§ï¼Œå€¼ä¸º0-255 Map&lt;String, Object&gt; args= new HashMap&lt;&gt;(); args.put(\"x-max-priority\", 100); return new Queue(QUEUE, false, false, false, args); &#125; @Bean DirectExchange directExchange() &#123; return new DirectExchange(EXCHANGE); &#125; @Bean Binding directQueuePriorityBinding(Queue directQueuePriority, DirectExchange directExchange) &#123; return BindingBuilder.bind(directQueuePriority).to(directExchange).with(ROUTING_KEY); &#125;&#125; æµ‹è¯• 1.æµ‹è¯•ä¼˜å…ˆçº§é˜Ÿåˆ— å‘é€ä¼˜å…ˆçº§ä½çš„æ¶ˆæ¯ 100 æ¡åˆ° RabbitMQ curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.priority&quot;, &quot;priority&quot;: 1, &quot;content&quot;:&quot; hello priority queue! &quot;, &quot;count&quot;: 100 }' å‘é€ä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯ 5 æ¡åˆ° RabbitMQ curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.priority&quot;, &quot;priority&quot;: 10, &quot;content&quot;:&quot; &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; hello priority queue! &quot;, &quot;count&quot;: 5 }'","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/categories/RabbitMQ/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/tags/RabbitMQ/"}]},{"title":"RabbitMQï¼ˆäºŒï¼‰ - äº¤æ¢å™¨ï¼ˆExchangeï¼‰","slug":"Middleware/RabbitMQ/RabbitMQ-Exchang","date":"2020-02-24T15:11:16.763Z","updated":"2020-02-24T15:11:16.763Z","comments":true,"path":"2020/02/24/Middleware/RabbitMQ/RabbitMQ-Exchang/","link":"","permalink":"http://blog.tgyf.com/2020/02/24/Middleware/RabbitMQ/RabbitMQ-Exchang/","excerpt":"","text":"RabbitMQ - äº¤æ¢å™¨ï¼ˆExchangeï¼‰ äº¤æ¢å™¨åç§° ä½œç”¨ fanout exchange å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œä¼šè¢«è·¯ç”±åˆ°å…¶ç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ— direct exchange å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯ï¼Œä¼šé€šè¿‡è·¯ç”±é”®å®Œå…¨åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±ä¼šè·¯ç”±åˆ°æŒ‡å®šé˜Ÿåˆ— topic exchange å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯ï¼Œä¼šé€šè¿‡è·¯ç”±é”®æ¨¡ç³ŠåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±ä¼šè·¯ç”±åˆ°æŒ‡å®šé˜Ÿåˆ— header exchange å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯ï¼Œä¼šé€šè¿‡æ¶ˆæ¯çš„ header ä¿¡æ¯åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±ä¼šè·¯ç”±åˆ°æŒ‡å®šé˜Ÿåˆ— æ ¸å¿ƒä»£ç  pom.xml 12345678910111213141516171819202122232425262728293031323334353637&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.tgyf.rabbitmq&lt;/groupId&gt; &lt;artifactId&gt;exchange&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.3.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; direct exchange â€“ ç›´æ¥äº¤æ¢å™¨ å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°ä¸ routing key åŒ¹é…çš„é˜Ÿåˆ—ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.tgyf.rabbit.config;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * direct exchange -- ç›´æ¥äº¤æ¢å™¨ * å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°ä¸ routing key åŒ¹é…çš„é˜Ÿåˆ—ä¸­ * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 12:07 PM * @remark */@Configurationpublic class DirectExchangeConf &#123; public static final String QUEUE_1 = \"direct-queue-1\"; public static final String QUEUE_2 = \"direct-queue-2\"; private static final String EXCHANGE = \"exchange-direct\"; private static final String ROUTING_KEY_TO_QUEUE1 = \"queue.direct.key1\"; private static final String ROUTING_KEY_TO_QUEUE2 = \"queue.direct.key2\"; @Bean Queue directQueue1() &#123; return new Queue(QUEUE_1, false); &#125; @Bean Queue directQueue2() &#123; return new Queue(QUEUE_2, false); &#125; @Bean DirectExchange directExchange() &#123; return new DirectExchange(EXCHANGE); &#125; @Bean Binding bindingDirectQueue1(Queue directQueue1, DirectExchange directExchange) &#123; return BindingBuilder.bind(directQueue1).to(directExchange).with(ROUTING_KEY_TO_QUEUE1); &#125; @Bean Binding bindingDirectQueue2(Queue directQueue2, DirectExchange directExchange) &#123; return BindingBuilder.bind(directQueue2).to(directExchange).with(ROUTING_KEY_TO_QUEUE2); &#125;&#125; fanout exchange â€“ æ‰‡å‡ºäº¤æ¢å™¨ æ‰€æœ‰å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ä¸­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.tgyf.rabbit.config;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.FanoutExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * fanout exchange -- æ‰‡å‡ºäº¤æ¢å™¨ * æ‰€æœ‰å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ä¸­ * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 12:04 PM * @remark */@Configurationpublic class FanoutExchangeConf &#123; public static final String QUEUE_1 = \"fanout-queue-1\"; public static final String QUEUE_2 = \"fanout-queue-2\"; private static final String EXCHANGE = \"exchange-fanout\"; @Bean Queue fanoutQueue1() &#123; return new Queue(QUEUE_1, false); &#125; @Bean Queue fanoutQueue2() &#123; return new Queue(QUEUE_2, false); &#125; @Bean FanoutExchange fanoutExchange() &#123; return new FanoutExchange(EXCHANGE); &#125; @Bean Binding bindingFanoutQueue1(Queue fanoutQueue1, FanoutExchange fanoutExchange) &#123; return BindingBuilder.bind(fanoutQueue1).to(fanoutExchange); &#125; @Bean Binding bindingFanoutQueue2(Queue fanoutQueue2, FanoutExchange fanoutExchange) &#123; return BindingBuilder.bind(fanoutQueue2).to(fanoutExchange); &#125;&#125; headers exchange â€“ headersäº¤æ¢å™¨ å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯ä¼šæ ¹æ®æ¶ˆæ¯çš„ header ä¿¡æ¯è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ— 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.tgyf.rabbit.config;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.HeadersExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;/** * headers exchange -- headersäº¤æ¢å™¨ * å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯ä¼šæ ¹æ®æ¶ˆæ¯çš„ header ä¿¡æ¯è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ— * è¯´æ˜ï¼š * where åŒ¹é…å•ä¸ª header * whereAll åŒæ—¶åŒ¹é…å¤šä¸ª header * whereAny åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ª header * * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 12:12 PM * @remark */public class HeadersExchangeConf &#123; public static final String QUEUE_1 = \"headers-queue-1\"; public static final String QUEUE_2 = \"headers-queue-2\"; public static final String QUEUE_3 = \"headers-queue-3\"; private static final String EXCHANGE = \"exchange-headers\"; @Bean Queue headersQueue1() &#123; return new Queue(QUEUE_1, false); &#125; @Bean Queue headersQueue2() &#123; return new Queue(QUEUE_2, false); &#125; @Bean Queue headersQueue3() &#123; return new Queue(QUEUE_3, false); &#125; @Bean HeadersExchange headersExchange() &#123; return new HeadersExchange(EXCHANGE); &#125; @Bean Binding bindingHeadersQueue1(Queue headersQueue1, HeadersExchange headersExchange) &#123; return BindingBuilder.bind(headersQueue1).to(headersExchange).where(\"one\").exists(); &#125; @Bean Binding bindingHeadersQueue2(Queue headersQueue1, HeadersExchange headersExchange) &#123; return BindingBuilder.bind(headersQueue1).to(headersExchange).whereAll(\"all1\", \"all2\").exist(); &#125; @Bean Binding bindingHeadersQueue3(Queue headersQueue3, HeadersExchange headersExchange) &#123; return BindingBuilder.bind(headersQueue3).to(headersExchange).whereAny(\"any1\", \"any2\").exist(); &#125;&#125; topic exchange â€“ ä¸»é¢˜äº¤æ¢å™¨ å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°ä¸ routing key åŒ¹é…çš„é˜Ÿåˆ—ä¸­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.tgyf.rabbit.config;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.Queue;import org.springframework.amqp.core.TopicExchange;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * topic exchange -- ä¸»é¢˜äº¤æ¢å™¨ * å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯éƒ½ä¼šè¢«è·¯ç”±åˆ°ä¸ routing key åŒ¹é…çš„é˜Ÿåˆ—ä¸­ * è¯´æ˜ï¼š * routing key ä»¥ '.' åˆ†éš”ä¸ºå¤šä¸ªå•è¯ * routing key ä»¥ '*' åŒ¹é…ä¸€ä¸ªå•è¯ * routing key ä»¥ '#' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ * ä¾‹å¦‚ï¼š * queue.topic.key -&gt; QUEUE_1 + QUEUE_2 * test.topic.key -&gt; QUEUE_1 * queue -&gt; QUEUE_2 * queue.topic -&gt; QUEUE_2 * * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 12:09 PM * @remark */@Configurationpublic class TopicExchangeConf &#123; public static final String QUEUE_1 = \"topic-queue-1\"; public static final String QUEUE_2 = \"topic-queue-2\"; private static final String EXCHANGE = \"exchange-topic\"; private static final String ROUTING_KEY_TO_QUEUE1 = \"*.topic.*\"; private static final String ROUTING_KEY_TO_QUEUE2 = \"queue.#\"; @Bean Queue topicQueue1() &#123; return new Queue(QUEUE_1, false); &#125; @Bean Queue topicQueue2() &#123; return new Queue(QUEUE_2, false); &#125; @Bean TopicExchange topicExchange() &#123; return new TopicExchange(EXCHANGE); &#125; @Bean Binding bindingTopicQueue1(Queue topicQueue1, TopicExchange topicExchange) &#123; return BindingBuilder.bind(topicQueue1).to(topicExchange).with(ROUTING_KEY_TO_QUEUE1); &#125; @Bean Binding bindingTopicQueue2(Queue topicQueue2, TopicExchange topicExchange) &#123; return BindingBuilder.bind(topicQueue2).to(topicExchange).with(ROUTING_KEY_TO_QUEUE2); &#125;&#125; æµ‹è¯• 1.æµ‹è¯•fanout exchange curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-fanout&quot;, &quot;routingKey&quot;: &quot;default&quot;, &quot;content&quot;:&quot; hello fanout!&quot;, &quot;count&quot;: 1 }' 2.æµ‹è¯• direct exchange curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;queue.direct.key1&quot;, &quot;content&quot;:&quot; hello direct! &quot;, &quot;count&quot;: 1 }' curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;queue.direct.key2&quot;, &quot;content&quot;:&quot; hello direct! &quot;, &quot;count&quot;: 1 }' 3.æµ‹è¯• topic exchange curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-topic&quot;, &quot;routingKey&quot;: &quot;queue.topic.key1&quot;, &quot;content&quot;:&quot; hello topic! &quot;, &quot;count&quot;: 1 }' curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-topic&quot;, &quot;routingKey&quot;: &quot;test.topic.key2&quot;, &quot;content&quot;:&quot; hello topic! &quot;, &quot;count&quot;: 1 }' curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-topic&quot;, &quot;routingKey&quot;: &quot;queue.hello&quot;, &quot;content&quot;:&quot; hello topic! &quot;, &quot;count&quot;: 1 }' 4.æµ‹è¯• headers exchange curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-headers&quot;, &quot;content&quot;:&quot; hello headers! &quot;, &quot;count&quot;: 1, &quot;headers&quot;:{ &quot;one&quot;:&quot;value&quot; } }' curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-headers&quot;, &quot;content&quot;:&quot; hello headers! &quot;, &quot;count&quot;: 1, &quot;headers&quot;:{ &quot;all1&quot;:&quot;value&quot;, &quot;all2&quot;:&quot;value&quot; } }' curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-headers&quot;, &quot;content&quot;:&quot; hello headers! &quot;, &quot;count&quot;: 1, &quot;headers&quot;:{ &quot;any2&quot;:&quot;value&quot;, } }'","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/categories/RabbitMQ/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/tags/RabbitMQ/"}]},{"title":"RabbitMQï¼ˆä¸‰ï¼‰ - æ­»ä¿¡é˜Ÿåˆ—(DeadLetterQueue)","slug":"Middleware/RabbitMQ/RabbitMQ-DeadletterQueue","date":"2020-02-24T15:11:10.610Z","updated":"2020-02-24T15:11:10.611Z","comments":true,"path":"2020/02/24/Middleware/RabbitMQ/RabbitMQ-DeadletterQueue/","link":"","permalink":"http://blog.tgyf.com/2020/02/24/Middleware/RabbitMQ/RabbitMQ-DeadletterQueue/","excerpt":"","text":"RabbitMQ - æ­»ä¿¡é˜Ÿåˆ—(DeadLetterQueue) ä»€ä¹ˆæ˜¯æ­»ä¿¡ â€œæ­»ä¿¡â€æ˜¯RabbitMQä¸­çš„ä¸€ç§æ¶ˆæ¯æœºåˆ¶ï¼Œå½“ä½ åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š 1.æ¶ˆæ¯è¢«å¦å®šç¡®è®¤ï¼Œä½¿ç”¨ channel.basicNack æˆ– channel.basicReject ï¼Œå¹¶ä¸”æ­¤æ—¶requeue å±æ€§è¢«è®¾ç½®ä¸ºfalseã€‚ 2.æ¶ˆæ¯åœ¨é˜Ÿåˆ—çš„å­˜æ´»æ—¶é—´è¶…è¿‡è®¾ç½®çš„TTLæ—¶é—´ã€‚ 3.æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ•°é‡å·²ç»è¶…è¿‡æœ€å¤§é˜Ÿåˆ—é•¿åº¦ã€‚ é‚£ä¹ˆè¯¥æ¶ˆæ¯å°†æˆä¸ºâ€œæ­»ä¿¡â€ã€‚ â€œæ­»ä¿¡â€æ¶ˆæ¯ä¼šè¢«RabbitMQè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœé…ç½®äº†æ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢è¿›æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™è¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚ æ­»ä¿¡ç”Ÿå‘½å‘¨æœŸ æ­»ä¿¡é˜Ÿåˆ—åªæ˜¯ä¸€ä¸ªç»‘å®šåœ¨æ­»ä¿¡äº¤æ¢æœºä¸Šçš„æ™®é€šé˜Ÿåˆ—ï¼Œè€Œæ­»ä¿¡äº¤æ¢æœºä¹Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„äº¤æ¢æœºï¼Œä¸è¿‡æ˜¯ç”¨æ¥ä¸“é—¨å¤„ç†æ­»ä¿¡çš„äº¤æ¢æœºã€‚ æ­»ä¿¡çš„ç”Ÿå‘½å‘¨æœŸï¼š ä¸šåŠ¡æ¶ˆæ¯è¢«æŠ•å…¥ä¸šåŠ¡é˜Ÿåˆ— æ¶ˆè´¹è€…æ¶ˆè´¹ä¸šåŠ¡é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œç”±äºå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œäºæ˜¯è¿›è¡Œäº†nckæˆ–è€…rejectæ“ä½œ è¢«nckæˆ–rejectçš„æ¶ˆæ¯ç”±RabbitMQæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºä¸­ æ­»ä¿¡äº¤æ¢æœºå°†æ¶ˆæ¯æŠ•å…¥ç›¸åº”çš„æ­»ä¿¡é˜Ÿåˆ— æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ¶ˆè´¹æ­»ä¿¡æ¶ˆæ¯ æ­»ä¿¡æ¶ˆæ¯æ˜¯RabbitMQä¸ºæˆ‘ä»¬åšçš„ä¸€å±‚ä¿è¯ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯æ¶ˆè´¹å¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯ä¸»åŠ¨æŠ•é€’åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºä¸­ï¼Œå…³é”®åœ¨äºè¿™äº›Exchangeå’ŒQueueæ€ä¹ˆé…åˆã€‚æ¯”å¦‚ä»æ­»ä¿¡é˜Ÿåˆ—æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åå‘é€é‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰é€šçŸ¥æ¥é€šçŸ¥å¼€å‘äººå‘˜å…³æ³¨ã€‚æˆ–è€…å°†æ¶ˆæ¯é‡æ–°æŠ•é€’åˆ°ä¸€ä¸ªé˜Ÿåˆ—ç„¶åè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ¥è¿›è¡Œå»¶æ—¶æ¶ˆè´¹ã€‚ æ­»ä¿¡æ¶ˆæ¯çš„Header å­—æ®µå å«ä¹‰ x-first-death-exchange ç¬¬ä¸€æ¬¡è¢«æŠ›å…¥çš„æ­»ä¿¡äº¤æ¢æœºçš„åç§° x-first-death-reason ç¬¬ä¸€æ¬¡æˆä¸ºæ­»ä¿¡çš„åŸå› ï¼Œrejectedï¼šæ¶ˆæ¯åœ¨é‡æ–°è¿›å…¥é˜Ÿåˆ—æ—¶è¢«é˜Ÿåˆ—æ‹’ç»ï¼Œç”±äºdefault-requeue-rejected å‚æ•°è¢«è®¾ç½®ä¸ºfalseã€‚expired ï¼šæ¶ˆæ¯è¿‡æœŸã€‚maxlen ï¼š é˜Ÿåˆ—å†…æ¶ˆæ¯æ•°é‡è¶…è¿‡é˜Ÿåˆ—æœ€å¤§å®¹é‡ x-first-death-queue ç¬¬ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰æ‰€åœ¨é˜Ÿåˆ—åç§° x-death å†æ¬¡è¢«æŠ•å…¥æ­»ä¿¡äº¤æ¢æœºçš„ä¿¡æ¯åˆ—è¡¨ï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯æ¯æ¬¡è¿›å…¥ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™ä¸ªæ•°ç»„çš„ä¿¡æ¯å°±ä¼šè¢«æ›´æ–° æ­»ä¿¡é˜Ÿåˆ—åº”ç”¨åœºæ™¯ ä¸€èˆ¬ç”¨åœ¨è¾ƒä¸ºé‡è¦çš„ä¸šåŠ¡é˜Ÿåˆ—ä¸­ï¼Œç¡®ä¿æœªè¢«æ­£ç¡®æ¶ˆè´¹çš„æ¶ˆæ¯ä¸è¢«ä¸¢å¼ƒï¼Œä¸€èˆ¬å‘ç”Ÿæ¶ˆè´¹å¼‚å¸¸å¯èƒ½åŸå› ä¸»è¦æœ‰ç”±äºæ¶ˆæ¯ä¿¡æ¯æœ¬èº«å­˜åœ¨é”™è¯¯å¯¼è‡´å¤„ç†å¼‚å¸¸ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼Œæˆ–è€…å› ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„æŸ¥è¯¢å¼‚å¸¸ç­‰ç­‰ï¼Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå½“ç„¶ä¸èƒ½æ¯æ¬¡é€šè¿‡æ—¥å¿—æ¥è·å–åŸæ¶ˆæ¯ï¼Œç„¶åè®©è¿ç»´å¸®å¿™é‡æ–°æŠ•é€’æ¶ˆæ¯ï¼ˆæ²¡é”™ï¼Œä»¥å‰å°±æ˜¯è¿™ä¹ˆå¹²çš„= =ï¼‰ã€‚é€šè¿‡é…ç½®æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¯ä»¥è®©æœªæ­£ç¡®å¤„ç†çš„æ¶ˆæ¯æš‚å­˜åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¾…åç»­æ’æŸ¥æ¸…æ¥šé—®é¢˜åï¼Œç¼–å†™ç›¸åº”çš„å¤„ç†ä»£ç æ¥å¤„ç†æ­»ä¿¡æ¶ˆæ¯ï¼Œè¿™æ ·æ¯”æ‰‹å·¥æ¢å¤æ•°æ®è¦å¥½å¤ªå¤šäº†ã€‚ æ ¸å¿ƒä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.tgyf.rabbit.config;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * æ­»ä¿¡äº¤æ¢å™¨ * * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 2:18 PM * @remark */@Configuration@Slf4jpublic class DeadLetterExchangeConf &#123; public static final String QUEUE_BY_MAX_LENGTH = \"direct-queue-dead-by-max-length\"; public static final String QUEUE_BY_TTL = \"direct-queue-dead-by-ttl\"; public static final String QUEUE_BY_REJECT = \"direct-queue-dead-by-reject\"; public static final String EXCHANGE = \"exchange-direct-dead\"; public static final String ROUTING_KEY_BY_MAX_LENGTH = \"direct.queue.dead.max.length\"; public static final String ROUTING_KEY_BY_TTL = \"direct.queue.dead.ttl\"; public static final String ROUTING_KEY_BY_REJECT = \"direct.queue.dead.reject\"; @Bean Queue deadByMaxLengthQueue() &#123; return new Queue(QUEUE_BY_MAX_LENGTH, false); &#125; @Bean Queue deadByTTLQueue() &#123; return new Queue(QUEUE_BY_TTL, false); &#125; @Bean Queue deadByRejectQueue() &#123; return new Queue(QUEUE_BY_REJECT, false); &#125; @Bean DirectExchange deadDirectExchange() &#123; return new DirectExchange(EXCHANGE); &#125; @Bean Binding deadByMaxLengthQueueBinding(Queue deadByMaxLengthQueue, DirectExchange deadDirectExchange) &#123; return BindingBuilder.bind(deadByMaxLengthQueue).to(deadDirectExchange).with(ROUTING_KEY_BY_MAX_LENGTH); &#125; @Bean Binding deadByTTLQueueBinding(Queue deadByTTLQueue, DirectExchange deadDirectExchange) &#123; return BindingBuilder.bind(deadByTTLQueue).to(deadDirectExchange).with(ROUTING_KEY_BY_TTL); &#125; @Bean Binding deadByRejectQueueBinding(Queue deadByRejectQueue, DirectExchange deadDirectExchange) &#123; return BindingBuilder.bind(deadByRejectQueue).to(deadDirectExchange).with(ROUTING_KEY_BY_REJECT); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package com.tgyf.rabbit.config;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.util.HashMap;import java.util.Map;/** * æ™®é€šäº¤æ¢å™¨ * * @author éŸ¬å…‰å…»æœˆå·´ * @modify * @createDate 2019/8/24 2:18 PM * @remark */@Configuration@Slf4jpublic class DirectExchangeConf &#123; public static final String QUEUE_MAX_LENGTH = \"direct-queue-max-length\"; public static final String QUEUE_TTL = \"direct-queue-ttl\"; public static final String QUEUE_REJECT = \"direct-queue-reject\"; public static final String EXCHANGE = \"exchange-direct\"; public static final String ROUTING_KEY_MAX_LENGTH = \"direct.queue.max.length\"; public static final String ROUTING_KEY_TTL = \"direct.queue.ttl\"; public static final String ROUTING_KEY_REJECT = \"direct.queue.reject\"; @Bean Queue maxLengthQueue() &#123; Map&lt;String, Object&gt; args= new HashMap&lt;&gt;(); // è®¾ç½®é˜Ÿåˆ—æœ€å¤§é•¿åº¦ args.put(\"x-max-length\", 10); // è®¾ç½®æ­»ä¿¡è½¬å‘çš„ exchange å’Œ routing key args.put(\"x-dead-letter-exchange\", DeadLetterExchangeConf.EXCHANGE); args.put(\"x-dead-letter-routing-key\", DeadLetterExchangeConf.ROUTING_KEY_BY_MAX_LENGTH); return new Queue(QUEUE_MAX_LENGTH, false, false, false, args); &#125; @Bean Queue ttlQueue() &#123; Map&lt;String, Object&gt; args= new HashMap&lt;&gt;(); // è®¾ç½®æ¶ˆæ¯å­˜æ´»æ—¶é—´ 10s args.put(\"x-message-ttl\", 10000); // è®¾ç½®æ­»ä¿¡è½¬å‘çš„ exchange å’Œ routing key args.put(\"x-dead-letter-exchange\", DeadLetterExchangeConf.EXCHANGE); args.put(\"x-dead-letter-routing-key\", DeadLetterExchangeConf.ROUTING_KEY_BY_TTL); return new Queue(QUEUE_TTL, false, false, false, args); &#125; @Bean Queue rejectQueue() &#123; Map&lt;String, Object&gt; args= new HashMap&lt;&gt;(); // è®¾ç½®æ­»ä¿¡è½¬å‘çš„ exchange å’Œ routing key args.put(\"x-dead-letter-exchange\", DeadLetterExchangeConf.EXCHANGE); args.put(\"x-dead-letter-routing-key\", DeadLetterExchangeConf.ROUTING_KEY_BY_REJECT); return new Queue(QUEUE_REJECT, false, false, false, args); &#125; @Bean DirectExchange directExchange() &#123; return new DirectExchange(EXCHANGE); &#125; @Bean Binding maxLengthQueueBinding(Queue maxLengthQueue, DirectExchange directExchange) &#123; return BindingBuilder.bind(maxLengthQueue).to(directExchange).with(ROUTING_KEY_MAX_LENGTH); &#125; @Bean Binding ttlQueueBinding(Queue ttlQueue, DirectExchange directExchange) &#123; return BindingBuilder.bind(ttlQueue).to(directExchange).with(ROUTING_KEY_TTL); &#125; @Bean Binding rejectQueueBinding(Queue rejectQueue, DirectExchange directExchange) &#123; return BindingBuilder.bind(rejectQueue).to(directExchange).with(ROUTING_KEY_REJECT); &#125;&#125; æµ‹è¯• 1.æµ‹è¯•æ¶ˆè´¹è€…å¦è®¤æ¶ˆæ¯ curl -X POST \\ http://127.0.0.1:8080/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.reject&quot;, &quot;content&quot;:&quot; hello reject queue! &quot;, &quot;count&quot;: 1 }' 2.æµ‹è¯•æ¶ˆæ¯è¶…å‡ºé˜Ÿåˆ—æœ€å¤§é•¿åº¦ curl -X POST \\ http://127.0.0.1:8080/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.max.length&quot;, &quot;content&quot;:&quot; hello max length queue! &quot;, &quot;count&quot;: 30 }' æç¤ºï¼šæ¶ˆæ¯é˜Ÿåˆ—éµå¾ªå…ˆè¿›å…ˆå‡ºçš„ç­–ç•¥ï¼Œå‡è®¾é˜Ÿåˆ—æœ€å¤§é•¿åº¦è®¾ç½®ä¸º 10ï¼Œå‘é€ 30 æ¡æ¶ˆæ¯åˆ°è¯¥é˜Ÿåˆ—ï¼Œè‹¥æ— æ¶ˆè´¹è€…ï¼Œå‰ 20 æ¡æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ°æŒ‡å®šçš„å…¶ä»–é˜Ÿåˆ—ï¼Œå 10 æ¡ä¼šä¿å­˜åœ¨è¯¥é˜Ÿåˆ—ä¸­ï¼Œé™¤éæœ‰æ–°çš„æ¶ˆæ¯å…¥é˜Ÿï¼Œè¿™ 10 æ¡æ¶ˆæ¯æ‰ä¼šè¢«è½¬å‘ 3.æµ‹è¯•æ¶ˆæ¯è¶…æ—¶ curl -X POST \\ http://127.0.0.1:8080/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.ttl&quot;, &quot;content&quot;:&quot; hello ttl queue! &quot;, &quot;count&quot;: 10 }' 4.æµ‹è¯•å»¶è¿Ÿé˜Ÿåˆ— curl -X POST \\ http://127.0.0.1/send \\ -H 'Content-Type: application/json' \\ -d '{ &quot;exchange&quot;:&quot;exchange-direct&quot;, &quot;routingKey&quot;: &quot;direct.queue.delay&quot;, &quot;content&quot;:&quot; hello delay delay! &quot;, &quot;count&quot;: 1, &quot;delayTime&quot;: &quot;10000&quot; }'","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/categories/RabbitMQ/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/tags/RabbitMQ/"}]},{"title":"RabbitMQï¼ˆä¸€ï¼‰ - é…ç½®è¯¦è§£","slug":"Middleware/RabbitMQ/RabbitMQ","date":"2020-02-24T15:10:50.667Z","updated":"2020-02-24T15:10:50.667Z","comments":true,"path":"2020/02/24/Middleware/RabbitMQ/RabbitMQ/","link":"","permalink":"http://blog.tgyf.com/2020/02/24/Middleware/RabbitMQ/RabbitMQ/","excerpt":"","text":"å¯åŠ¨ RabbitMQ docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq --hostname rabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin rabbitmq:3.7-management-plugins æ„å»ºRabbitMQé•œåƒå‚è€ƒRabbitMQ é•œåƒdockerfile å†…å®¹ç»“æ„ åºå· å†…å®¹åç§° å†…å®¹è¯´æ˜ 1 exchange äº¤æ¢å™¨ 2 priorityqueue ä¼˜å…ˆçº§é˜Ÿåˆ— 3 deadletterqueue æ­»ä¿¡é˜Ÿåˆ— Spring Boot RabbitMQ å‚æ•°é…ç½®è¯¦è§£ è¿æ¥é…ç½® spring.rabbitmq.host=localhost # RabbitMQ åœ°å€ spring.rabbitmq.port=5672 # RabbitMQ ç«¯å£ spring.rabbitmq.username=guest # RabbitMQ ç”¨æˆ·å spring.rabbitmq.password=guest # RabbitMQ å¯†ç  spring.rabbitmq.addresses= # è®¾ç½® RabbitMQ é›†ç¾¤ï¼Œå¤šä¸ªåœ°å€ä½¿ç”¨ &quot;,&quot; åˆ†éš”ï¼Œä¾‹å¦‚ï¼š192.168.0.100:5672,192.168.0.101:5672 spring.rabbitmq.virtual-host= # è®¾ç½® Virtual Host spring.rabbitmq.ssl.algorithm= # SSL ç®—æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”± Rabbit å®¢æˆ·ç«¯é…ç½® spring.rabbitmq.ssl.enabled=false # æ˜¯å¦å¯ç”¨ SSL æ”¯æŒ spring.rabbitmq.ssl.key-store= # key å­˜å‚¨è·¯å¾„ spring.rabbitmq.ssl.key-store-password= # ç”¨äºè®¿é—® key çš„å¯†ç  spring.rabbitmq.ssl.key-store-type=PKCS12 # Key å­˜å‚¨ç±»å‹ spring.rabbitmq.ssl.trust-store= # Trust å­˜å‚¨è·¯å¾„ spring.rabbitmq.ssl.trust-store-password= # ç”¨äºè®¿é—® Trust çš„å¯†ç  spring.rabbitmq.ssl.trust-store-type=JKS # Trust å­˜å‚¨ç±»å‹ spring.rabbitmq.ssl.validate-server-certificate=true # æ˜¯å¦å¯ç”¨æœåŠ¡ç«¯è¯ä¹¦éªŒè¯ spring.rabbitmq.ssl.verify-hostname=true # æ˜¯å¦å¯ç”¨ hostname éªŒè¯ Publisher é…ç½® spring.rabbitmq.publisher-confirms=false # æ˜¯å¦å¯ç”¨ publisher ç¡®è®¤ spring.rabbitmq.publisher-returns=false # æ˜¯å¦å¯ç”¨ publisher è¿”å› spring.rabbitmq.template.default-receive-queue= # æ²¡æœ‰æ²¡ç¡®å®šæŒ‡å®šé˜Ÿåˆ—æ—¶çš„é»˜è®¤é˜Ÿåˆ— spring.rabbitmq.template.exchange= # å‘é€æ¶ˆæ¯é»˜è®¤çš„ exchange spring.rabbitmq.template.mandatory= # æ˜¯å¦å¯ç”¨ mandatory æ¶ˆæ¯ spring.rabbitmq.template.receive-timeout= # `receive()` æ“ä½œçš„è¶…æ—¶æ—¶é—´ spring.rabbitmq.template.reply-timeout= # `sendAndReceive()` æ“ä½œçš„è¶…æ—¶æ—¶é—´ spring.rabbitmq.template.retry.enabled=false # æ˜¯å¦å¯ç”¨é‡è¯• spring.rabbitmq.template.retry.initial-interval=1000ms # ä¸¤æ¬¡é‡è¯•é—´çš„æ—¶é—´é—´éš” spring.rabbitmq.template.retry.max-attempts=3 # æœ€å¤§é‡è¯•æ¬¡æ•° spring.rabbitmq.template.retry.max-interval=10000ms # æœ€é•¿é‡è¯•æ—¶é—´ spring.rabbitmq.template.retry.multiplier=1 # Multiplier to apply to the previous retry interval. spring.rabbitmq.template.routing-key= # å‘é€æ¶ˆæ¯é»˜è®¤çš„ routing key Consumer è®¾ç½® spring.rabbitmq.listener.direct.acknowledge-mode= # ç¡®è®¤æ¨¡å¼ï¼šauto / manual / none spring.rabbitmq.listener.direct.auto-startup=true # æ˜¯å¦åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨å®¹å™¨ spring.rabbitmq.listener.direct.consumers-per-queue= # æ¯ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ•°é‡ spring.rabbitmq.listener.direct.default-requeue-rejected= # é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‹’æ”¶çš„æ¶ˆæ¯æ˜¯å¦é‡æ–°æ’é˜Ÿ spring.rabbitmq.listener.direct.idle-event-interval= # ç©ºé—²å®¹å™¨äº‹ä»¶å‘å¸ƒçš„é¢‘ç‡ spring.rabbitmq.listener.direct.missing-queues-fatal=false # å¦‚æœå®¹å™¨å£°æ˜çš„é˜Ÿåˆ—åœ¨ broker ä¸Šä¸å¯ç”¨ï¼Œæ˜¯å¦å¤±è´¥ spring.rabbitmq.listener.direct.prefetch= # é¢„åŠ è½½çš„æ¶ˆæ¯æ•°é‡ spring.rabbitmq.listener.direct.retry.enabled=false # æ˜¯å¦å¯ç”¨å‘å¸ƒé‡è¯• spring.rabbitmq.listener.direct.retry.initial-interval=1000ms # ä¸¤æ¬¡é‡è¯•æ—¶é—´é—´éš” spring.rabbitmq.listener.direct.retry.max-attempts=3 # æœ€å¤§é‡è¯•æ¬¡æ•° spring.rabbitmq.listener.direct.retry.max-interval=10000ms # æœ€é•¿é‡è¯•æ—¶é—´ spring.rabbitmq.listener.direct.retry.multiplier=1 # ä¸Šæ¬¡é‡è¯•é—´éš”çš„å€æ•° spring.rabbitmq.listener.direct.retry.stateless=true # é‡è¯•æ˜¯å¦æœ‰çŠ¶æ€ spring.rabbitmq.listener.simple.acknowledge-mode= # ç¡®è®¤æ¨¡å¼ï¼šauto / manual / none spring.rabbitmq.listener.simple.auto-startup=true # æ˜¯å¦åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨å®¹å™¨ spring.rabbitmq.listener.simple.concurrency= # ç›‘å¬å™¨æœ€å°çº¿ç¨‹æ•° spring.rabbitmq.listener.simple.default-requeue-rejected= # é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‹’æ”¶çš„æ¶ˆæ¯æ˜¯å¦é‡æ–°æ’é˜Ÿ spring.rabbitmq.listener.simple.idle-event-interval= # ç©ºé—²å®¹å™¨äº‹ä»¶å‘å¸ƒçš„é¢‘ç‡ spring.rabbitmq.listener.simple.max-concurrency= # ç›‘å¬å™¨æœ€å¤§çº¿ç¨‹æ•° spring.rabbitmq.listener.simple.missing-queues-fatal=true # å¦‚æœå®¹å™¨å£°æ˜çš„é˜Ÿåˆ—åœ¨ broker ä¸Šä¸å¯ç”¨ï¼Œæ˜¯å¦å¤±è´¥ï¼› å¦‚æœåœ¨è¿è¡Œæ—¶åˆ é™¤é˜Ÿåˆ—ï¼Œå®¹å™¨æ˜¯å¦åœæ­¢ spring.rabbitmq.listener.simple.prefetch= # é¢„åŠ è½½çš„æ¶ˆæ¯æ•°é‡ spring.rabbitmq.listener.simple.retry.enabled=false # æ˜¯å¦å¯ç”¨å‘å¸ƒé‡è¯• spring.rabbitmq.listener.simple.retry.initial-interval=1000ms # ä¸¤æ¬¡é‡è¯•æ—¶é—´é—´éš” spring.rabbitmq.listener.simple.retry.max-attempts=3 # æœ€å¤§é‡è¯•æ¬¡æ•° spring.rabbitmq.listener.simple.retry.max-interval=10000ms # æœ€é•¿é‡è¯•æ—¶é—´ spring.rabbitmq.listener.simple.retry.multiplier=1 # ä¸Šæ¬¡é‡è¯•é—´éš”çš„å€æ•° spring.rabbitmq.listener.simple.retry.stateless=true # é‡è¯•æ˜¯å¦æœ‰çŠ¶æ€ spring.rabbitmq.listener.simple.transaction-size= # ç¡®è®¤æ¨¡å¼ä¸º auto æ—¶ï¼Œåœ¨ acks ä¹‹é—´å¤„ç†çš„æ¶ˆæ¯æ•°. å¦‚æœå¤§äºé¢„åŠ è½½çš„æ•°é‡ï¼Œåˆ™é¢„åŠ è½½çš„æ•°é‡å¢åŠ åˆ°æ­¤å€¼ rabbitmq listener ç±»å‹æœ‰ä¸¤ç§ï¼šsimple å’Œ directï¼ŒäºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ DirectMessageListenerContainer æ³¨é‡Šå¦‚ä¸‹ï¼š The {@code SimpleMessageListenerContainer} is not so simple. Recent changes to the rabbitmq java client has facilitated a much simpler listener container that invokes the listener directly on the rabbit client consumer thread. There is no txSize property - each message is acked (or nacked) individually. å…¶ä»–è®¾ç½® spring.rabbitmq.dynamic=true # æ˜¯å¦åˆ›å»º AmqpAdmin bean spring.rabbitmq.requested-heartbeat= # è¯·æ±‚å¿ƒè·³è¶…æ—¶æ—¶é—´. è®¾ç½®ä¸º 0 ä»£è¡¨æ²¡æœ‰ï¼Œå¦‚æœæœªæŒ‡å®šæ—¶é—´åç¼€ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ç§’ Spring Boot RabbitMQ é˜Ÿåˆ—å±æ€§è¯¦è§£ å±æ€§åç§° å±æ€§è¯´æ˜ Durable ä»£è¡¨è¯¥é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–è‡³ç¡¬ç›˜ï¼ˆè‹¥è¦ä½¿é˜Ÿåˆ—ä¸­æ¶ˆæ¯ä¸ä¸¢å¤±ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å°†æ¶ˆæ¯å£°æ˜ä¸ºæŒä¹…åŒ– Exclusive æ˜¯å¦å£°æ˜è¯¥é˜Ÿåˆ—æ˜¯å¦ä¸ºè¿æ¥ç‹¬å ï¼Œè‹¥ä¸ºç‹¬å ï¼Œè¿æ¥å…³é—­åé˜Ÿåˆ—å³è¢«åˆ é™¤ Auto-delete è‹¥æ²¡æœ‰æ¶ˆè´¹è€…è®¢é˜…è¯¥é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å°†è¢«åˆ é™¤ Arguments å¯é€‰mapç±»å‹å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šé˜Ÿåˆ—é•¿åº¦ï¼Œæ¶ˆæ¯ç”Ÿå­˜æ—¶é—´ï¼Œé•œç›¸è®¾ç½®ç­‰ RabbitMQè§„å®šï¼Œé˜Ÿåˆ—çš„åå­—æœ€é•¿ä¸è¶…è¿‡UTF-8ç¼–ç çš„255å­—èŠ‚ RabbitMQå†…éƒ¨çš„Queueå‘½åè§„åˆ™é‡‡ç”¨ &quot;amq.&quot;å½¢å¼ï¼Œæ³¨æ„ä¸è¦ä¸æ­¤è§„åˆ™å†²çª å¸¸è§é—®é¢˜ 1. å£°æ˜äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é˜Ÿåˆ—ï¼Ÿ å¦‚æœé˜Ÿåˆ—å·²ç»å­˜åœ¨ï¼Œå†æ¬¡å£°æ˜å°†ä¸ä¼šèµ·ä½œç”¨ã€‚è‹¥åŸå§‹é˜Ÿåˆ—å‚æ•°å’Œè¯¥æ¬¡å£°æ˜æ—¶ä¸åŒåˆ™ä¼šæŠ¥å¼‚å¸¸ã€‚ 2. é˜Ÿåˆ—ä¸­æ¶ˆæ¯é¡ºåºï¼Ÿ é»˜è®¤æƒ…å†µä¸‹æ˜¯FIFOï¼Œå³å…ˆè¿›å…ˆå‡ºï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå‘é€æ¶ˆæ¯æ—¶æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚ 3. é˜Ÿåˆ—æ¶ˆæ¯å­˜æ”¾ä½ç½®ï¼Ÿ å¯¹äºä¸´æ—¶æ¶ˆæ¯ï¼ŒRabbitMQå°½é‡å°†å…¶å­˜æ”¾åœ¨å†…å­˜ï¼Œå½“å‡ºç°å†…å­˜å‘Šè­¦æ—¶ï¼ŒMQä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–è‡³ç¡¬ç›˜ã€‚å¯¹äºæŒä¹…åŒ–æ¶ˆæ¯ä¸Lazy-queuesï¼ŒMQä¼šå…ˆå°†æ¶ˆæ¯å­˜å…¥ç¡¬ç›˜ï¼Œæ¶ˆè´¹æ—¶å†å–å‡ºã€‚ 4. é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„æ¶ˆè´¹ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMQä¼šè®¾ç½®æ¶ˆè´¹è€…çš„æ¶ˆè´¹ç¡®è®¤æ¨¡å¼ä¸ºè‡ªåŠ¨ã€‚å¯¹äºä¸€äº›é‡è¦æ¶ˆæ¯çš„å¤„ç†ï¼Œæ¨èç¡®è®¤æ¨¡å¼æ”¹ä¸ºæ‰‹åŠ¨ã€‚ï¼ˆnackå’ŒrejectåŒºåˆ«ï¼Ÿnackå¯ä»¥ä¸€æ¬¡æ‹’ç»å¤šæ¡æ¶ˆæ¯ï¼‰ 5. é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ï¼Ÿ é€šè¿‡Prefetchï¼ˆé€šé“ä¸Šæœ€å¤§æœªç¡®è®¤æŠ•é€’æ•°é‡ï¼‰è®¾ç½®æ¶ˆè´¹è€…æ¯æ¬¡æ¶ˆè´¹çš„æ¡æ•°ï¼Œä¸€èˆ¬å°†è¯¥å€¼è®¾ä¸º1ï¼Œä½†ä»–ä¼šé™ä½ååé‡ã€‚RabbitMQå®˜ç½‘å»ºè®®çš„æ˜¯100-300.ï¼ˆæ›´å»ºè®®åå¤è¯•éªŒå¾—åˆ°ä¸€ä¸ªè¡¨ç°ç¬¦åˆæœŸæœ›çš„å€¼ï¼‰ 6. é˜Ÿåˆ—ä¸­æ¶ˆæ¯çŠ¶æ€ï¼Ÿ é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å…±æœ‰ä¿©ç§çŠ¶æ€ï¼Œä¸€æ˜¯å‡†å¤‡æŠ•é€’ï¼ŒäºŒæ˜¯å·²æŠ•é€’ä½†æœªç¡®è®¤ã€‚é˜Ÿåˆ—æœ€å¤§é•¿åº¦ï¼Ÿ å£°æ˜é˜Ÿåˆ—æ—¶å¯ä»¥æŒ‡å®šæœ€å¤§é•¿åº¦ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªé™åˆ¶çŠ¶æ€ä¸ºå‡†å¤‡æŠ•é€’çš„æ•°é‡ï¼Œæœªç¡®è®¤çš„æ¶ˆæ¯ä¸è®¡ç®—åœ¨å†…ã€‚å½“é˜Ÿåˆ—é•¿åº¦è¶…è¿‡é™åˆ¶ï¼ŒMQä¼šæ ¹æ®ç­–ç•¥é€‰æ‹©ä¸¢å¼ƒï¼ˆé»˜è®¤ï¼‰æˆ–è€…å°†æ¶ˆæ¯æŠ•é€’è¿›æ­»ä¿¡é˜Ÿåˆ—ã€‚ 7. å…³äºæ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ å…¶å®æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯æ­»ä¿¡äº¤æ¢æœºï¼Œæå‰å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œåœ¨å£°æ˜é˜Ÿåˆ—æ—¶ä½¿ç”¨â€œx-dead-letter-exchangeâ€å‚æ•°ï¼ˆå¯æŒ‡å®šroutKeyï¼‰å°†é˜Ÿåˆ—ç»‘å®šåˆ°è¯¥æ­»ä¿¡äº¤æ¢æœºã€‚æ¶ˆæ¯æœ‰ä»¥ä¸‹æƒ…å†µä¹‹ä¸€ä¼šæˆä¸ºæ­»ä¿¡ï¼šè¢«rejectæˆ–è€…nackï¼Œæ¶ˆæ¯è¶…è¿‡ç”Ÿå­˜æ—¶é—´ï¼Œé˜Ÿåˆ—é•¿åº¦è¶…è¿‡é™åˆ¶ã€‚ 8. å…³äºä¸èƒ½è·¯ç”±åˆ°é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Ÿ è¿™ä¸ªå’Œä¸Šé¢ä¸€æ ·ï¼Œå…¶å®ä¸ç®—Queueç³»åˆ—è€Œæ˜¯Exchangeã€‚é’ˆå¯¹æ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°é˜Ÿåˆ—çš„æƒ…å†µMQæä¾›äº†Alternate Exchangeå¤„ç†ã€‚å£°æ˜Exchangeæ—¶æ·»åŠ args.put(â€œalternate-exchangeâ€,â€œmy-aeâ€)å‚æ•°ã€‚å³å½“è¯¥äº¤æ¢æœºå­˜åœ¨æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†æ¶ˆæ¯å‘å¸ƒåˆ°AEä¸Šï¼ŒAEæŠŠæ¶ˆæ¯è·¯ç”±åˆ°ç»‘å®šåœ¨ä»–ä¸Šé¢çš„æ¶ˆæ¯ã€‚","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://blog.tgyf.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/categories/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/categories/RabbitMQ/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://blog.tgyf.com/tags/MQ/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.tgyf.com/tags/RabbitMQ/"}]},{"title":"Hexoä¸»é¢˜pureä½¿ç”¨æŒ‡å—","slug":"Blog/Hexoä¸»é¢˜pureä½¿ç”¨æŒ‡å—","date":"2020-02-23T15:12:34.123Z","updated":"2020-02-23T15:12:34.123Z","comments":true,"path":"2020/02/23/Blog/Hexoä¸»é¢˜pureä½¿ç”¨æŒ‡å—/","link":"","permalink":"http://blog.tgyf.com/2020/02/23/Blog/Hexo%E4%B8%BB%E9%A2%98pure%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","excerpt":"","text":"123é¢„è§ˆåœ°å€: https://blog.cofess.comé¡¹ç›®åœ°å€: https://github.com/cofess/hexo-theme-pureä¸­æ–‡ä½¿ç”¨æ–‡æ¡£: https://github.com/cofess/hexo-theme-pure/blob/master/README.cn.md ä½¿ç”¨å‰è¯·æ“ä½œ ä½¿ç”¨è¯¥ä¸»é¢˜å‰, è¯·å…ˆå¤åˆ¶ theme/pure/_source/ ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹åˆ° blog path/source/ ç›®å½•ä¸‹ åŸå› åœ¨äºè¯¥ç›®å½•ä¸‹æœ‰å»ºå¥½çš„èœå• categories(åˆ†ç±»)ã€tags(æ ‡ç­¾)ã€repository(é¡¹ç›®)ã€books(ä¹¦å•)ã€links(å‹é“¾)ã€about(å…³äº)é¡µé¢ å½“ä½ ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»ã€æ ‡ç­¾ï¼Œå±•ç¤ºgithubé¡¹ç›®æ—¶ æ–‡ç« ç›®å½•ç´¢å¼• åœ¨æ–‡ç« è¯¦æƒ…é¡µ, å±•ç¤ºä¸€ä¸ªæ–‡ç« ç›®å½• ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­å¼€å¯é…ç½®: 12config toc: true # æ˜¯å¦å¼€å¯æ–‡ç« ç« èŠ‚ç›®å½•å¯¼èˆª åœ¨æ–‡ç« é¡¶éƒ¨å°†è¯¥æ–‡ç« å¼€å¯ç´¢å¼•, å¦‚: 12345678910111213---title: Hexoä¸»é¢˜pureä½¿ç”¨æŒ‡å—date: 2019-11-05 14:34:15tags: - hexoä¸»é¢˜categories:- hexotoc: true # æ˜¯å¦å¯ç”¨å†…å®¹ç´¢å¼•sidebar: none # æ˜¯å¦å¯ç”¨sidebarä¾§è¾¹æ ï¼Œnoneï¼šä¸å¯ç”¨--- ä¾§è¾¹æ  ä¸»é¢˜é…ç½®é¡¹ä¸­, ä¾§è¾¹æ å¯ä»¥å¦‚ä¸‹é…ç½®: 123456789101112131415# ä¾§è¾¹æ sidebar: right# ä¾§è¾¹æ å¯ç”¨å“ªäº›æ¨¡å—widgets: - board # å…¬å‘Š - category # åˆ†ç±» - tag # æ ‡ç­¾ - tagcloud # æ ‡ç­¾äº‘ - archive # å½’æ¡£ - recent_posts # æœ€è¿‘æ–‡ç« # å½’æ¡£åˆ—è¡¨çš„å±•ç¤ºæ–¹å¼archive_type: 'monthly' # å½’æ¡£æ–¹å¼: yearly | monthlyshow_count: true # æ˜¾ç¤ºæ¯ä¸ªå½’æ¡£çš„æ–‡ç« æ€»æ•° å›¾é›† åœ¨æ–‡ç« è¯¦æƒ…é¡µä¸­, æ¶‰åŠçš„å›¾ç‰‡å¯ä»¥ä½¿ç”¨å›¾é›†åŠŸèƒ½, åœ¨ç‚¹å‡»ä¸€å¼ å›¾ç‰‡æ—¶, æ”¾å¤§å›¾ç‰‡. ä¸»é¢˜çš„å›¾å†Œå…¬å‘Šæ˜¯ä½¿ç”¨fancyboxå®ç°, å¯ä»¥å‚ç…§github 1234# Fancybox# å›¾é›†åŠŸèƒ½fancybox: true å±•ç¤ºgithubé¡¹ç›® åœ¨å·¦ä¾§èœå•é¡¹ç›®ä¸­, ç‚¹å‡»å±•ç¤ºè‡ªå·±çš„githubé¡¹ç›® åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ _config.yml ä¿®æ”¹, è¯·é…ç½®è‡ªå·±githubç”¨æˆ·å 123github: username: caoruiy # githubç”¨æˆ·å æ–°å»ºrepositoryé¡µé¢: 12&gt; hexo new repository ä½ ä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶ theme/pure/_source/ ç›®å½•ä¸‹ repositoryæ–‡ä»¶å¤¹ åˆ° åšå®¢æ ¹ç›®å½•/source/ ç›®å½•ä¸‹ å°†æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸º: 1234567---title: Repositorieslayout: repositorycomments: falsesidebar: none--- å…³é”®å†…å®¹ä¸º layout: repository, åŒ…å«è¯¥å±æ€§æ‰å¯ä»¥å±•ç¤ºgithubé¡¹ç›® è¯„è®ºåŠŸèƒ½ ä¸»é¢˜é›†æˆäº†disqusã€å‹è¨€ã€æ¥å¿…åŠ›ã€gitmentã€gitalkè¯„è®ºç³»ç»Ÿï¼Œé€‰æ‹©å…¶ä¸­ä¸€ç§å³å¯ ä½ å¯ä»¥åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹è¯„è®ºå·¥å…· 123comment: type: valine # å¯ç”¨å“ªç§è¯„è®ºç³»ç»Ÿ Valine ä¸€ä¸ªæ— åç«¯çš„è¯„è®ºæ¡†å·¥å…·, å…¶ä¾èµ–äº Leancloud å¼€å‘, æ‰€ä»¥ä½¿ç”¨å‰éœ€è¦å…ˆæ³¨å†Œ Leancloud è´¦å· å¦‚ä½•å¼€å§‹? ä½ å¯ä»¥ä» Valine-å¿«é€Ÿå¼€å§‹ æ•™ç¨‹å¼€å§‹, æ•™ç¨‹åŒ…å«äº†ä¸€æ­¥ä¸€æ­¥çš„æŒ‡å¼•æ•™ç¨‹. Valineé…ç½®é¡¹ ä¸»é¢˜valineè¯„è®ºæ¡†æä¾›äº†ä»¥ä¸‹é…ç½®é¡¹ 1234567891011121314valine: # Valineå®˜æ–¹åœ°å€: https://valine.js.org appid: # ä½ çš„ leancloud åº”ç”¨ appid appkey: # ä½ çš„ leancloud åº”ç”¨ appkey notify: true # æ˜¯å¦å¼€å§‹è¯„è®ºé‚®ä»¶æé†’, æ•™ç¨‹: https://github.com/xCss/Valine/wiki verify: false # æ˜¯å¦å¼€å§‹éªŒè¯ç åŠŸèƒ½, å¼€å§‹é‚®ä»¶æé†’ä¼šè‡ªåŠ¨å¼€å¯éªŒè¯ç åŠŸèƒ½ placeholder: è¯´ç‚¹ä»€ä¹ˆ... # è¾“å…¥æ¡†é»˜è®¤å†…å®¹ avatar: mm # å¤´åƒå±•ç¤ºæ–¹å¼, å…·ä½“è®¾ç½®é¡¹æ•™ç¨‹: https://valine.js.org/configuration.html#avatar meta: nick,mail,link # è‡ªå®šä¹‰è¯„è®ºä¿¡æ¯ pageSize: 10 # è¯„è®ºåˆ—è¡¨åˆ†é¡µ lang: zh-cn, # å¤šè¯­è¨€æ”¯æŒ zh-cn | en visitor: true # æ–‡ç« é˜…è¯»é‡ç»Ÿè®¡: https://valine.js.org/visitor.html highlight: true # ä»£ç é«˜äº® recordIP: true # è®°å½•è¯„è®ºè€…çš„IP å…³äºé‚®ä»¶æé†’: åªæœ‰åœ¨å›å¤è¯„è®ºæ—¶, å¹¶ä¸”å¡«å†™äº†é‚®ç®±çš„è¯„è®ºæ‰ä¼šæ”¶åˆ°å›å¤æé†’ å…³äºæ–‡ç« é˜…è¯»é‡ç»Ÿè®¡: å¼€å¯é˜…è¯»é‡ç»Ÿè®¡, ä¼šåœ¨è¯¦æƒ…é¡µæ ‡é¢˜ä¸‹å±•ç¤ºé˜…è¯»é‡æ•°æ® æœç´¢åŠŸèƒ½ ä¸»é¢˜æä¾›å†…ç½®çš„æœç´¢åŠŸèƒ½å’Œç™¾åº¦æœç´¢, ç™¾åº¦æœç´¢å°±æ˜¯ä½¿ç”¨ç™¾åº¦çš„SEOæœç´¢, ä¸ªäººè§‰å¾—ä¸æ˜¯å¾ˆå®ç”¨, ä¸å»ºè®®å¼€å¯. åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml ä¸­é…ç½®: 12345# Searchsearch: insight: true # åœ¨ä½¿ç”¨æœç´¢åŠŸèƒ½å‰, ä½ éœ€è¦å®‰è£… `hexo-generator-json-content` baidu: false # ä½¿ç”¨ç™¾åº¦æœç´¢å‰, ä½ å¿…é¡»ç¦ç”¨å…¶ä»–æ‰€æœ‰çš„æœç´¢åŠŸèƒ½ å†…ç½®æœç´¢ ä½¿ç”¨æœç´¢åŠŸèƒ½å‰éœ€è¦å…ˆå®‰è£…: 12npm i -S hexo-generator-json-content é¡¹ç›®åœ°å€: https://github.com/alexbruno/hexo-generator-json-content åœ¨ä½ è¿è¡Œ hexo g æˆ–è€… hexo s æ—¶ç”Ÿæ•ˆï¼Œåœ¨ hexo g ç”Ÿæˆç«™ç‚¹æ—¶, ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ content.json è¯¥æ–‡ä»¶å†…å®¹å³ä¸ºæœç´¢å†…å®¹ã€‚ ä½ å¯ä»¥å¯¹æœç´¢å†…å®¹è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼Œ åªè¦åœ¨ _config.yml ä¸­é…ç½® jsonContentå³å¯: 1234567891011121314151617181920# ç¤ºä¾‹: éšè—åˆ†ç±»å’Œæ ‡ç­¾çš„æœç´¢jsonContent: dateFormat: DD/MM/YYYY posts: title: true date: true path: true text: true raw: false content: false slug: false updated: false comments: false link: false permalink: false excerpt: false categories: false tags: false author: false æ–‡ç« é˜…è¯»æ•°é‡ç»Ÿè®¡ ä¸»é¢˜æä¾› ä¸è’œå­ å’Œ åŸºäº leancloud çš„ç»Ÿè®¡ ä½†æ˜¯ç»è¿‡éªŒè¯, å‘ç°åŸºäºleancloudçš„ç»Ÿè®¡ä¸ç”Ÿæ•ˆ, ä¸çŸ¥åŸå› , å®ç°ç­‰æ•ˆçš„æ–¹æ³•å°±æ˜¯: è¯„è®ºæ¡†ä½¿ç”¨valineè¯„è®ºæ¡†(ä¸»é¢˜å·²ç»å†…ç½®), åŒæ—¶å¼€å¯ visitor: true é…ç½®é¡¹é¡¹å³å¯ å­—æ•°ç»Ÿè®¡&amp;é˜…è¯»æ—¶é•¿ ä¸»é¢˜å†…ç½®äº†è¯¥åŠŸèƒ½, ä½¿ç”¨å‰éœ€è¦å…ˆå®‰è£…æ’ä»¶: 12npm i -S hexo-wordcount ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­, å¼€å¯è®¾ç½®å³å¯: 123456# wordcountpostCount: enable: true wordcount: true # æ–‡ç« å­—æ•°ç»Ÿè®¡ min2read: true # é˜…è¯»æ—¶é•¿é¢„è®¡ å‹æƒ…é“¾æ¥ å¤åˆ¶ theme/pure/_source/ ç›®å½•ä¸‹ linksæ–‡ä»¶å¤¹ åˆ° blog path/source/ ç›®å½•ä¸‹ åœ¨ hexo ç›®å½•ä¸‹çš„ source æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º _dataï¼ˆç¦æ­¢æ”¹åï¼‰çš„æ–‡ä»¶å¤¹ã€‚ ç„¶ååœ¨æ–‡ä»¶å†…åˆ›å»ºä¸€ä¸ªåä¸º links.yml çš„æ–‡ä»¶,åœ¨å…¶ä¸­æ·»åŠ ç›¸å…³æ•°æ®å³å¯ã€‚ å•ä¸ªå‹æƒ…é“¾æ¥çš„æ ¼å¼ä¸ºï¼š 12345Name: link: http://example.com avatar: http://example.com/avatar.png desc: \"è¿™æ˜¯ä¸€ä¸ªæè¿°\" æ·»åŠ å¤šä¸ªå‹æƒ…é“¾æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸Šé¢çš„æ ¼å¼é‡å¤å¡«å†™å³å¯ã€‚ å°† Name æ”¹ä¸ºå‹æƒ…é“¾æ¥çš„åå­—ï¼Œä¾‹å¦‚ Cofessã€‚ http://example.com ä¸ºå‹æƒ…é“¾æ¥çš„åœ°å€ã€‚ http://example.com/avatar.png ä¸ºå‹æƒ…é“¾æ¥çš„å¤´åƒã€‚ è¿™æ˜¯ä¸€ä¸ªæè¿° ä¸ºå‹æƒ…é“¾æ¥æè¿°ã€‚","categories":[{"name":"åº”ç”¨éƒ¨ç½²","slug":"åº”ç”¨éƒ¨ç½²","permalink":"http://blog.tgyf.com/categories/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"http://blog.tgyf.com/tags/%E5%8D%9A%E5%AE%A2/"}]},{"title":"æ­å»ºä¸ªäººåšå®¢hexoè¯¦ç»†æ­¥éª¤","slug":"Blog/æ­å»ºä¸ªäººåšå®¢hexoè¯¦ç»†æ­¥éª¤","date":"2020-02-23T14:44:47.683Z","updated":"2020-02-23T14:44:47.683Z","comments":true,"path":"2020/02/23/Blog/æ­å»ºä¸ªäººåšå®¢hexoè¯¦ç»†æ­¥éª¤/","link":"","permalink":"http://blog.tgyf.com/2020/02/23/Blog/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2hexo%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start ç¬¬ä¸€æ­¥ï¼šä¸‹è½½å®‰è£…Gitä¸node.js Gitä¸‹è½½åœ°å€ node.jsä¸‹è½½åœ°å€ ç¬¬äºŒæ­¥ï¼šå®‰è£…hexo 1$ npm install -g hexo è¿™é‡Œå¦‚æœåœ°å€è¢«â€œå¢™â€ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« çš„â€œå®‰è£…Hexoâ€éƒ¨åˆ† ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–Hexo åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆæˆ‘çš„æ˜¯åœ¨Fç›˜åˆ›å»ºçš„Hexoï¼‰ åœ¨Hexoæ–‡ä»¶å¤¹ä¸‹ï¼Œå³é”®è¿è¡ŒGit Bashï¼Œè¾“å…¥å‘½ä»¤ï¼šhexo init åœ¨_config.yml,è¿›è¡ŒåŸºç¡€é…ç½® ç¬¬å››æ­¥ï¼šæœ¬åœ°éƒ¨ç½²åšå®¢ åˆ†åˆ«è¾“å…¥ å¦‚ä¸‹å‘½ä»¤ï¼š 12hexo ghexo s æ›´å¤šhexoå¸¸ç”¨å‘½ä»¤","categories":[{"name":"åº”ç”¨éƒ¨ç½²","slug":"åº”ç”¨éƒ¨ç½²","permalink":"http://blog.tgyf.com/categories/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"http://blog.tgyf.com/tags/%E5%8D%9A%E5%AE%A2/"}]}]}